%\iffalse meta-comment
%
% factura.dtx
% Copyright 2016 Emilio Lazo Zaia <emiliolazozaia@gmail.com>
%
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either
% version 1.3c of this license or (at your option) any later
% version. This version of this license is in
%   http://www.latex-project.org/lppl/lppl-1-3c.{html|txt|tex|pdf}
% and the latest version of this license is in
%   http://www.latex-project.org/lppl.txt
% and version 1.3c or later is part of all distributions of
% LaTeX version 2008/05/04 or later.
%
% This work has the LPPL maintenance status `maintained'.
%
% The Current Maintainer of this work is Emilio Lazo Zaia.
%
% This work consists of the files README and factura.dtx
% with its derived files factura.ins, factura.cls, factura.def,
% factura-ejemplo-firma.tex, factura-ejemplo-fondo.tex,
% factura-ejemplo-membrete.tex, factura-ejemplo-cotizacion.tex,
% factura-ejemplo-prefactura.tex, factura-ejemplo-factura1.tex
% factura-ejemplo-factura2.tex, factura-ejemplo-factura3.tex,
% factura-ejemplo-factura4.tex, factura-ejemplo-factura5.tex,
% factura-ejemplo-factura6.tex, factura-ejemplo-factura7.tex,
% factura-ejemplo-factura8.tex, factura-ejemplo-reporte1.tex,
% factura-ejemplo-reporte2.tex, factura-ejemplo-reporte3.tex,
% and factura-beispiel-rechnung.tex.
%<*internalbatchfile>
\def\nameofplainTeX{plain}
\ifx\fmtname\nameofplainTeX
\else
 \expandafter\begingroup
\fi
%</internalbatchfile>
%<*batchfile>
\input docstrip.tex
\preamble

Copyright 2016 Emilio Lazo Zaia <emiliolazozaia@gmail.com>

This work may be distributed and/or modified under the
conditions of the LaTeX Project Public License, either
version 1.3c of this license or (at your option) any later
version. This version of this license is in
 http://www.latex-project.org/lppl/lppl-1-3c.{html|txt|tex|pdf}
and the latest version of this license is in
 http://www.latex-project.org/lppl.txt
and version 1.3c or later is part of all distributions of
LaTeX version 2008/05/04 or later.

This work has the LPPL maintenance status `maintained'.

The Current Maintainer of this work is Emilio Lazo Zaia.

This work consists of the files README and factura.dtx
with its derived files factura.ins, factura.cls, factura.def,
factura-ejemplo-firma.tex, factura-ejemplo-fondo.tex,
factura-ejemplo-membrete.tex, factura-ejemplo-cotizacion.tex,
factura-ejemplo-prefactura.tex, factura-ejemplo-factura1.tex
factura-ejemplo-factura2.tex, factura-ejemplo-factura3.tex,
factura-ejemplo-factura4.tex, factura-ejemplo-factura5.tex,
factura-ejemplo-factura6.tex, factura-ejemplo-factura7.tex,
factura-ejemplo-factura8.tex, factura-ejemplo-reporte1.tex,
factura-ejemplo-reporte2.tex, factura-ejemplo-reporte3.tex,
and factura-beispiel-rechnung.tex.

\endpreamble
\keepsilent
\askforoverwritefalse
\obeyspaces
\Msg{*****************************************************************}
\Msg{**************************** factura ****************************}
\Msg{*****************************************************************}
\generate{\file{\jobname.cls}{\from{\jobname.dtx}{class}}}
\generate{\file{\jobname.def}{\from{\jobname.dtx}{def}}}
\Msg{\jobname.cls and \jobname.def written.}
\Msg{}
\postamble
\endpostamble
%</batchfile>
%<*internalbatchfile>
\generate{\file{\jobname.ins}{\from{\jobname.dtx}{batchfile}}}
\Msg{\jobname.ins written.}
%</internalbatchfile>
%<*batchfile>
\def\factuno{factura-ejemplo-factura1.tex}
\def\factdos{factura-ejemplo-factura2.tex}
\def\facttres{factura-ejemplo-factura3.tex}
\def\factcuatro{factura-ejemplo-factura4.tex}
\def\factcinco{factura-ejemplo-factura5.tex}
\def\factseis{factura-ejemplo-factura6.tex}
\def\factsiete{factura-ejemplo-factura7.tex}
\def\factocho{factura-ejemplo-factura8.tex}
\def\repuno{factura-ejemplo-reporte1.tex}
\def\repdos{factura-ejemplo-reporte2.tex}
\def\reptres{factura-ejemplo-reporte3.tex}
\def\cotiza{factura-ejemplo-cotizacion.tex}
\def\prefac{factura-ejemplo-prefactura.tex}
\def\beispiel{factura-beispiel-rechnung.tex}
\def\firma{factura-ejemplo-firma.tex}
\def\fondo{factura-ejemplo-fondo.tex}
\def\membrete{factura-ejemplo-membrete.tex}
\generate{\file{\factuno}{\from{\jobname.dtx}{factuno}}}
\generate{\file{\factdos}{\from{\jobname.dtx}{factdos}}}
\generate{\file{\facttres}{\from{\jobname.dtx}{facttres}}}
\generate{\file{\factcuatro}{\from{\jobname.dtx}{factcuatro}}}
\generate{\file{\factcinco}{\from{\jobname.dtx}{factcinco}}}
\generate{\file{\factseis}{\from{\jobname.dtx}{factseis}}}
\generate{\file{\factsiete}{\from{\jobname.dtx}{factsiete}}}
\generate{\file{\factocho}{\from{\jobname.dtx}{factocho}}}
\generate{\file{\repuno}{\from{\jobname.dtx}{repuno}}}
\generate{\file{\repdos}{\from{\jobname.dtx}{repdos}}}
\generate{\file{\reptres}{\from{\jobname.dtx}{reptres}}}
\generate{\file{\cotiza}{\from{\jobname.dtx}{cotiza}}}
\generate{\file{\prefac}{\from{\jobname.dtx}{prefac}}}
\generate{\file{\beispiel}{\from{\jobname.dtx}{beispiel}}}
\generate{\file{\firma}{\from{\jobname.dtx}{firma}}}
\generate{\file{\fondo}{\from{\jobname.dtx}{fondo}}}
\generate{\file{\membrete}{\from{\jobname.dtx}{membrete}}}
\Msg{.tex examples written.}
\Msg{}
\Msg{*****************************************************************}
\immediate\write18{makeindex -s gind.ist -o \jobname.ind \jobname.idx}
\immediate\write18{makeindex -s gglo.ist -o \jobname.gls \jobname.glo}
\Msg{}
\Msg{Change history and index updated.}
\Msg{*****************************************************************}
\Msg{To produce only package files, type}
\Msg{  pdftex \jobname.dtx}
\Msg{To produce package files and pdf documentation, type}
\Msg{  pdflatex \jobname.dtx}
\Msg{  pdflatex factura-ejemplo-fondo.tex}
\Msg{  pdflatex factura-ejemplo-membrete.tex}
\Msg{  xelatex factura-ejemplo-firma.tex}
\Msg{  pdflatex factura-ejemplo-prefactura.tex}
\Msg{and recompile \jobname.dtx.}
\Msg{To manual update index and changelog, type}
\Msg{  makeindex -s gind.ist -o \jobname.ind \jobname.idx}
\Msg{  makeindex -s gglo.ist -o \jobname.gls \jobname.glo}
\Msg{}
\Msg{More information (in spanish) about compiling on README and documentation.}
\Msg{}
\Msg{*****************************************************************}
\Msg{**************************** factura ****************************}
\Msg{*****************************************************************}
\Msg{}
%</batchfile>
%<batchfile>\endbatchfile
%<*internalbatchfile>
\ifx\fmtname\nameofplainTeX
 \expandafter\endbatchfile
\else
 \expandafter\endgroup
\fi
%</internalbatchfile>
%<*driver>
\ProvidesFile{factura.dtx}
%</driver>
%<class>\NeedsTeXFormat{LaTeX2e}[1995/12/01]
%<class>\ProvidesClass{factura}
%<def>\ProvidesFile{factura.def}
%<*class|def>
[2016/06/25 v2.82
%<class>Clase para elaborar facturas legales
%<class>en la República Bolivariana de Venezuela.
%<def>Archivo valores iniciales y condiciones de borde para factura.cls
]

%</class|def>
%<*driver>
\documentclass{ltxdoc}
\usepackage[letterpaper,marginparsep=10pt,vmargin={3.2cm,2cm},hmargin={4cm,2cm}]{geometry}
\usepackage[usenames,dvipsnames]{color}
\usepackage[spanish]{babel}
\usepackage{paralist,calc,verbatim,graphicx,array,todo,etoolbox,metalogo,ifxetex,ifluatex,footnote,hypdoc}

\ifxetex
 \usepackage{fontspec}
\else
 \usepackage[T1]{fontenc}
 \ifluatex
 \else
  \usepackage[utf8]{inputenc}
 \fi
\fi

\hypersetup{
 plainpages=false,
 colorlinks=true,
 linkcolor=blue,
 unicode=true}

\makesavenoteenv{tabular}
\makesavenoteenv{table}

\EnableCrossrefs
\CodelineIndex
\OnlyDescription
\RecordChanges

\setlength{\parskip}{7pt}
\setlength\IndexMin{100pt}

% No quiero que las notas pendientes tengan los números de página:
\patchcmd{\todoitem}{(p.~\pageref{todopage:\thetodo}):}{-}{}{}

\renewcommand{\todoname}{Pendiente}
\newcommand{\changesname}{Lista de cambios en las versiones}
\newcommand{\glosname}{Índice de comandos, entornos y opciones}

\makeatletter
\def\SpecialEnvIndex#1{\@bsphack
 \index{#1\actualchar{\protect\ttfamily#1}
  (entorno)\encapchar usage}%
 \index{entornos:\levelchar#1\actualchar
  {\protect\ttfamily#1}\encapchar usage}\@esphack}
\def\es@yearl{l año}
 % Redefinimos el comando del encabezado del índice:
 \def\index@prologue{%
  \section*{\glosname}%
  \markboth{\glosname}{\glosname}}%
 % Cambiamos el nombre de la lista de cambios y quitamos "General:":
 \patchcmd{\glossary@prologue}{Change History}{\changesname}{}{}
 \def\generalname{}
 \patchcmd{\changes@}{:}{}{}{}
 % Definimos el comando para describir opciones, que inexplicablemente falta en doc.sty:
 \def\DescribeOption{\leavevmode\@bsphack\begingroup\MakePrivateLetters
  \Describe@Option}
 \def\Describe@Option#1{\endgroup
  \marginpar{\raggedleft\PrintDescribeOption{#1}}%
  \SpecialOptionIndex{#1}\@esphack\ignorespaces}
 \def\SpecialOptionIndex#1{\@bsphack
  \index{#1\actualchar{\protect\ttfamily#1}
   (opción)\encapchar usage}%
  \index{opciones:\levelchar#1\actualchar{\protect\ttfamily#1}\encapchar
   usage}\@esphack}
 \def\PrintDescribeOption#1{\strut \MacroFont #1\ }
\makeatother

\title{The \textsf{\jobname} class\thanks{Esta documentación corresponde a la clase \textsf{\jobname}~\fileversion, de fecha \filedate.}}
\author{Emilio Lazo Zaia\\ \texttt{<emiliolazozaia at gmail.com>}}

\GetFileInfo{\jobname.dtx}

\begin{document}
 \maketitle
 \DocInput{\jobname.dtx}
 \clearpage
 \addcontentsline{toc}{section}{\todoname}
 \todos
 \section*{Información específica de esta versión}
  Para poder compilar con \LuaLaTeX{} es necesaria la versión v2.26 del paquete |zref|, de fecha 2016/05/21, y la versión v1.18 de |atbegshi| de fecha 2016/06/09.
  
  Esta versión de |factura| se sacó principalmente para corregir un error introducido en la versión anterior v2.72 en cuanto a las referencias, para agregar la opción |numitem| que enumera los ítems en la factura y para que la línea diagonal (opción |linea|) funcione correctamente siempre.
 \addcontentsline{toc}{section}{\changesname}
 \PrintChanges
 \addcontentsline{toc}{section}{\glosname}
 \PrintIndex
\end{document}
%</driver>
% \fi
%
%^^A Gracias a jfbu y a Joseph Wright por \starttodo, \stoptodo, \endorgo.
%^^A Thanks to jfbu and Joseph Wright for \starttodo, \stoptodo, \endorgo.
%^^A (http://tex.stackexchange.com/questions/235680/add-something-to-the-driver-section-inside-the-package-code-using-onlydescripti)
% \long\def\stoptodo#1\starttodo {}%
% \long\def\starttodo#1\stoptodo {}%
%
% \makeatletter
% \def\endorgo #1{%
%  \ifx #1\endinput\expandafter\stoptodo
%  \else #1\expandafter\@gobble\fi}%
% \makeatother
%
% \CheckSum{0}
%
% \CharacterTable
%  {Upper-case    \A\B\C\D\E\F\G\H\I\J\K\L\M\N\O\P\Q\R\S\T\U\V\W\X\Y\Z
%   Lower-case    \a\b\c\d\e\f\g\h\i\j\k\l\m\n\o\p\q\r\s\t\u\v\w\x\y\z
%   Digits        \0\1\2\3\4\5\6\7\8\9
%   Exclamation   \!     Double quote  \"     Hash (number) \#
%   Dollar        \$     Percent       \%     Ampersand     \&
%   Acute accent  \'     Left paren    \(     Right paren   \)
%   Asterisk      \*     Plus          \+     Comma         \,
%   Minus         \-     Point         \.     Solidus       \/
%   Colon         \:     Semicolon     \;     Less than     \<
%   Equals        \=     Greater than  \>     Question mark \?
%   Commercial at \@     Left bracket  \[     Backslash     \\
%   Right bracket \]     Circumflex    \^     Underscore    \_
%   Grave accent  \`     Left brace    \{     Vertical bar  \|
%   Right brace   \}     Tilde         \~}
%
% \changes{v1.00}{2013/04/29}{Primera versión.}
% \changes{v2.00}{2015/03/30}{Segunda versión: errores corregidos, comandos y opciones nuevas, ambiente de reporte, documentación completa, ejemplos y convertido todo a formato \texttt{.dtx}.}
% \changes{v2.05}{2015/04/13}{Se cambió de \texttt{4pt} a \texttt{6pt} en \texttt{factura.def} para el margen interno predeterminado en las cajas del encabezado y en la descripción.}
% \changes{v2.05}{2015/04/13}{Se quitó \texttt{UTF8} de \texttt{inputenc} como un paquete que se cargue de forma predeterminada.}
% \changes{v2.05}{2015/04/13}{Advierte que no son compatibles los comandos \cs{Descuento} con la opción \texttt{filas}.}
% \changes{v2.05}{2015/04/13}{Se puso un parche en \cs{@CargaFondoReporte} para arreglar que \cs{topskip} aplicara bien en \cs{@EncabezadoReporte}.}
% \changes{v2.05}{2015/04/13}{Arreglada la interacción entre las opciones \texttt{ivanoexplicito} y \texttt{filas}, y se quitó la línea del total cuando se usa \texttt{ivanoexplicito}.}
% \changes{v2.05}{2015/04/13}{Se renombró la opción \texttt{relleno} a \texttt{exparriba}, a la vez que se quitó \cs{Descripcion*} porque se agregó la opción \texttt{sinexpandir}.}
% \changes{v2.05}{2015/04/13}{Se renombró la opción \texttt{ivanoexplicito} por \texttt{sinivaexpresado}.}
% \changes{v2.05}{2015/04/13}{Se cambiaron los \cs{AtBeginDocument} por \cs{AtBeginShipoutNext} de la factura porque daba problemas al especificar \texttt{conreporte} sin luego agregar el ambiente de reporte.}
% \changes{v2.05}{2015/04/13}{Se colocó \cs{@SeparaMinTotales} dentro de otro \cs{AtBeginDocument} más adecuado.}
% \changes{v2.05}{2015/04/13}{Modificaciones en la documentación y en los ejemplos.}
% \changes{v2.05}{2015/04/13}{Los comandos \cs{ItemX} ahora colocan la línea bien con la opción \texttt{lineaitem}.}
% \changes{v2.1}{2015/08/26}{Advierte cuando la fecha del documento es distinta de la fecha del dia.}
% \changes{v2.1}{2015/08/26}{Los comandos de descuentos totales aceptan un * como argumento para que el descuento pueda ser en moneda y no en porcentaje.}
% \changes{v2.1}{2015/08/26}{Quitados los alias de macros viejas agregados por compatibilidad.}
% \changes{v2.1}{2015/08/26}{Corregida la forma como sale la denominación del impuesto para todos los casos.}
% \changes{v2.1}{2015/08/26}{Corregida y mejorada la documentación.}
% \changes{v2.1}{2015/08/26}{Correcciones en los ejemplos.}
% \changes{v2.1}{2015/08/26}{Mejor manejo de \cs{InicioReporte}.}
% \changes{v2.6}{2016/03/07}{Cambiado el lugar donde se fija el nombre del documento (FACTURA o COTIZACIÓN) porque antes no era correcto y no se podía cambiar el nombre de la cotización a algo distinto como por ejemplo PRESUPUESTO.}
% \changes{v2.6}{2016/03/07}{Se renombró la opción \texttt{sincond} en favor de \texttt{sincondiciones}.}
% \changes{v2.6}{2016/03/07}{Cambiado ``condiciones de pago'' por ``condiciones del documento''.}
% \changes{v2.6}{2016/03/07}{Los descuentos globales aceptan decimales bien; antes no.}
% \changes{v2.6}{2016/03/07}{Se cambió la forma como se llama al ambiente \texttt{tabularx} en la factura creando una nueva macro que se evalúa completamente resultando en la definición de las columnas.}
% \changes{v2.6}{2016/03/07}{Agregadas cuatro opciones: \texttt{sinlineasvi}, \texttt{sinlineasve}, \texttt{sinlineash}, \texttt{sinlineashi}, \texttt{sinlineashe} y renombrada la opción \texttt{lineaitem} por \texttt{conlineasha} aludiendo a ``con líneas horizontales para los artículos''.}
% \changes{v2.6}{2016/03/07}{Se arregló la línea oblicua que en algunos casos seguía sin salir.}
% \changes{v2.6}{2016/03/07}{Textos ``PAGADO'' y ``Por el emisor'' para las facturas y cotizaciones cuando no se define el emisor del documento.}
% \changes{v2.6}{2016/03/07}{Nueva opción \texttt{dosfirmas} para poner las dos firmas en casos en los que lo predeterminado sea una o ninguna firma (cotizaciones o prefacturas).}
% \changes{v2.6}{2016/03/07}{Nuevo comando \cs{Conforme} para el nombre de quien recibe la factura.}
% \changes{v2.6}{2016/03/07}{Cambiado el lugar en el código donde se llama a la macro que dibuja la línea ``protectora'' y se hace ahora con \cs{AddToShipoutPicture} para que no se genere un espacio en blanco extra.}
% \changes{v2.6}{2016/03/07}{El ejemplo de la documentación es de una cotización y no de una prefactura; actualizada la documentación y los ejemplos.}
% \changes{v2.6}{2016/03/07}{En el índice ponemos ``entorno'' en lugar de ``environment''.}
% \changes{v2.6}{2016/03/07}{El verbo ``poner'' es digno para la documentación. No sólo las gallinas ponen.}
% \changes{v2.6}{2016/03/07}{Renombrado el comando \cs{EstiloPag} por \cs{InfoPagina}; también \cs{LetraEncReporte} por \cs{LetraInfoPagina}; por otra parte se cambió \cs{LetraDatosReporte} en favor de \cs{LetraEncReporte}, y por último se cambió \cs{LetraTitRenglon} por \cs{LetraTitCuadro}.}
% \changes{v2.6}{2016/03/07}{Renombrados los estilos de página: \texttt{soloenc} a \texttt{soloarriba}, y \texttt{solopie} a \texttt{soloabajo}.}
% \changes{v2.6}{2016/03/07}{Se mejoró el código relativo al estilo de página del reporte y agregada la macro \cs{EstiloPagReporte} para establecer el estilo de página del reporte.}
% \changes{v2.6}{2016/03/07}{Se agregó una forma para que más de una línea en la descripción de la factura sea mejor manejada.}
% \changes{v2.6}{2016/03/07}{Mejorado el código de la macro interna \cs{@EscribeTipoDeImpuesto}.}
% \changes{v2.6}{2016/03/07}{Cuando la descripción en el cuadro de la factura ocupa más que una línea, agrega al final de cada línea el carácter $\hookleftarrow$.}
% \changes{v2.6}{2016/03/07}{Corregido que salga la ``G'' obligatoria de IVA General cuando hay un elemento exento y uno con IVA General.}
% \changes{v2.6}{2016/03/07}{Cuatro nuevas definiciones dentro del archivo \texttt{factura.def} para establecer algunos caracteres que antes estaban fijados dentro del archivo \texttt{factura.cls}}
% \changes{v2.6}{2016/03/07}{{\slshape parbox}es para cada elemento en la tabla, para asegurar que la denominación del gravámen quede alineada correctamente.}
% \changes{v2.6}{2016/03/07}{Quitados los paquetes \texttt{xifthen} y \texttt{pbox}. Arreglada la presentación de los datos del cliente cuando el resumen es más grande.}
% \changes{v2.6}{2016/03/07}{Cuando había descuentos totales y se pedía modo de totalización en filas, este modo no se apagaba correctamente y la línea oblicua daba problemas. Arreglado.}
% \changes{v2.72}{2016/05/16}{Las macros internas \cs{@DescripcionAuxCmd} y \cs{@EscribeTipoDeImpuesto} fueron modificadas.}
% \changes{v2.72}{2016/05/16}{Arreglada la alineación a la derecha en algunos casos en los precios.}
% \changes{v2.72}{2016/05/16}{Se incluyó dentro de la macro interna \cs{@ITEM} la opción para soportar \cs{ItemX}.}
% \changes{v2.72}{2016/05/16}{Ahora se procesa el entorno de la factura aún cuando se pide sólo el reporte, para poder tomar las referencias y los totales. Para eso se cambiaron de sitio varias macros internas.}
% \changes{v2.72}{2016/05/16}{Agregadas las etiquetas y las referencias.}
% \changes{v2.82}{2016/06/25}{Agregada la opción \texttt{numitem} para enumerar cada ítem en la factura.}
% \changes{v2.82}{2016/06/25}{Corregido problema de etiquetas repetidas introducido en la versió 2.72.}
% \changes{v2.82}{2016/06/25}{Corregida la alineación vertical entre las distintas columnas agregando \texttt{[t]} al abrir los ``{\slshape parboxes}'' en los comandos auxiliares que ponen cada celda en un {\slshape parbox} del tamaño de la celda más grande, porque si no se centra verticalmente la celda y se desalinea respecto a la columna de al lado.}
% \changes{v2.82}{2016/06/25}{Ahora dentro de la definición de \cs{@CaracterCeldasVacias} está el código que centra el texto, para poder usar comandos que llenen la caja completa como \cs{dotfill}.}
% \changes{v2.82}{2016/06/25}{Reimplementada la línea diagonal para que funcione en todos los casos.}
% \changes{v2.82}{2016/06/25}{Nueva macro interna \cs{@ColumnasMultiColumnTotalesAuxCmd} para hacer más general la colocación de los totales en el modo de columnas dentro de un \cs{multicolumn}.}
% \changes{v2.82}{2016/06/25}{Quitado el paquete \texttt{MnSymbol} en favor del comando \cs{flechaCR} para la flecha que indica que la descripción ocupa más de una línea.}
%
% \DoNotIndex{}
%
% \tableofcontents
%
% \section*{Brief description in english}
%
% |factura| is the spanish word for 'invoice', so this is a \LaTeX{} class for typesetting and calculating invoices, made taking into account requirements of {\slshape SENIAT} legislation (tax collector entity on the Bolivarian Republic of Venezuela), but its use is not restricted to Venezuela because all variables and displayed text can be redefined by invoking commands or editing.
%
% \newpage
%
% \section{Introducción}
%
% La clase de \LaTeX{} |factura| está diseñada para su uso en la República Bolivariana de Venezuela, conforme a los requerimientos fijados por las providencias del {\slshape SENIAT} 0591, 0257 y 0071, válidas éstas para marzo del año 2016.
%
% Con |factura| se pueden elaborar facturas en formas libres fiscales\footnote{En cuanto a las formas libres, cada hoja del talonario de facturas legales tiene un encabezado con los datos del emisor de la factura y un pie de página con la información de identificación de la imprenta, en tamaño de hoja carta entera; esto es lo que se llama ``forma libre''.}, cotizaciones y reportes de servicios, dejando todos los cálculos a \TeX{}.
%
% El diseño de las facturas hechas con esta clase consiste en un encabezado con los datos que identifican al cliente, y al lado un -opcional- resumen; estas partes de la factura están encerradas en cajas con contornos que predeterminadamente tienen esquinas ovaladas. Si no se especifica el resumen saldrá solamente una de estas cajas en el encabezado que es la de los datos del cliente.
%
% Luego de esto viene un cuadro con los campos: cantidad, descripción, precio unitario y precio total\footnote{Pueden haber variaciones en estos campos controlables con las opciones de la clase (véanse secciones \ref{sec:opciones}, \ref{subsec:descuentos} y \ref{subsec:sincantidad}).}, con los elementos a facturar, cada uno en una línea, luego los totales, y al final viene una -opcional- descripción larga que sale en un cuadro. En fin, la factura consta de:
% \begin{inparaenum}[\bfseries i)]
%  \item el encabezado con los datos del cliente y el -opcional- resumen,
%  \item el cuadro con los elementos que se están facturando, y
%  \item una descripción larga (opcional).
% \end{inparaenum}
%
%
% \section{Instalación}
%
% El paquete que está en CTAN consta de un archivo |README| en formato |UTF-8|, esta documentación compilada como |factura.pdf| y el archivo |factura.dtx|, del cual se generan todos los demás archivos.
%
% Al compilar |factura.dtx| va a producirse |factura.cls| y |factura.def|, además de todos los ejemplos en |.tex| y |factura.ins|.
%
% \noindent Si queremos solamente generar los archivos sin compilar la documentación, debemos ejecutar:
%
% \noindent {\color{RoyalBlue}|pdftex factura.dtx|}
%
% \noindent Para generar los archivos y también compilar la documentación, debemos ejecutar los siguientes pasos:
%
% \begin{enumerate}[\bfseries 1. ]
%
% \item {\color{RoyalBlue}|pdflatex factura.dtx|}
%
% Luego de compilar |factura.dtx| hay que compilar el fondo de ejemplo, el membrete de ejemplo y la firma de ejemplo; estos tres archivos emulan haber digitalizado una hoja de una factura del talonario fiscal, un membrete para los reportes y también una firma que puede agregarse a los documentos a producir. Estos ejemplos se usarán en algunos de los ejemplos de formatos que incluímos y por eso es necesario tenerlos compilados en |.pdf| previamente, ya que su inclusión en los ejemplos es en formato compilado |.pdf|.
%
% El fondo y membrete de ejemplo los debemos compilar así:
%
% \item {\color{RoyalBlue}|pdflatex factura-ejemplo-fondo.tex|}
% \item {\color{RoyalBlue}|pdflatex factura-ejemplo-membrete.tex|}
%
% La firma escaneada de ejemplo necesita compilarse con \XeLaTeX{} porque son códigos en PSTricks y debe producirse un |.pdf|. Se compila así:
%
% \item {\color{RoyalBlue}|xelatex factura-ejemplo-firma.tex|}
%
% Compilamos el ejemplo de la {\slshape prefactura}, que es parte de esta documentación:
%
% \item {\color{RoyalBlue}|pdflatex factura-ejemplo-prefactura.tex|}
%
% Al tener todo esto hecho volvemos a compilar |factura.dtx| para producir esta documentación, puesto que el |.dtx| necesita ser compilado más de una vez para que la documentación quede correctamente elaborada:
%
% \item {\color{RoyalBlue}|pdflatex factura.dtx|}
%
% Los comandos para generar el índice y la lista de cambios, que automáticamente se ejecutan al compilar |factura.dtx| son:
%
% \item {\color{RoyalBlue}|makeindex -s gind.ist -o factura.ind factura.idx|}
% \item {\color{RoyalBlue}|makeindex -s gglo.ist -o factura.gls factura.glo|}
%
% {\itshape No es necesario ejecutar los dos comandos anteriores porque los ejecuta el compilador al actuar sobre }|factura.dtx|.
%
% \end{enumerate}
%
% Al tener el fondo, el membrete y la firma compilados en |.pdf| según los pasos anteriores\footnote{Si sólo ejecutamos pdf\TeX{} para generar los archivos sin la documentación, tendremos que compilarlos con los pasos 2, 3 y 4.}, podremos compilar cualquiera de los ejemplos en |.tex| que el archivo |factura.dtx| genera, y eso lo podemos hacer, por ejemplo así:
%
% \noindent {\color{RoyalBlue}|pdflatex factura-ejemplo-factura1.tex|}\footnote{Podemos también compilar con \LuaLaTeX{} o con \XeLaTeX{}.}
%
%
% \section{Archivos de ejemplo incluídos}
%
% Este paquete incluye varios ejemplos, entre ellos la emulación de un diseño de factura entregado por alguna imprenta, que nos sirve para nuestros ejemplos de prefacturas, un diseño de membrete que nos sirve para los reportes, una firma que emula ser una firma real escaneada para su inclusión en algunos casos, así como varios ejemplos de facturas, prefacturas, cotizaciones y reportes. Cada uno de ellos tiene al principio del documento fuente la aclaratoria de qué es lo que hace, para diferenciarlo de los demás ejemplos.
%
% \noindent \begin{tabular}{rl}
% \bfseries Archivo & \bfseries Descripción \\ \hline
% |factura.dtx| & Archivo principal del que todos los demás se generan, \\
% |factura.pdf| & Esta documentación, \\
% |README| & Archivo con la descripción corta, \\
% |factura-ejemplo-firma.tex| & Ejemplo de firma digitalizada, \\
% |factura-ejemplo-fondo.tex| &  Elemplo de una forma libre fiscal digitalizada, \\
% |factura-ejemplo-membrete.tex| & El mismo ejemplo anterior pero sólo el encabezado, para \\
%                                & poder usarlo como membrete, \\
% |factura-ejemplo-prefactura.tex| & Ejemplo de ``{\slshape prefactura}'', \\
% |factura-ejemplo-cotizacion.tex| & Ejemplo de cotización, \\
% |factura-ejemplo-factura*.tex| & Ejemplos de facturas, \\
% |factura-ejemplo-reporte*.tex| & Ejemplos de reportes, \\
% |factura-beispiel-rechnung.tex| & Un ejemplo de una factura adaptada a otra legislación. \\ \hline
%  \end{tabular}
%
% \IfFileExists{factura-ejemplo-prefactura.pdf}{%
%  \newpage\section{Ejemplo preliminar\label{sec:ejemplo}}
%  \noindent Lo que sigue es un ejemplo del aspecto final de una {\slshape ``prefactura''}, que está bajo el nombre de ``|factura-ejemplo-prefactura.tex|'' y más adelante explicaremos en qué consiste:
%
%  \noindent\includegraphics[scale=0.7]{factura-ejemplo-prefactura.pdf}
%  \newpage}{\message{LaTeX warning: No existe factura-ejemplo-prefactura; se recomienda compilarlo antes de compilar este documento.}}
%
%
% \section{Geometría de la hoja\label{sec:geohoja}}
%
% El espacio que la imprenta deja en el centro de la forma libre está todo disponible para la impresión de la factura con esta clase. Este espacio se delimita con el paquete |geometry|. Los valores predeterminados que tienen que ver con la geometría de la hoja están todos definidos dentro del archivo |factura.def|.
%
% El margen superior que se da con |geometry| está contabilizado desde el inicio del papel\footnote{El papel predeterminado es tamaño carta.} hasta donde empieza el encabezado con los datos del cliente, es decir que el encabezado es el primer elemento desde arriba hacia abajo en una factura.
%
% El margen inferior de |geometry| empieza donde termina la descripción del servicio -o el fin del cuadro de la factura, en caso de que no se agregue un texto de descripción larga-, hasta el final del papel.
%
% Para aclarar lo anterior es necesario decir que hay textos con posiciones fijas que están fuera de estos márgenes, como la fecha de emisión, la ``denominación'' del documento (que es ``FACTURA'', ``COTIZACIÓN'' u otro especificable), el número de la factura, el número de control (cuando aplica), las condiciones del documento y los espacios para las firmas; todas estas partes del documento están fijas en posiciones arbitrarias fuera de los márgenes dejados por |geometry|. Estos textos son fijos para darles posiciones que no dependan del contenido particular de cada factura sino del diseño del talonario que ya tenemos impreso, que siempre será igual, y para el cual estamos adaptando esta clase |factura|.
%
% Las ubicaciones de los textos fijos también tienen valores predefinidos dentro de |factura.def|. Cualquiera de esos valores puede cambiarse mediante comandos, tal como se fijan los valores predeterminados en dicho archivo |.def|; esto significa que se puede personalizar a cualquier diseño del talonario entregado por la imprenta, basta con entender qué hace cada comando (explicado en este documento), consultar el |.def| o ver los ejemplos.
%
% En algunos casos las formas libres tienen impreso el número de la factura y no es controlable esto por el emisor (como ocurre con el número de control que la legislación obliga a que siempre venga impreso en cada hoja del talonario). En otros casos el emisor tiene la libertad de escribir el número de la factura y controlarlo él mismo. Se puede hacer funcionar la clase según cualquiera de estas dos formas con una opción en |\documentclass|, es decir, podemos imprimir el número de la factura donde queramos, o también podemos asumirlo impreso en el talonario, según sea el caso del talonario que tengamos.
%
% Al usarse esta clase se deben primero hacer medidas en las facturas que la imprenta nos entrega para fijar los márgenes y determinar dónde poner los textos fijos que se deseen cambiar de la posición que viene predeterminada.
%
% El archivo |factura.def| tiene todas aquellas definiciones y valores que pueden ser ajustados; basta usarlos en nuestros documentos de la misma forma como están predefinidos allí; eso aplica no sólo para los de la geometría de la hoja sino para cualquier ajuste que esté en ese archivo o cualquier campo que tenga algún texto o palabra predefinida para la legislación venezolana.
%
%
% \section{Uso de la clase}
%
% El documento debe comenzarse con |\documentclass{factura}| con las opciones necesarias, que se explicarán en la sección \ref{sec:opciones}. Después se definen a través de macros {\bfseries en el preámbulo} todas las variables y dimensiones para personalizar el documento, esto es las posiciones de los textos fijos, tipos de letra (opcional), datos del cliente, un resumen (opcional), fecha y demás. Despues de |\begin{document}| va el cuadro de la factura propiamente, para lo cual la clase define un entorno llamado |factura|
% \DescribeEnv{factura}
% (|\begin{factura}...\end{factura}|), en cuyo interior se escriben únicamente los elementos a facturar a través de comandos del tipo |\Item|\footnote{Es posible incluir elementos gravados en IVA con alícuota general (12\%), alícuota reducida (8\%), alícuota adicional (22\%), así como también elementos exentos de impuesto al valor agregado, con \cs{Item}, \cs{ItemR}, \cs{ItemA} e \cs{ItemE} respectivamente.}, especificando su cantidad, descripción y precio unitario como argumentos, en ese orden.
%
% Finalizando el ambiente se puede escribir (opcionalmente) una descripción larga o una aclaratoria de lo que se factura; esto se hace con el comando |\Descripcion|.
%
% Algunas de las posibilidades de cambio de estilo de esta clase consisten en que puede cambiarse la forma como es presentado cualquiera de los textos, se pueden suprimir las líneas verticales del cuadro de la factura, se pueden agregar líneas horizontales separando cada ítem, también se puede dibujar una línea oblicua que proteja el cuadro de la factura de adiciones posteriores de texto, entre otras prestaciones más.
%
% Si el emisor lo desea puede digitalizar su firma personal y colocarla en el espacio ya dispuesto para firmar, con un ajuste mínimo para que salga correctamente sobre la línea.
%
% También el usuario tiene la posibilidad de producir una {\slshape ``prefactura''}; así le llamamos a un documento sin validez legal pero que puede ser enviado por fax o por correo electrónico. Este documento tiene el mismo aspecto de la factura fiscal si se digitaliza la forma libre vacía\footnote{Quitándole las numeraciones obviamente. También puede diseñarse en un |.tex| una forma libre vacía idéntica a la que se tiene, así como se hace en el ejemplo incluído.}, se incluye la imagen como fondo de la página y se definen las posiciones fijas de las numeraciones impresas en el talonario, es decir el número de factura y el número de control, de los que hablamos previamente.
%
% Esta misma clase tiene la posibilidad de imprimir un reporte largo asociado a la factura\footnote{Si lo hubiera, así como también se puede usar estar clase para elaborar un reporte sin asociarlo a una factura en particular.}. Tal reporte se escribe dentro de un ambiente en el mismo documento en el que se escribe la factura asociada a él (|\begin{reporte}...\end{reporte}|),
% \DescribeEnv{reporte}
% y con dar una opción al inicio se puede hacer que se impirma el reporte en las páginas siguientes a la factura, o también se puede hacer que se imprima sólo el reporte ignorando todo lo que está dentro del entorno |factura|, de la misma manera como también se puede hacer que se imprima sólo la factura ignorando el entorno |reporte|. Esto permite tener todo en un mismo documento e imprimir lo que se desee en el momento, o todo a la vez.
%
%
% \section{Compilación de un documento\label{sec:compila}}
%
% Para compilar una |factura| puede usar cualquiera de los motores \LaTeX, pdf\LaTeX, \XeLaTeX{} o \LuaLaTeX, naturalmente con las restricciones que impone cada uno.
%
% Hay casos en los que hace falta compilar más de una vez el documento. Dos veces necesita ser compilado un documento cuando alguna descripción en el cuadro de la factura ocupa más que una línea; también dos veces cuando se incluye una firma en el reporte, y más de dos veces cuando se pide que se dibuje una línea oblicua protectora del espacio restante en el cuadro de la factura.
%
%
% \section{Opciones al cargar la clase\label{sec:opciones}}
%
% Al cargar la clase con |\documentclass| se le puede dar opciones de la siguiente lista, para cambiar su comportamiento:
%
% {\setlength{\parindent}{0pt}
% \DescribeOption{prefactura}
%  La {\slshape ``prefactura''} es un documento no legal, preliminar, que no se imprime sobre papel de factura sino que está concebido para enviarse por correo o fax. Para eso se define la imagen que contiene el diseño de la factura con el comando |\FondoFactura|, luego la clase escribe la denominación ``FACTURA'' con su número\footnote{Lo predeterminado cuando no es una {\slshape ``prefactura''} sino una factura final es no escribir la denominación ni el número, ya que eso generalmente viene impreso en cada hoja del talonario.}. Esta opción implica la opción |sinfirmas|, ya que si es un documento preliminar sin validez legal, las firmas no son necesarias; sin embargo se puede cambiar este comportamiento con las opciones |dosfirmas| y |unafirma|.
%
% \DescribeOption{cotizacion}
%  La cotización es un documento similar a una factura pero no es un documento legal en el sentido de que no se imprime sobre talonario fiscal alguno, así que no lleva número de control y puede o no tener su propia numeración, que es cosa del emisor de la cotización. Esta opción implica la opción |unafirma|, para que firme el emisor de la factura, y si su nombre no se especifica saldrá ``Por el emisor'' debajo de la línea para firmar. También puede cambiarse esto con la opción |dosfirmas| o con |sinfirmas|.
%
% \DescribeOption{conreporte}
%  Genera la factura (prefactura o cotización) y luego el reporte.
%
% \DescribeOption{soloreporte}
%  Genera solamente el reporte, ignorando lo relacionado con la factura. Si no se especifica |conreporte| ni |soloreporte| se va a imprimir únicamente la factura.
%
% \DescribeOption{denom}
%  Con esta opción escribimos también el texto ``FACTURA'' con el número. La razón de esta opción es que hay formas libres que tienen la numeración de la factura y otras que solamente tienen el número de control; para las que tienen sólo el número de control existe esta opción que también escribe el número en cada factura impresa, en la posición que se defina.
%
% \DescribeOption{sinnumero}
%  Escribe el texto de la denominación del documento en su posición (e.g. ``COTIZACIÓN'') pero sin escribir el número; por ejemplo para las cotizaciones que no son documentos que legalmente lleven número, aunque el número puede ser para control interno. Esta opción implica la opción anterior |denom|.
%
% \DescribeOption{siniva}
%  No se cobra IVA, para los casos en los que eso aplique.
%
% \DescribeOption{sinivaexpresado}
%  Al no cobrar IVA, tampoco aparece en la totalización los IVA ni las bases imponibles.
%
% \DescribeOption{todosiva}
%  Agrega el monto exento y todos los tipos de IVA en los totales así no se hayan incluído elementos gravados con los distintos tipos de impuesto.
%
% \DescribeOption{G}
%  Agrega una ``|G|'' al lado de todos los items gravados con IVA general así sea el general el único IVA existente en la factura.
%
% \DescribeOption{impdesc}
%  Con esta opción, la letra que indica la denominación del impuesto aplicado a cada elemento, en lugar de escribirse en el precio unitario y en el total, que es la forma predeterminada, sale escrito al final de la descripción. Puede preferirse de esta forma, y ahorra un poco de espacio usable en la descripción porque ya no sale en dos lugares dicha letra sino en uno solo.
%
% \DescribeOption{numitem}
%  Con la opción |numitem| una nueva columna aparece en el cuadro de la factura donde se enumera cada ítem en el órden en el que se escriben dentro del entorno para la factura. Esto es útil por ejemplo cuando se hace referencia al número del ítem con el comando |\itemref|. Véase la sección \ref{sec:etiquetas}.
%
% \DescribeOption{sincantidad}
%  El ambiente |factura| tiene también la posibilidad de no mostrar el campo de la cantidad, ni aceptarlo como argumento de cada ítem; en ese caso los comandos |\Item| -de los que hablaremos en la sección \ref{sec:factura}- aceptan como argumentos solamente la descripción del elemento y su precio, en ese orden.
%
% \DescribeOption{descuentos}
%  Permite agregar un descuento en porcentaje por cada ítem de la factura, siendo dicho porcentaje el último argumento de los comandos |\Item|, que tendrá que ser incluído como ``0'' en los elementos donde no aplique tal descuento. (Explicado también en la sección \ref{sec:factura}).
%
% \DescribeOption{duc}
%  Cambia el orden de los campos en el documento impreso a: descripción, precio unitario, cantidad y precio total. {\itshape Esto no cambia la forma como deben especificarse los argumentos de |\Item| sino solamente cambiará cómo serán mostrados}.
%
% \DescribeOption{dcu}
%  Cambia el orden de los campos en el documento impreso a: descripción, cantidad, precio unitario y precio total\footnote{Sin \texttt{duc} ni \texttt{dcu}, el modo predeterminado es \texttt{cdu}: cantidad, descripción, precio unitario.}.
%
% \DescribeOption{unafirma}
%  No pone el espacio para que firme quien recibe el documento sino sólo el emisor; esto es lo predeterminado en las cotizaciones.
%
% \DescribeOption{sinfirmas}
%  No pone ninguna línea ni espacio para firmar; esto es lo predeterminado para las prefacturas.
%
% \DescribeOption{dosfirmas}
% Coloca las dos líneas para que firme quien emite y quien recibe. Esta opción es la predeterminada salvo en las prefacturas y en las cotizaciones.
%
% \DescribeOption{sincondiciones}
%  No pone el texto con las condiciones del documento.
%
% \DescribeOption{sinlineasve}
%  No aparecen las líneas verticales externas de los extremos del cuadro de la factura, es decir, las líneas verticales a la izquierda y a la derecha cerrando la tabla.
%
% \DescribeOption{sinlineasvi}
%  No aparecen las líneas verticales internas del cuadro de la factura, es decir, las líneas que separan las columnas.
%
% \DescribeOption{sinlineasv}
%  No aparece ninguna línea vertical en el cuadro de la factura.
%
% \DescribeOption{sinlineashe}
%  No aparecen las líneas horizontales externas en el cuadro de la factura, estas son la línea de arriba y la línea de abajo que abren y cierran la factura.
%
% \DescribeOption{sinlineashi}
%  No aparecen las líneas horizontales internas del cuadro de la factura, o sea, las líneas que separan los elementos a facturar del resto, y ese resto es: por arriba el título de cada columna, y por abajo la totalización.
%
% \DescribeOption{sinlineash}
%  No aparece ninguna línea horizontal en el cuadro de la factura.
%
% \DescribeOption{conlineasha}
%  Agrega una línea horizontal separando cada artículo o ítem de los demás dentro del cuadro de la factura, como las facturas hechas a mano que tienen un espacio dedicado para cada artículo.
%
% \DescribeOption{filas}
%  Muesta los totales finales en modo de filas; esto los presenta uno al lado del otro en lugar de uno debajo del otro.
%
% \DescribeOption{centrado}
%  Centra los totales finales ({\itshape sólo para el modo de totalización en filas}).
%
% \DescribeOption{agrupado}
%  Agrupa los totales finales de los items por gravamen ({\itshape sólo para el modo de totalización en columnas}).
%
% \DescribeOption{exparriba}
%  Expande el espacio de arriba, es decir, rellena el espacio restante del cuadro de la factura con espacio en blanco. Lo predeterminado es expandir la parte de abajo, o sea, la descripción cuando la hay.
%
% \DescribeOption{sinexpandir}
%  No expande partes en la factura, es decir, deja tanto el cuadro de la factura como la descripción en su tamaño mínimo según el contenido que tenga.
%
% \DescribeOption{linea}
%  Agrega una línea diagonal protegiendo los espacios vacíos en el cuadro de la factura. Esta opción requiere de la opción |exparriba|.
%
% \DescribeOption{nospanish}
%  No carga |babel| en castellano\footnote{Por ejemplo para cargar {\ttfamily polyglossia} en su lugar.}, la codificación |T1| de las letras ni el paquete |lmodern|. Si no se especifica esta opción todo esto se carga, pero si se quiere no cargar algo de esto, entonces debe especificarse esta opción y cargar los demás paquetes a mano.
%
% \DescribeOption{csv}
%  Escribe un archivo csv con la información numérica de la factura.
%
%  \todo*{Hay problemas con la codificación en el archivo |csv| cuando hay comandos frágiles a escribir.}
%
% \DescribeOption{twoside}
%  Establece que el reporte se imprime por los dos lados del papel. (Naturalmente se ignora esta opción cuando el motor no va a generar un reporte puesto que las facturas ocupan una hoja solamente).
% }
%
% \section{Principales comandos que la clase provee\label{sec:comandos}}
%
% A continuación descrirebimos los principales comandos de esta clase; en rojo aparecen aquellos pocos comandos que son de obligatorio uso. Los que no son de obligatorio uso es porque tienen algún valor predeterminado en |factura.def| o porque controlan algún aspecto opcional.
%
% {\setlength{\parindent}{0pt}
% \DescribeMacro{\GeometriaFactura}{\color{RoyalBlue}|\GeometriaFactura|\marg{geometría}}
%
%  Aquí van los parámetros relativos al paquete |geometry| que van a afectar la manera como la factura es generada. Como dijimos al principio, deberá especificarse el tipo de papel (e.g. |letterpaper|, |legalpaper|, |executive|, |a4paper|, ...) y los márgenes verticales y horizontales.
%
%  Para especificar el margen superior debe medirse desde el inicio del papel hasta donde se quiera establecer que empiece el recuadro de los datos del cliente, y el margen inferior debe medirse desde el final del papel hasta donde terminaría la opcional descripción.
%
% \DescribeMacro{\GeometriaReporte}{\color{RoyalBlue}|\GeometriaReporte|\marg{geometría}}
%
%  Aquí van los parámetros relativos al paquete |geometry| que van a afectar la manera como el reporte es generado.
%
% Puesto que el reporte no se imprime en hojas de facturas sino en hojas en blanco, el usuario podrá cambiar la geometría del papel completamente a su gusto sin las restricciones impuestas por el diseño que tengan sus facturas. En |factura.def| se definen unos márgenes razonables para un reporte. Si el reporte y la factura usaran un tamaño distinto de papel, entonces al imprimirse ambos juntos (opción |conreporte|), el reporte tomará el tamaño físico del papel especificado para la factura ya que con el paquete |geometry| no podemos cambiar el tamaño del papel en el medio del documento, aunque sí sus márgenes. Entonces, si se quiere imprimir el reporte en un papel de otro tamaño, tendrán que imprimirse ambos documentos por separado, o sea, primero uno y después el otro.
%
% \DescribeMacro{\FondoFactura}{\color{RoyalBlue}|\FondoFactura|\marg{nombre del archivo de la imagen}}
%
%  Nombre del archivo de la imagen a cargar como diseño, especialmente para las {\slshape prefacturas}, aunque también puede usarse como una ``marca de agua'' para las facturas.
%
%  Lo que recomendamos es digitalizar la forma libre o pedir a la imprenta un archivo digital con el diseño y así incluir esa imagen con este comando cuando se vayan a producir ``prefacturas'' o cotizaciones, así las prefacturas tienen el mismo diseño que las facturas. Si se puede lograr el diseño en un código como se hace con el ejemplo del fondo, pues mejor aún.
%
% \DescribeMacro{\FondoReporte}{\color{RoyalBlue}|\FondoReporte|\marg{nombre del archivo de la imagen}}
%
%  Imagen a cargar {\bfseries solamente en la primera página del reporte} (e.g. un membrete). Cuando se usa este comando puede necesitarse usar también |\InicioReporte| para fijar el inicio de la primera página del reporte más abajo que las demás páginas cuyos márgenes están establecidos con |\GeometriaReporte|; esto porque la primera página tendría un ``margen superior'' distinto por la existencia del membrete.
%
% \DescribeMacro{\FondoReporte*}{\color{RoyalBlue}|\FondoReporte*|\marg{nombre del archivo de la imagen}}
%
%  Esta variante de |\FondoReporte| es para que la imagen esté visible {\bfseries en todas las páginas} y no solamente en la primera como con el comando anterior. Usando esta variante del fondo del reporte no es necesario usar |\InicioReporte| sino solamente establecer los márgenes del reporte de acuerdo a dicho fondo.
%
% \DescribeMacro{\EstiloPagReporte}{\color{RoyalBlue}|\EstiloPagReporte|\oarg{estilo primera página}\marg{estilo páginas restantes}}
%
% Con este comando definimos el estilo de página para el reporte (véase el comando |\InfoPagina| y la subsección \ref{subsec:pagestyle}). El estilo de página es lo que cambiamos en \LaTeX{} con |\pagestyle|, o sea, lo relativo a las cabeceras y piés de página.
%
% Con este comando podemos asignar un estilo de página para la primera página del reporte y otro estilo de página para el resto de las páginas. La primera página del reporte pudiera tener un estilo de página distinto por la presencia del membrete si se usa el comando |\FondoReporte| sin ``|*|'', por lo cual puede quererse no poner cabeceras en la primera página pero sí en las demás.
%
% Como vemos de la sintaxis de esta macro, el argumento obligatorio es el del resto de las páginas y el opcional es el que aplica a la primera página. El opcional se pone entre corchetes antes del otro, pero si se omite, todas las páginas toman el estilo especificado entre llaves.
%
% Si no se usa esta macro la clase asume un comportamiento apropiado teniendo en cuenta si se especifica |\FondoReporte| o |\FondoReporte*| para evitar solapamiento de textos, como se explica también en la subsección \ref{subsec:pagestyle}.
%
% La información que aparece como cabecera o como pié de página es la que damos con el comando |\InfoPagina|, explicado más adelante.
%
% La clase provee varios estilos de página, que también se explicarán en la subsección destinada para ello. En los ejemplos de reportes se puede ver el comportamiento del comando |\EstiloPagReporte|.
%
% \DescribeMacro{\InicioReporte}{\color{RoyalBlue}|\InicioReporte|\marg{longitud}}
%
%  Con este comando -cuyo argumento es una longitud de \LaTeX{}- se agrega una distancia extra donde inicia el texto en la primera página del reporte cuando se usa |\FondoReporte| sin ``|*|''. Este comando sólo aplica cuando en el reporte se fija un fondo para que salga solamente en la primera página (comando |\FondoReporte| en su versión sin ``|*|''). La motivación de esto es corregir la alteración que produce un membrete que va a salir solamente en la primera página; si el membrete estuviera en todas las páginas no es necesario hacer esto sino fijar los márgenes adecuadamente con |\GeometriaReporte|. Si en el reporte no se fija un fondo o se fija el fondo para todas las páginas (comando |\FondoReporte*|), lo que se establezca con |\InicioReporte| es ignorado. En estos dos casos los márgenes deben establecerse con |\GeometriaReporte|.
%
% \DescribeMacro{\FirmaFactura}{\color{RoyalBlue}|\FirmaFactura|\marg{inclusión de la imagen}\oarg{corrimiento en x}\oarg{corrimiento en y}}
%
%  Incluye el archivo de la firma digitalizada en el espacio donde firma el emisor del documento. Los argumentos son:
%  \begin{enumerate}
%   \item inclusión de la imagen (e.g. |\includegraphics|). {\bfseries Aquí el primer argumento no es el archivo de la imagen sino el comando que la inserta en el documento}, así el usuario tiene más control sobre cómo saldrá la imagen si altera las opciones de |\includegraphics|.
%   \item corrimiento en |X| de la imagen, para un ajuste más fino de la posición de la firma,
%   \item corrimiento en |Y|.
%   \end{enumerate}
%  {\itshape (Sin especificar los corrimientos, la firma quedará centrada horizontalmente en la línea, dejando hacia la izquiera y hacia la derecha la misma cantidad de la línea. También quedará toda la firma encima de la línea, lo cual muy probablemente haya que corregirlo porque las firmas tienen ``profundidad'' de texto, que significa que hay parte de algunas letras que sobresalen hacia abajo respecto a la línea base del texto. Por todo esto es muy probable el uso de los corrimientos. Pueden verse los ejemplos, que allí se usan los corrimientos.)}
%
%  {\bfseries Las facturas no llevan firma porque se supone que el documento es auténtico ya que viene avalado por una imprenta registrada y tiene los números correlativos impresos desde la imprenta, de manera que la factura no necesita la firma de quien la emite; razón por la cual el texto debajo de la línea del emisor en la factura dice ``PAGADO'', porque el emisor firma la factura una vez que haya sido pagada como constancia para el cliente.} Entonces agregar la firma escaneada es una posibilidad que debe contemplarse solamente con las cotizaciones, usando también el comando |\Emisor|, ya que no nos interesaría que apareciera ``PAGADO'' en ese caso sino algún nombre de quien está emitiendo la cotización.
%
% \DescribeMacro{\FirmaReporte}{\color{RoyalBlue}|\FirmaReporte|\oarg{inclusión la imagen}\oarg{corr. en x}\oarg{corr. en y}\marg{texto}\oarg{pos. x}\oarg{long. línea}}
%
%  Incluye la firma para el final del reporte. Los argumentos son:
%  \begin{enumerate}
%   \item inclusión de la imagen (e.g. |\includegraphics|),
%   \item corrimiento en |X| de la imagen, para un ajuste más fino de la posición de la firma,
%   \item corrimiento en |Y|,
%   \item texto debajo de la línea ({\itshape va entre llaves y no entre corchetes como los demás}. Pred: el dado mediante el comando |\Proveedor|, o en su defecto, |\Emisor|),
%   \item posición en |X| del final de la línea, medida desde la derecha (predeterminado: 2cm),
%   \item tamaño de la línea de la firma (pred: tamaño de la imagen o del nombre + 1.5cm extra).
%  \end{enumerate}
%  {\itshape {\bfseries Este comando es de los pocos que no es del preámbulo}; debe incluirse en el sitio en el reporte donde se quiera que la firma salga, es decir, al final del reporte y todos sus argumentos son opcionales, incluyendo el texto que va debajo de la línea, que se incluye entre llaves |{}| a pesar de ser opcional. Cuando no se especifica ningún argumento, sólo dibuja la línea para firmar y le escribe abajo el nombre dado con |\Proveedor| o en su defecto el dado con |\Emisor|.}
%
% \DescribeMacro{\TituloReporte}{\color{RoyalBlue}|\TituloReporte|\marg{texto}}
%
%  Especificamos un título para el reporte. Este título saldrá centrado al principio.
%
% \DescribeMacro{\TituloReporte*}{\color{RoyalBlue}|\TituloReporte*|\marg{texto}}
%
%  Usando |\TituloReporte| u omitiendo su uso, la información que sale en las cabeceras o piés de página tiene que ver con el número de la factura que está asociada a ese reporte. Con esta variante de |\TituloReporte|, el título del reporte -especificado con este comando- saldrá escrito también en estas partes de la página en lugar del texto que indica que el reporte corresponde a determinada factura.
%
% Puede usarse esta opción también en aquellos casos en los que se hace un reporte sin asociarlo a una factura, entonces el título del reporte es la información que sale en la cabecera o pie de cada página.
%
% \DescribeMacro{\InfoPagina}{\color{RoyalBlue}|\InfoPagina|\marg{texto}}
%
%  Establece el texto que aparece en la cabecera o pie de página del reporte.
%
% {\itshape Si se quiere usar esta opción debe hacerse luego de definir el título del reporte porque si no el comando |\TituloReporte*| establece de nuevo la variable que |\InfoPagina| cambia.}
%
% En |factura.def| hay dos definiciones relativas a la información que aparece en las cabeceras o piés de página: aquella que escribe el título y aquella que no, es decir, la que aplica con |\TituloReporte*| y la que aplica con |\TituloReporte|, que también el usuario podrá redefinir si lo necesita, pero lo más práctico sería usar esta macro para fijar el texto que se desee, y |\EstiloPagReporte| para fijarlo donde se quiera.
%
% \DescribeMacro{\RazonSocial}{\color{Red}|\RazonSocial|\marg{texto}}
%
%  Define la razón social, o sea, el nombre del cliente.
%
% \DescribeMacro{\Nombre}{\color{Red}|\Nombre|\marg{texto}}
%
%  Similar a |\RazonSocial| pero usable más bien para personas naturales, donde no existe una ``persona de contacto'' y por tanto la clase no advierte de su ausencia si no se ha especificado con |\Contacto|. Naturalmente se especifica un solo nombre del cliente, es decir que si se especifica con |\RazonSocial| no hace falta usar este comando. {\itshape Es preferible usar |\RazonSocial|.}
%
% \DescribeMacro{\RIF}{\color{Red}|\RIF|\marg{texto}}
%
%  Define el RIF del cliente.
%
% \DescribeMacro{\CI}{\color{Red}|\CI|\marg{texto}}
%
%  Especifica la cédula de identidad del cliente al ser persona natural. {\itshape Es preferible usar siempre |\RIF|.}
%
% \DescribeMacro{\Contacto}{\color{RoyalBlue}|\Contacto|\marg{texto}}
%
%  Define una persona de contacto (e.g. nombre de una persona cuando el cliente no es personal).
%
% \DescribeMacro{\Direccion}{\color{Red}|\Direccion|\marg{texto}}
%
%  Define la dirección fiscal del cliente.
%
% \DescribeMacro{\Telefono}{\color{Red}|\Telefono|\marg{texto}}
%
%  Especifica el (o los) teléfonos del cliente.
%
% \DescribeMacro{\Email}{\color{RoyalBlue}|\Email|\marg{texto}}
%
%  Establece el e-mail del cliente.
%
% \DescribeMacro{\Conforme}{\color{RoyalBlue}|\Conforme|\marg{texto}}
%
%  Especifica el texto que aparecerá debajo de la línea para que firme el cliente; si no se especifica tomará el texto por omisión, que es ``Recibí conforme'', indicando que el cliente le firma una copia al emisor de la factura donde acepta haber recibido y estar conforme. Este texto puede cambiarse a otro que puede ser el nombre del cliente o la persona de contacto.
%
% \DescribeMacro{\Emisor}{\color{RoyalBlue}|\Emisor|\marg{texto}}
%
%  Define el nombre del emisor de la factura. Si no se especifica saldrá el texto ``PAGADO''\footnote{El texto ``PAGADO'' es lo que la legislación venezolana del SENIAT exige escribir cuando una factura haya sido pagada.} debajo de la línea para firmar, ya que la factura se firma cuando haya sido pagada. Si se especifica un texto con este comando saldrá ese texto debajo de la línea donde va la firma, pero el propósito es que quede constancia para el cliente que ya pagó la factura, razón por la cual el texto predeterminado es el de ``PAGADO''.
%
% \DescribeMacro{\Proveedor}{\color{RoyalBlue}|\Proveedor|\marg{texto}}
%
%  Establece el nombre del emisor, para los efectos del reporte. Si no se define mediante esta macro, será tomado del establecido con |\Emisor|.
%
% \DescribeMacro{\Fecha}{\color{Red}|\Fecha|\marg{fecha}}
%
%  Especifica la fecha de emisión del documento, en el formato venezolano DD/MM/AAAA.
%
% \DescribeMacro{\Descuento}{\color{RoyalBlue}|\Descuento|\marg{porcentaje}}\\
% \DescribeMacro{\Descuento*}{\color{RoyalBlue}|\Descuento*|\marg{monto}}
% \todo*{Las macros \cs{Descuento***} no son compatibles con la opción de totalización en modo de filas.}
%
%  Efectúa un descuento\footnote{Estas opciones de descuento en el subtotal no son compatibles con la opción de totalización en modo de |filas|, explicada en la sección \ref{sec:opciones}.} en el subtotal dado en porcentaje (versión sin *) o dado en un monto fijo a sustraer del subtotal (variante con *). Con este comando el descuento aplicaría por igual a cualquier subtotal presente, es decir, para elementos con cualquier gravamen y también exentos. Dichos descuentos son aplicados y mostrados al totalizar. Puede usarse inclusive cuando se aplican descuentos individuales que se incluyen con la opción de la clase |descuentos|.
%
% \DescribeMacro{\DescuentoG}{\color{RoyalBlue}|\DescuentoG|\marg{porcentaje}}\\
% \DescribeMacro{\DescuentoG*}{\color{RoyalBlue}|\DescuentoG*|\marg{monto}}
%
% Descuento específico para los elementos gravados con IVA general.
%
% \DescribeMacro{\DescuentoR}{\color{RoyalBlue}|\DescuentoR|\marg{porcentaje}}\\
% \DescribeMacro{\DescuentoR*}{\color{RoyalBlue}|\DescuentoR|*\marg{monto}}
%
%  Descuento específico para los elementos gravados con IVA reducido.
%
% \DescribeMacro{\DescuentoA}{\color{RoyalBlue}|\DescuentoA|\marg{porcentaje}}\\
% \DescribeMacro{\DescuentoA*}{\color{RoyalBlue}|\DescuentoA*|\marg{monto}}
%
%  Descuento específico para los elementos gravados con IVA adicional.
%
% \DescribeMacro{\DescuentoE}{\color{RoyalBlue}|\DescuentoE|\marg{porcentaje}}\\
% \DescribeMacro{\DescuentoE*}{\color{RoyalBlue}|\DescuentoE*|\marg{monto}}
%
%  Descuento específico para los elementos exentos de IVA.
%
% \DescribeMacro{\Num}{\color{RoyalBlue}|\Num|\marg{núm}}
%
%  Define el número de la factura. Es opcional porque el talonario de las facturas puede ya tener la numeración. Es de obligatorio uso cuando se define |denom|, o |prefactura| sin usar |sinnumero|.
%
% \DescribeMacro{\NumControl}{\color{RoyalBlue}|\NumControl|\marg{núm}}
%
%  Define el número de control de la factura. Esta opción sólo aplica con |prefactura| puesto que una factura fiscal siempre tiene el número de control impreso desde la imprenta. Si se usa |prefactura| y no se define el número de control, éste tomará el mismo número de la factura.
%
% \DescribeMacro{\NumSerieControl}{\color{RoyalBlue}|\NumSerieControl|\marg{núm}}
%
%  Define el número de serie del número de control, también aplica solamente con |prefactura|. Si no se especifica, toma |00|.
%
% \DescribeMacro{\Denom}{\color{RoyalBlue}|\Denom|\marg{texto}}
%
%  Cambia el nombre del documento a algo distinto de ``FACTURA'' o ``COTIZACIÓN''.
%
% \DescribeMacro{\Condiciones}{\color{Red}|\Condiciones|\marg{texto}}
%
%  Con este comando se establece el texto que esclarece las condiciones del documento, por ejemplo para las condiciones de pago si se trata de una factura, o para las condiciones de una cotización. Este comando es de obligatorio uso salvo cuando la clase se cargue con la opción |sincondiciones|. También se puede destinar este espacio para un diseño (que haría el usuario) en el que se agreguen también algunas casillas para especificar la forma de pago.
%
% \DescribeMacro{\Resumen}{\color{RoyalBlue}|\Resumen|\marg{texto}}
%
%  Pone un resumen que va en una caja a la derecha de los datos del cliente, separado de esta en una distancia ajustable con el comando |\SepEncabez|, que se describirá más adelante. Este resumen es opcional.
%
% }
%
%
% \section{La factura\label{sec:factura}}
%
% \DescribeEnv{factura}
% La parte del documento donde se agregan los elementos a facturar no se escribe en el preámbulo sino luego de |\begin{document}|, dentro de un ambiente especial para su tratamiento, llamado |factura|, que produce el cuadro de la factura, y naturalmente se usa así:
% \iffalse
%<*literal>
% \fi
\begin{verbatim}
\begin{factura}
 ...
\end{factura}
\end{verbatim}
% \iffalse
%</literal>
% \fi
%
% Dentro de dicho ambiente tenemos únicamente los comandos que incluyen los elementos a facturar; esos comandos son, para distintos gravámenes, los siguientes:
%
% \subsection{Agregando elementos a la factura}
%
% \noindent
% \DescribeMacro{\Item}
% \DescribeMacro{\ItemR}
% \DescribeMacro{\ItemA}
% \DescribeMacro{\ItemE}
% {\color{Red}|\Item|\marg{cantidad}\marg{descripción}\marg{precio unitario}}
%
% Con estos comandos agregamos elementos a la factura propiamente dicha. Con |\Item| agregamos un elemento gravado con IVA general (actualmente 12\%); con |\ItemR| agregamos uno con IVA reducido (8\%), con |\ItemA| uno con IVA adicional (22\%), y con |\ItemE| agregamos un elemento exento de impuesto al valor agregado.
%
% También tenemos la posibilidad de agregar un ítem al que no le ponemos precio, por ejemplo por ser parte de un total, y sus argumentos son la cantidad y la descripción nada más.
%
% \noindent
% \DescribeMacro{\ItemX}{\color{RoyalBlue}|\ItemX|\marg{cantidad}\marg{descripción}}
%
% \subsubsection{Opción `{\ttfamily descuentos}'\label{subsec:descuentos}}
%
% \noindent
% \DescribeMacro{\Item}
% \DescribeMacro{\ItemR}
% \DescribeMacro{\ItemA}
% \DescribeMacro{\ItemE}
% {\color{Red}|\Item|\marg{cantidad}\marg{descripción}\marg{precio unitario}\marg{\% descuento}}
%
% Cuando pedimos descuentos individuales (opción |descuentos| al cargar la clase), todas las macros |\Item| requieren de un argumento más al final, que es el descuento porcentual, y deberá especificarse como |0| en los elementos en los que no haya descuento:
%
% \subsubsection{Opción `{\ttfamily sincantidad}'\label{subsec:sincantidad}}
%
% \noindent
% \DescribeMacro{\Item}
% \DescribeMacro{\ItemR}
% \DescribeMacro{\ItemA}
% \DescribeMacro{\ItemE}
% {\color{Red}|\Item|\marg{descripción}\marg{precio unitario}}
%
% \noindent {\color{Red}|\Item|\marg{descripción}\marg{precio unitario}\marg{\% descuento}}
%
% Por otra parte, si se usa la opción |sincantidad| al cargar la clase, todos los comandos |\Item| aceptan un argumento menos, que es el de la cantidad; eso significa que sin usar la opción |descuentos|, la sintaxis de |\Item| queda como lo indica la primera línea, y usando |descuentos|, queda como lo indica la segunda línea.
%
% \noindent
% \DescribeMacro{\ItemX}{\color{RoyalBlue}|\ItemX|\marg{descripción}}
% 
% Puesto que |\ItemX| se usa para argumentos sin precio, al usar |sincantidad| quedará aceptando solo un argumento, que es la descripción. Cuando se activa la opción |descuentos|, |\ItemX| queda igual puesto que esta macro no lleva precio, entonces tampoco acepta descuentos.
%
% {\itshape Todas las variaciones de estos comandos |\Item| pueden apreciarse en los ejemplos.}
%
% \subsection{Descripción larga al final de la factura}
%
%
% Una vez terminado el ambiente de la factura se puede escribir una descripción larga que saldrá en una caja -cuyo estilo puede cambiarse- debajo del cuadro de la factura. Si esta descripción no se escribe, simplemente no va a aparecer nada debajo del cuadro de la factura.
%
% \noindent \DescribeMacro{\Descripcion}
% {\color{RoyalBlue}|\Descripcion|\marg{texto en formato de párrafos}}
%
% {\itshape Como podemos ver, |\Descripcion| es otro de los pocos comandos que no se usan en el preámbulo sino que se escribe jústamente al terminar el ambiente} |factura|.
%
% \section{El reporte}
%
% \DescribeEnv{reporte}
% Para elaborar un reporte, lo único que se debe hacer es escribir el texto del reporte dentro del ambiente para ese fin, que se llama |reporte|, de manera que en el documento tenemos un ambiente para la factura y otro para el reporte, eligiendo al momento de compilar qué es lo que queremos obtener.
%
% \iffalse
%<*literal>
% \fi
\begin{verbatim}
\begin{reporte}
 (Aquí va el reporte, sin límite la extensión del texto.)
\end{reporte}
\end{verbatim}
% \iffalse
%</literal>
% \fi
%
% Cuando se compila con |conreporte|, el reporte sale desde la segunda página, o desde la tercera si se usa |twoside|.
%
% Cuando se compila con |soloreporte|, el motor de compilación no procesa la factura en favor del reporte, y sin especificar ninguna de estas dos opciones, el reporte es ignorado y sale únicamente la factura (o la prefactura o cotización).
%
% Hay que tener en cuenta que, como se explicó en la sección \ref{sec:comandos}, el reporte puede tener una imagen de fondo, que puede ser un membrete. Ese membrete, si se quiere en todas las páginas deberá incluirse con |\FondoReporte*|, y si se quiere sólo en la primera página del reporte deberá usarse |\FondoReporte|. Ahora, si se usa la versión sin |*|, será necesario también usar |\InicioReporte| con una distancia para empezar a escribir un poco más abajo en la primera página, ya que es la única que tiene el membrete. Pero si se usa la versión con |*|, entonces basta fijar los márgenes para todas las páginas con |\GeometriaReporte|, tal como se adelantó en la sección \ref{sec:comandos}.
%
% Por otra parte, al reporte se le asigna un título, que puede aparecer o no en la cabecera de página o en el pie de página. Si se quiere que aparezca el título en esos lugares, debe usarse |\TituloReporte*|, de lo contrario, |\TituloReporte|. Si no se especifica el título, entonces la información mostrada allí es la referencia a la factura asociada a este reporte, como se comentó antes cuando se introdujeron estos comandos.
%
% \subsection{Estilos de página para el reporte\label{subsec:pagestyle}}
%
% La clase define varios estilos de página\footnote{Usables en el reporte únicamente.} de \LaTeX{}, cambiables con los comandos usuales: |\pagestyle| y |\thispagestyle| dentro del entorno del reporte, pero es mejor definir el estilo de página en el preámbulo del documento, con |\EstiloPagReporte|.
%
% Estos estilos de página son: \begin{inparaenum}[\bfseries i)]\item |plain|, \item |empty|, \item |soloarriba|, \item |soloabajo|, y \item |solonumpag|\end{inparaenum}.
%
% Con |plain|\footnote{Por razones de compatibilidad usamos dos estilos de página conocidos en \LaTeX, que son |plain| y |empty|, siendo |plain| uno de nuestros predeterminados.}, en la cabecera saldrá la información sobre el reporte y en el pie de página saldrá el número de página; con |empty| no sale nada en ninguna parte; con |soloarriba| y |soloabajo|, toda esa información anterior sale en la cabecera o en el pie de página, respectivamente, y con |solonumpag|, lo único que aparece es el número de página centrado en el pie de página.
%
% El formato con la información a poner en estas partes de las páginas del reporte es cambiable con |\InfoPagina|, descrito anteriormente.
%
% Por último, cuando se usa |\FondoReporte*|, como se supone que se usa para un membrete en todas las páginas, el estilo de página predeterminado del reporte será |soloabajo|, para todas las páginas, porque no tendría sentido tener un membrete en todas las páginas y una cabecera como la descrita anteriormente. Si el comando |\FondoReporte*| se está usando para algo distinto de un membrete, por ejemplo una marca de agua, entonces es probable querer cambiar los estilos de página con |\EstiloPagReporte|.
%
% Si se usa |\FondoReporte|, el estilo predeterminado para la primera página será |solonumpag|, y |plain| para el resto de las páginas, y si se no se especifica fondo alguno, entonces el estilo de página predeterminado para todas las páginas será |plain|.
%
% El usuario podrá definir más estilos de página adicionales para colocar el texto que se quiera en el lugar que se quiera, y usar esos estilos de página con |\EstiloPagReporte|. Para eso puede leer la documentación del paquete |fancyhdr|, que es lo que esta clase usa para los estilos de página. También puede consultar |factura.def|.
%
% \section{Elementos fijos y sus ubicaciones}
%
% Los elementos cuyas posiciones van fijas en la hoja disponen de macros para establecer sus ubicaciones. Todas estas macros empiezan por |\Pos|, y son las siguientes: |\PosFecha|, |\PosDenom|, |\PosControl|, |\PosCond| y |\PosFirmas|.
%
% Todos estos comandos aceptan como argumentos dimensiones de \LaTeX{}, y son las posiciones |(x,y)| en la página de los elementos a imprimir, siendo ``|x|'' la coordenada a lo ancho del papel y ``|y|'' la coordenada a lo largo del papel, es decir, horizontal y vertical respectivamente. El origen está fijado arriba a la izquierda. Se pueden especificar también valores negativos para denotar que estamos contando desde el extremo derecho o inferior, para el caso de ``|x|'' y ``|y|'', respectivamente\footnote{Varias de estas variables están definidas de esta forma negativa en el archivo de definiciones.}.
%
% Por ejemplo, si queremos que la fecha aparezca |5cm| desde arriba hacia abajo, haríamos: |\PosFecha{0cm}{5cm},| y si queremos que salga |1cm| desde la derecha y |4cm| contados desde abajo haríamos |\PosFecha{-1cm}{-4cm}|. A continuación todas las macros para fijar las posiciones en el papel:
%
% {\setlength{\parindent}{0pt}
% \DescribeMacro{\PosFecha}{\color{RoyalBlue}|\PosFecha|\marg{pos. x}\marg{pos. y}}
%
% Con |\PosFecha| controlamos dónde se ubica la caja que imprime la fecha en la hoja.
%
% \DescribeMacro{\PosDenom}{\color{RoyalBlue}|\PosDenom|\marg{pos. x}\marg{pos. y}}
%
% Con |\PosDenom| controlamos dónde se ubica la caja que imprime la denominación del documento (e.g. ``FACTURA'', ``COTIZACIÓN'') y su -opcional- número.
%
% \DescribeMacro{\PosControl}{\color{RoyalBlue}|\PosControl|\marg{pos. x}\marg{pos. y}}
%
% Con |\PosControl| controlamos dónde se ubica la caja que imprime el número de control con la serie.
%
% \DescribeMacro{\PosCond}{\color{RoyalBlue}|\PosCond|\marg{pos. x}\marg{pos. y}}
%
% Con |\PosCond| controlamos dónde se ubica el texto de las condiciones del documento (está hecho con |\parbox|, acepta un párrafo como argumento) en la hoja. {\itshape {\bfseries La coordenada |X| no acepta valores negativos} porque el |\parbox| que coloca el texto con las condiciones llega siempre hasta el final del ancho del texto, o sea, hasta el margen derecho.}
%
% \DescribeMacro{\PosFirmas}{\color{RoyalBlue}|\PosFirmas|\marg{pos. x-inicial}\marg{pos. x-final}\marg{pos. y}}
%
% Con |\PosFirmas| controlamos dónde se ubica la caja que dibuja las lineas para firmar en la factura. {\itshape Aquí delimitamos el intervalo en |X| donde van las firmas, por eso hay una coordenada inicial y una final. La inicial indica dónde empieza la primera linea (para que firme quien recibe), y la coordenada final establece dónde termina la segunda linea para firmar (para que firme el emisor de la factura), que va a estar al lado de la primera. Aquí las coordenadas |X| no aceptan valores negativos; la inicial va medida desde el margen izquierdo y la final va medida desde el margen derecho.}
%
% }
%
% \section{Otros ajustes en el diseño}
%
% {\setlength{\parindent}{0pt}
% Todos los siguientes comandos también aceptan como argumentos dimensiones de \LaTeX{}:
%
% \DescribeMacro{\SepElementos}{\color{RoyalBlue}|\SepElementos|\marg{sep. vertical}}
%
% Las distintas partes de la factura (a saber: el encabezado con los datos, el cuadro de la factura y la -opcional- descripción) también están separadas una distancia que puede ser cambiada.
%
% La separación que se fija aquí es la mínima que queremos garantizar, y puede ser ajustada automáticamente por la clase aumentándola cuando no hay relleno automático de espacios sobrantes (es decir, sin usar la opción |sinexpandir|). Cuando la descripción (sin opciones de expansión) o el cuadro de la factura (usando la opción |exparriba|) toman su tamaño máximo, entonces la separación vertical entre cada elemento de la hoja es la dada con |\SepElementos|, o sea, la que queremos garantizar como la mínima separación entre esas partes.
%
% \DescribeMacro{\SepEncabez}{\color{RoyalBlue}|\SepEncabez|\marg{sep. en encabezado}\marg{sep. interna texto}}
%
% Las cajas donde van los datos del cliente y el resumen están separadas entre sí una distancia controlable con el primer argumento de |\SepEncabez|. Obviamente, si no se escribe un resumen saldría unícamente la caja de los datos del cliente, y esta separación no tendría efecto. El segundo argumento de |\SepEncabez| nos permite controlar la distancia entre la línea del recuadro y el texto, es decir, un margen interno entre el contorno de la caja y el texto que hay dentro para que no salga pegado a la línea que lo encierra.
%
% \DescribeMacro{\SepDescrip}{\color{RoyalBlue}|\SepDescrip|\marg{sep. interna texto}}
%
% Con este comando controlamos la distancia entre la línea del recuadro de la descripción y el texto, o sea, el margen interno del cuadro de la descripción, tal como lo definimos para el caso anterior.
%
% \DescribeMacro{\SepFilas}{\color{RoyalBlue}|\SepFilas|\marg{sep. en x}\marg{sep. en y}}
%
% Cuando se usa el modo de totalización en filas tenemos también la posibilidad de cambiar la separación entre los totales que salen uno al lado del otro, y la separación entre las distintas líneas.
%
% El primer argumento de |\SepFilas| es la separación horizontal {\itshape mínima} entre los distintos totales que se presentan en el modo de totalización en filas. La clase |factura| expande esa distancia para que queden todos los totales separados igual, y también separados igual de los márgenes del papel.
%
% El segundo argumento de |\SepFilas| es la separación vertical entre las distintas líneas de la totalización en filas.
%
% \DescribeMacro{\LineaEncabez}{\color{RoyalBlue}|\LineaEncabez|\marg{grosor}\marg{curva. esquinas}\marg{tam. sombra}}
%
% Con el primer argumento de este comando cambiamos el grosor de la línea con la que las cajas del encabezado se dibujan, con el segundo argumento cambiamos la curvatura de las esquinas, y con el tercero el tamaño de la sombra\footnote{Todas las sombras salen hacia abajo a la derecha.}.
%
% \DescribeMacro{\LineaDescrip}{\color{RoyalBlue}|\LineaDescrip|\marg{grosor}\marg{curva. esquinas}\marg{tam. sombra}}
%
% Con el primer argumento de |\LineaDescrip| ajustamos el grosor de la línea con la que la descripción larga se dibuja, con el segundo argumento cambiamos la curvatura de las esquinas, y con el tercero el tamaño de la sombra.
%
% \DescribeMacro{\LineaFirmas}{\color{RoyalBlue}|\LineaFirmas|\marg{long. línea}\marg{grosor}}
%
% La longitud de la líneas para firmar y el grosor son también ajustables por medio del primer y segundo argumento, respectivamente, de la macro |\LineaFirmas|.
%
% }
%
% \section{Tipografías para cada elemento a escribir}
%
% Cada elemento escrito en la factura o reporte es sujeto a ser mostrado con una tipografía distinta, para lo cual existen comandos con los que se asigna el tipo de letra o estilo para cada cosa que sale escrita en el documento, por ejemplo, se puede cambiar el tipo de letra con el que se escribe la fecha, el tipo de letra con el que salen los elementos dentro del cuadro de la factura, el tipo de letra de los totales, de los títulos, de las cabeceras o piés de página en el reporte, etc.
%
% Cuando en lo sucesivo nos referiremos a tipografía, tipo de letra, o letra, nos estaremos refiriendo a cualquier cambio en la tipografía que pueda significar el nombre de la letra, su tamaño o atributos como negritas, es decir, mediante cualquiera de estos comandos podemos cambiar cualquier aspecto de la tipografía. Mirando el archivo |.def| pueden verse todos los valores predeterminados, que la mayoría de ellos son simplemente cambios en el tamaño (macro |\fontsize| de \LaTeX{}), y en algunos casos negritas.
%
% {\setlength{\parindent}{0pt}
% \DescribeMacro{\LetraItems}{\color{RoyalBlue}|\LetraItems|\marg{tipo de letra}}
%
% Con este comando cambiamos la tipografía utilizada en los ítems o elementos que están en el cuadro de la factura, de manera que {\itshape cambiar la longitud \cs{baselineskip} con el segundo argumento de \cs{fontsize} hará que la tabla tenga una altura distinta de las celdas.}
%
% Lo anterior significa que {\bfseries para cambiar la altura de las celdas, la forma correcta es a través de cambiar el tamaño de la letra de sus elementos con este comando. (Véase el archivo |.def|)}.
%
% \DescribeMacro{\LetraNumeros}{\color{RoyalBlue}|\LetraNumeros|\marg{tipo de letra}}
%
% Este comando sirve para cambiar el tipo de letra de los números de los ítems individuales en la factura, es decir, la cantidad, los precios y el descuento.
%
% \DescribeMacro{\LetraTipoIVA}{\color{RoyalBlue}|\LetraTipoIVA|\marg{tipo de letra}}
%
% El tipo del IVA es la letra que indica qué IVA está siendo gravado, por ejemplo, la ``|G|'', ``|R|'' y ``|A|'' que puede salir al lado de los elementos con IVA general, reducido y adicional respectivamente, y ``|(E)|'' al lado de los elementos exentos. Con esta macro cambiamos la letra con la que eso sale.
%
% \DescribeMacro{\LetraTitCuadro}{\color{RoyalBlue}|\LetraTitCuadro|\marg{tipo de letra}}
%
% Con |\LetraTitCuadro| podemos cambiar la tipografía de los títulos de los campos que hay en el cuadro de la factura, es decir, los textos ``Cantidad'', ``Descripción'', ``Precio U.'', etc.
%
% \DescribeMacro{\LetraTitTotales}{\color{RoyalBlue}|\LetraTitTotales|\marg{tipo de letra}}
%
% Con este comando cambiamos la tipografía de los nombres de los totales, es decir, ``IVA G.'', ``BI G.'', salvo el total general que se cambia con |\LetraTitTotal|.
%
% \DescribeMacro{\LetraNumTotales}{\color{RoyalBlue}|\LetraNumTotales|\marg{tipo de letra}}
%
% Con esta macro se cambia la tipografía utilizada en los totales numéricos de la factura, exceptuando el total general que se cambia con |\LetraNumTotal|.
%
% \DescribeMacro{\LetraTitTotal}{\color{RoyalBlue}|\LetraTitTotal|\marg{tipo de letra}}
%
% Para cambiar la tipografía de la palabra que indica el total general, e.g. ``TOTAL'', lo hacemos con |\LetraTitTotal|.
%
% \DescribeMacro{\LetraNumTotal}{\color{RoyalBlue}|\LetraNumTotal|\marg{tipo de letra}}
%
% Para la tipografía del total general (la celda del número), utilizamos este comando.
%
% \DescribeMacro{\LetraTitEnc}{\color{RoyalBlue}|\LetraTitEnc|\marg{tipo de letra}}
%
% Con este comando cambiamos el tipo de letra de la información en el título de las cajas del encabezado de la factura, por ejemplo los textos: ``Resumen'' y ``Datos del cliente''.
%
% \DescribeMacro{\LetraEncFactura}{\color{RoyalBlue}|\LetraEncFactura|\marg{tipo de letra}}
%
% Podemos también cambiar el tipo de letra de la información del encabezado de la factura, es decir, el tipo de letra del texto que escribe el usuario en el resumen o de toda la identificación del cliente en la factura. El resumen naturalmente acepta más cambios de tipografía escribiéndolos dentro del párrafo que se escribe con el comando |\Resumen|.
%
% \DescribeMacro{\LetraEncReporte}{\color{RoyalBlue}|\LetraEncReporte|\marg{tipo de letra}}
%
% Para cambiar la tipografía de la información del encabezado del reporte usamos |\LetraEncReporte|.
%
% \DescribeMacro{\LetraDescripcion}{\color{RoyalBlue}|\LetraDescripcion|\marg{tipo de letra}}
%
% Con este comando cambiamos la tipografía de la descripción larga; naturalmente cualquier cambio puede hacerse luego dentro del texto de la descripción, igual que con el resumen.
%
% \DescribeMacro{\LetraFirmas}{\color{RoyalBlue}|\LetraFirmas|\marg{tipo de letra}}
%
% Con |\LetraFirmas| podemos cambiar la letra usada para escribir el nombre debajo de la línea para firmar en la factura.
%
% \DescribeMacro{\LetraCondiciones}{\color{RoyalBlue}|\LetraCondiciones|\marg{tipo de letra}}
%
% Para cambiar la tipografía de las condiciones del documento se hace con este comando. (Aplica el mismo comentario que para la descripción y el resumen).
%
% \DescribeMacro{\LetraDenom}{\color{RoyalBlue}|\LetraDenom|\marg{tipo de letra}}
%
% La tipografía asociada a la denominación del documento, es decir, al lado del número (e.g. ``FACTURA'' o ``COTIZACIÓN''), y la asociada al texto ``No. CONTROL'' se cambia con |\LetraDenom|.
%
% \DescribeMacro{\LetraNumeracion}{\color{RoyalBlue}|\LetraNumeracion|\marg{tipo de letra}}
%
% Con |\LetraNumeracion| cambiamos la tipografía de las numeraciones como la del número de la factura y el número de control.
%
% \DescribeMacro{\LetraFecha}{\color{RoyalBlue}|\LetraFecha|\marg{tipo de letra}}
%
% La tipografía de la fecha de emisión la podemos cambiar con este comando.
%
% \DescribeMacro{\LetraTitReporte}{\color{RoyalBlue}|\LetraTitReporte|\marg{tipo de letra}}
%
% La letra del título del reporte, que sale al principio de éste, se puede cambiar con |\LetraTitReporte|.
%
% \DescribeMacro{\LetraInfoPagina}{\color{RoyalBlue}|\LetraInfoPagina|\marg{tipo de letra}}
%
% Las cabeceras o piés de página del reporte también tienen un comando para su tipo de letra, y es |\LetraInfoPagina|.
%
% \DescribeMacro{\LetraReporte}{\color{RoyalBlue}|\LetraReporte|\marg{tipo de letra}}%
%
% Finalmente, para cambiar la tipografía con la que se inicia el reporte tenemos este comando. Obviamente también luego se puede hacer cualquier cambio dentro del ambiente |reporte|.
%
% {\bfseries Todos los comandos definidos en todas las secciones anteriores, así como cualquier comando definido en |factura.def| se puede redefinir y agregar a otro archivo |.tex| o |.def| que el usuario cargue en el preámbulo con |\input|, |\include| o con el comando |\Cliente|:}
%
% \DescribeMacro{\Cliente}{\color{RoyalBlue}|\Cliente|\marg{archivo \LaTeX}}
%
%  Incluye un archivo cuya extensión debe ser |.def| o |.tex|, con cualquiera de los comandos anteriores que modifican el estilo del documento, identifican al cliente o al proveedor del servicio.
%
% \noindent \DescribeMacro{\mostrar}{\color{RoyalBlue}|\mostrar|\marg{@-macro}}
%
% Por último, disponemos del comando |\mostrar| cuya función es escribir lo que está alojado en una macro interna que contenga un símbolo ``|@|'' en su nombre. Es necesario un comando para mostrar una macro con este símbolo para que el usuario no tenga que usar |\makeatletter| y |\makeatother|.
%
% Por ejemplo, el número de la factura está alojado en la variable |\@Num|, y si queremos hacer referencia a ese número en alguna parte del reporte o de la descripción de la factura podremos usar |\mostrar{@Num}|.
%
% }
%
% \section{Etiquetas y referencias\label{sec:etiquetas}}
%
% Esta clase |factura| soporta agregar etiquetas a cada elemento de la factura que luego en la descripción larga o en el reporte queramos referenciar.
%
% \noindent \DescribeMacro{\label}{\color{RoyalBlue}|\label|\marg{etiqueta}}
%
% Para ello usamos la conocida macro |\label| de \LaTeX{} justamente después del ítem que nos interese luego referenciar, por ejemplo:
%
% \iffalse
%<*literal>
% \fi
\begin{verbatim}
\begin{factura}
 \Item{1}{Artículo gravado con IVA general}{1000}
 \Item{3}{Otro artículo gravado con IVA general}{1500}\label{el-otro}
\end{factura}
\end{verbatim}
% \iffalse
%</literal>
% \fi
%
% De esta forma creamos una etiqueta llamada ``el-otro'' para el segundo elemento, que luego podremos citar en la descripción larga o en el reporte con comandos similares a los que \LaTeX{} provee para referenciar etiquetas.
%
% \noindent \DescribeMacro{\itemref}{\color{RoyalBlue}|\itemref|\marg{etiqueta}}\\
% \noindent \DescribeMacro{\cantref}{\color{RoyalBlue}|\cantref|\marg{etiqueta}}\\
% \noindent \DescribeMacro{\descref}{\color{RoyalBlue}|\descref|\marg{etiqueta}}\\
% \noindent \DescribeMacro{\puref}{\color{RoyalBlue}|\puref|\marg{etiqueta}}\\
% \noindent \DescribeMacro{\dctoref}{\color{RoyalBlue}|\dctoref|\marg{etiqueta}}\\
% \noindent \DescribeMacro{\ptref}{\color{RoyalBlue}|\ptref|\marg{etiqueta}}\par
%
% Los comandos anteriores son para usarse donde queramos hacer la cita, es decir, en la descripción larga o en el reporte.
%
% Si se quiere mostrar el número de fila que ocupa el ítem en la lista lo hacemos con |\itemref|, que en el ejemplo aparecería el número ``|2|'' indicando que es el segundo ítem de la factura\footnote{Cuando se usa \cs{itemref} conviene enumerar los ítems en la factura con la opción \texttt{numitem}.}. Con |\cantref| escribimos la cantidad del elemento citado mediante la etiqueta, en nuestro ejemplo sería ``|3|''. Para la descripción del ítem usamos |\descref|, que en el caso del ejemplo sería el texto ``|Otro artículo gravado con IVA general|''. Para el precio unitario usamos |\puref|, en el ejemplo ``|1.500,00|''. Si se quiere mostrar el descuento del ítem citado usamos |\dctoref|, que para el ejemplo sería ``|0|''. Por último, para mostrar el precio total usamos |\ptref|, y en nuestro ejemplo eso escribiría ``|4.500,00|''.
%
% Podemos ver que el uso de los comandos |\puref| y |\ptref| nos muestra el precio en el mismo formato con el que lo vemos en la presentación de la factura, en cuanto al redondeo y al separador de miles y decimal.
%
% Con la asignación de estas etiquetas y su uso mediante las referencias podemos de manera conveniente citar cualquier ítem que se haya facturado, de manera dinámica sin tener que reescribir en la descripción larga o en el reporte aquello que ya se escribió en el cuadro de la factura.
%
% Por otra parte, también podemos en la descripción larga y en el reporte referirnos al signo monetario con el comando |\Moneda|, y a cualquiera de los totales de la siguiente forma:
%
% \begin{tabular}{rl}
% \hline
% Total & Comando \\ \hline
% Bases imponibles & |\BIG|, |\BIR|, |\BIA|, |\BIE|\footnote{Lo llamamos \cs{BIE} para mantener la nomenclatura pero no es una base imponible ya que es un monto exento de impuesto.} \\
% IVA & |\AlicuotaG|, |\AlicuotaR|, |\AlicuotaA| \\
% Subtotales\footnote{El subtotal es el monto sin aplicar descuentos generales (los que se hacen con los comandos \cs{Descuento***}, es decir, los descuentos que no son individuales a cada item sino al totalizar), que coincide con la base imponible cuando no hay esos descuentos.} & |\SubtG|, |\SubtE|, |\SubtR|, |\SubtA| \\
% Descuentos & |\DescG|, |\DescE|, |\DescR|, |\DescA| \\
% Total final & |\Total|
% \end{tabular}
%
% \section{Más personalizaciones}
%
% \DescribeMacro{\@PosicionaFecha}
% \DescribeMacro{\@PosicionaDenom}
% \DescribeMacro{\@PosicionaNumControl}
% \DescribeMacro{\@PosicionaCondiciones}
% \DescribeMacro{\@PosicionaFirmas}
% Es posible darle aspecto distinto a muchas de las partes que conforman la factura. Internamente en la clase, cada parte es ubicada en la hoja con un comando y su contenido es escrito en el papel con otro comando. Los comandos que más probablemente son sujetos a ser cambiados por el usuario son los comandos que escriben el texto más que aquellos que lo ubican en la hoja, por tal razón, los comandos que posicionan aquello que va a escribirse lo definimos dentro del archivo |.cls|, y los que propiamente escriben cada parte de la hoja están definidos en el |.def|. Ambas fuentes las podrán consultar los usuarios para mayor comprensión, y para la total personalización. Recomendamos empezar por el archivo de definiciones |factura.def|.
%
% Estas macros son internas y sirven para, como dijimos antes, que \TeX{} se prepare para escribir el texto en la hoja; todas empiezan con |\@Posiciona| y no debe ser común necesitar cambiarlas.
%
% \DescribeMacro{\@EstiloFecha}
% \DescribeMacro{\@EstiloDenom}
% \DescribeMacro{\@EstiloNumControl}
% \DescribeMacro{\@EstiloCondiciones}
% \DescribeMacro{\@EstiloFirmas}
% Todas estas macros llaman a su correspondiente macro que escribe el texto, que comienza con |\@Estilo|, y con cambiar su contenido podemos cambiar la forma como es escrita esa parte de la factura en la hoja.
%
% Estas últimas son las que están definidas dentro de |factura.def|, y que eventualmente puede desearse cambiarlas.
%
% \DescribeMacro{\@EscribeDatos}
% \DescribeMacro{\@EscribeDatosResumen}
% \DescribeMacro{\@EscribeDatosReporte}
% \DescribeMacro{\@DibujaLinea}
% \DescribeMacro{\@EscribeTotalesEnCSV}
% \DescribeMacro{\@EncabezadoFactura}
% \DescribeMacro{\@EncabezadoReporte}
% Adicionalmente tenemos las macros que escriben el contenido de la caja de los datos del cliente, o de las cajas de los datos y del resumen una al lado de la otra. Estos elementos, como no tienen posición fija (tal como se explicó en la sección \ref{sec:geohoja}) entonces no necesitan de una macro que los ubique y otra que escriba el texto, sino simplemente la que escribe el contenido de ese elemento. También la clase consta de una macro interna para escribir los datos del reporte al principio de éste, así como también para dibujar la línea ``de protección'' dentro del cuadro de la factura, otra para escribir los totales en el archivo |.csv| y otras dos para escribir las cajas del encabezado de la factura y el encabezado del reporte; todas estas son macros internas que no deben ser llamadas por el usuario, y no consideramos que pueda ser común cambiarlas.
%
% Cualquiera de estas macros que se quiera redefinir habría que hacerlo en el preámbulo del |.tex| y encerrándolas entre |\makeatletter| y |\makeatother| para poder redefinir una macro que contiene un símbolo ``|@|''.
%
% {\bfseries \itshape Finalmente, como hemos dicho antes, una vez adecuada la clase al diseño que se quiere, se podrán escribir todos los comandos que hacen estos ajustes en un} |.tex| {\itshape o} |.def| {\itshape y cargarlo con} |\input|, |\include| {\itshape o con} |\Cliente|.
%
% \newpage
% \section{Tabla con todas las opciones}
%
% La tabla que sigue muestra una lista de las opciones posibles al momento de cargar la clase:
%
% \begin{tabular}{>{\ttfamily}rl}
%  \rmfamily \bfseries Opción & \bfseries Significado \\ \hline
%  prefactura & Imprime una prefactura. \\
%  cotización & Imprime una cotización. \\
%  soloreporte & Produce únicamente el reporte. \\
%  conreporte & Produce la factura y el reporte. \\
%  twoside & Imprime el reporte a dos caras. \\
%  dcu & Descripción, cantidad, precio u.. \\
%  duc & Descripción, precio u., cantidad. \\
%  sinlineasvi & No dibuja las líneas verticales internas. \\
%  sinlineasve & No dibuja las líneas verticales externas. \\
%  sinlineasv & Mo dibuja ninguna línea vertical. \\
%  sinlineashi & No dibuja las líneas horizontal internas. \\
%  sinlineashe & No dibuja las líneas horizontal externas. \\
%  sinlineash & No dibuja ninguna línea horizontal. \\
%  conlineasha & Dibuja una línea separando los artículos entre sí. \\
%  filas & Escribe los totales en filas. \\
%  centrado & Centra los totales en el modo de filas. \\
%  agrupado & Agrupa los totales según su impuesto en el modo de columnas. \\
%  exparriba & Llena con espacio extra el cuadro de la factura. \\
%  sinexpandir & No expande elementos en la factura. \\
%  linea & Dibuja una línea protectora en el cuadro de la factura. \\
%  nospanish & No carga |babel|, |fontenc| ni |lmodern|. \\
%  dosfirmas & Incluye los dos espacios para firmar. \\
%  unafirma & Sólo incluye la firma del emisor. \\
%  sinfirmas & No incluye espacios para firmar. \\
%  sincondiciones & No incluye las condiciones del documento. \\
%  siniva & No incluye IVA, pero lo deja expresado. \\
%  sinivaexpresado & No incluye IVA ni lo expresa. \\
%  todosiva & Expresa todos los tipos de IVA. \\
%  G & Agrega una ``|G|'' en los ítems con IVA general. \\
%  impdesc & Escribe la denominación del IVA en la descripción. \\
%  numitem & Enumera los ítems en la factura en otra columna extra a la izquierda. \\
%  denom & Explicita la denominación del documento. \\
%  sinnumero & No pone el número cuando se usa |denom|. \\
%  sincantidad & Los artículos van sin expresar su cantidad. \\
%  descuentos & Los artículos van con descuento individual. \\
%  csv & Genera un archivo |.csv| con la información numérica de la factura. \\ \hline
% \end{tabular}
%
% \newpage
% \section{Tabla con todos los comandos}
%
% A continuación presentamos una tabla con todos los comandos, que salvo |\FirmaReporte|, los |\Item| y |\Descripcion|, se poner todos en el preámbulo.
%
% \begin{tabular}{>{\ttfamily}rl}
% \rmfamily \bfseries Comando & \bfseries Significado \\ \hline
%  |\GeometriaFactura| & Establece los parámetros de la geometría de la factura. \\
%  |\GeometriaReporte| & Establece los parámetros de la geometría del reporte. \\
%  |\FondoFactura| & Carga la imagen del fondo de la factura. \\
%  |\FondoReporte| & Carga la imagen del fondo del reporte para la primera página. \\
%  |\FondoReporte*| & Carga la imagen del fondo del reporte para todas las páginas. \\
%  |\EstiloPagReporte| & Establece el estilo de página del reporte. \\
%  |\InicioReporte| & Distancia hasta el inicio del texto en la primera hoja del reporte. \\
%  |\FirmaFactura| & Carga la imagen de la firma en la factura. \\
%  |\FirmaReporte| & Carga la imagen de la firma en el reporte\footnote{El comando \cs{FirmaReporte} se escribe dentro del ambiente \texttt{reporte} y no en el preámbulo.}. \\
%  |\TituloReporte| & Establece el título del reporte. \\
%  |\TituloReporte*| & Establece el título del reporte a salir en las cabeceras o piés de página. \\
%  |\InfoPagina| & Cambia la información de las cabeceras o piés de página del reporte. \\
%  |\RazonSocial| & Establece la razón social. \\
%  |\Nombre| & Establece el nombre del cliente. \\
%  |\RIF| & RIF del cliente. \\
%  |\CI| & Cédula de identidad del cliente. \\
%  |\Telefono| & Teléfono del cliente. \\
%  |\Direccion| & Dirección del cliente. \\
%  |\Email| & E-mail del cliente. \\
%  |\Contacto| & Persona de contacto. \\
%  |\Conforme| & Nombre de quien recibe la factura, para el espacio de la firma. \\
%  |\Emisor| & Nombre de quien emite la factura, para el espacio de la firma. \\
%  |\Proveedor| & Nombre de quien firma el reporte. \\
%  |\Fecha| & Establece la fecha de emisión de la factura. \\
%  |\Descuento| & Porcentaje de descuento para todos los elementos. \\
%  |\Descuento*| & Descuento neto en el subtotal, para todos los elementos. \\
%  |\Descuento[GRAE]| & Descuento en porcentaje, discriminado según el tipo de ítem. \\
%  |\Descuento[GRAE]*| & Descuento en el subtotal, discriminado según el tipo de ítem. \\
%  |\Num| & Número de la factura. \\
%  |\NumControl| & Número de control de la factura. \\
%  |\NumSerieControl| & Número de serie de control de la factura. \\
%  |\Denom| & Nombre de la denominación de documento. \\
%  |\Condiciones| & Establece las condiciones del documento. \\
%  |\Resumen| & Resumen. \\
%  |\Cliente| & Carga un archivo |.def| o |.tex| con personalizaciones. \\
%  |\PosFecha| & Posición $(x,y)$ de la fecha. \\
%  |\PosDenom| & Posición $(x,y)$ del texto de la denominación. \\
%  |\PosControl| & Posición $(x,y)$ del número de control. \\
%  |\PosCond| & Posición $(x,y)$ del párrafo con las condiciones del documento. \\
%  |\PosFirmas| & Posición $(x_o,x_f,y)$ de las firmas. \\
%  |\SepFilas| & Separación horizontal y vertical en los totales en el modo de filas. \\
%  |\SepElementos| & Separación vertical entre los distintos elementos de la factura. \\
%  |\SepEncabez| & Separación entre las cajas del encabezado de la factura y \\
%               & separación interna entre el borde y el texto. \\
%  |\SepDescrip| & Separación interna entre el borde y el texto en la descripción. \\
% \end{tabular}
% \newpage
% \begin{tabular}{>{\ttfamily}rl}
% \rmfamily \bfseries Comando & \bfseries Significado \\ \hline
%  |\LineaEncabez| & Grosor de la línea de las cajas del encabezado de la factura. \\
%                 & curvatura de la esquina y sombra. \\
%  |\LineaDescrip| & Grosor de la línea de la caja de la descripción. \\
%                  & curvatura de la esquina y sombra. \\
%  |\LineaFirmas| & Longitud y grosor de las líneas para firmar. \\
%  |\LetraItems| & Tipografía para los ítems en la factura. \\
%  |\LetraNumeros| & Tipografía para los números en la factura. \\
%  |\LetraTipoIVA| & Tipografía para el tipo de IVA. \\
%  |\LetraTitCuadro| & Tipografía para los nombres de las columnas del cuadro de la factura. \\
%  |\LetraTitTotales| & Tipografía para los nombres de los totales. \\
%  |\LetraNumTotales| & Tipografía para los totales numéricos. \\
%  |\LetraTitTotal| & Tipografía para el nombre del total final. \\
%  |\LetraNumTotal| & Tipografía para el total final numérico. \\
%  |\LetraTitEnc| & Tipografía para los títulos en las cajas del encabezado de la factura. \\
%  |\LetraEncFactura| & Tipografía para la información en las cajas del encabezado. \\
%  |\LetraEncReporte| & Tipografía para la información del encabezado del reporte. \\
%  |\LetraDescripcion| & Tipografía para la descripción en la factura. \\
%  |\LetraFirmas| & Tipografía para los nombres de quienes firman la factura. \\
%  |\LetraCondiciones| & Tipografía para las condiciones del documento. \\
%  |\LetraDenom| & Tipografía para la denominación del documento. \\
%  |\LetraNumeracion| & Tipografía para las numeraciones. \\
%  |\LetraFecha| & Tipografía para la fecha de emisión. \\
%  |\LetraTitReporte| & Tipografía para el título del reporte. \\
%  |\LetraInfoPagina| & Tipografía para las cabeceras o piés de página del reporte. \\
%  |\LetraReporte| & Tipografía para el texto del reporte. \\
%  |\Item[RAEX]| & Agrega un elemento a la factura\footnote{Estos comandos \cs{Item} se escriben dentro del ambiente \texttt{factura} y no en el preámbulo.}. \\
%  |\Descripcion| & Descripción larga de la factura\footnote{El comando \cs{Descripcion} se escribe dentro del documento, luego del ambiente \texttt{factura}, y no en el preámbulo.}. \\
%  |\label| & Agrega una etiqueta a un ítem de la factura\footnote{Se mantiene el nombre ``\cs{label}'' por compatibilidad con los comandos conocidos de \LaTeX. Este comando también se escribe dentro del ambiente \texttt{factura}.}. \\
%  |\itemref| & Hace referencia al número de línea que ocupa el ítem etiquetado\footnote{También se mantienen los nombres de las macros que terminan en ``\texttt{ref}'' por compatibilidad con comandos de \LaTeX{} como \cs{pageref}.}. \\
%  |\cantref| & Hace referencia a la cantidad del ítem. \\
%  |\descref| & Hace referencia a la descripción del ítem. \\
%  |\puref| & Hace referencia al precio unitario del ítem. \\
%  |\dctoref| & Hace referencia al descuento del ítem. \\
%  |\ptref| & Hace referencia al precio total del ítem. \\
%  |\mostrar| & Mostramos una variable que contenga ``|@|'' sin usar ``|\makeatletter|''\footnote{Este comando tampoco se usa en el preámbulo sino en cualquier otra parte del documento.}.
% \end{tabular}
%
% \StopEventually{\endorgo}
%
%    \begin{macrocode}
%<*class>
\newif\if@prefactura
\newif\if@cotizacion
\newif\if@spanish \@spanishtrue
\newif\if@ivaexpresado \@ivaexpresadotrue
\newif\if@todosiva
\newif\if@confirmas \@confirmastrue
\newif\if@unafirma \@unafirmafalse
\newif\if@concondiciones \@concondicionestrue
\newif\if@filas
\newif\if@agrupado
\newif\if@centrado
\newif\if@descuentos
\newif\if@denom
\newif\if@sinnumero
\newif\if@conlineasha
\newif\if@linea
\newif\if@lineacompleta
\newif\if@lineahastatotal
\newif\if@lineadesdeinicio
\newif\if@G
\newif\if@BIR
\newif\if@BIA
\newif\if@Exento
\newif\if@DescG
\newif\if@DescR
\newif\if@DescA
\newif\if@DescE
\newif\if@DescGnum
\newif\if@DescRnum
\newif\if@DescAnum
\newif\if@DescEnum
\newif\if@Descuentos
\newif\if@csv
\newif\if@cdu \@cdutrue
\newif\if@dcu
\newif\if@duc
\newif\if@exparriba
\newif\if@fondofactura
\newif\if@fondoreporte
\newif\if@fondoreportestar
\newif\if@factura \@facturatrue
\newif\if@reporte
\newif\if@nombre
\newif\if@pagado
\newif\if@impdesc
\newif\if@pruebaref

\RequirePackage{etoolbox}%  'etoolbox' para los condicionales binarios.

\newbool{Descuentos}
\newbool{SinCantidad}
\newbool{SinLineasVertInt}
\newbool{SinLineasVertExt}
\newbool{SinLineasHoriInt}
\newbool{SinLineasHoriExt}
\newbool{DCU}
\newbool{DUC}
\newbool{NumItem}
\newbool{PrimeroDescrip}
\newbool{ExpAbajo}\booltrue{ExpAbajo}

%% Condicionales auxiliares para la posición de los objetos fijos cuando son medidos desde la derecha, o desde abajo.
\newbool{FechaXnegativo}
\newbool{FechaYnegativo}
\newbool{CondYnegativo}% no hay CondXnegativo.
\newbool{DenomXnegativo}
\newbool{DenomYnegativo}
\newbool{ControlXnegativo}
\newbool{ControlYnegativo}
\newbool{FirmasYnegativo}% no hay FirmasXnegativo; hay X_inicial y X_final para las firmas.

\DeclareOption{prefactura}{\@prefacturatrue\@denomtrue\@confirmasfalse}%  La prefactura; con el diseño de la forma libre... para enviar por correo electrónico, fax o imprimir preliminarmente.
\DeclareOption{cotizacion}{\@cotizaciontrue\@denomtrue\@unafirmatrue}%  Cambia la denominación a 'COTIZACIÓN' y no 'FACTURA'.
\DeclareOption{nospanish}{\@spanishfalse}%  No carga babel en castellano ni la codificación T1 de las letras.
\DeclareOption{sinfirmas}{\@confirmasfalse}%  No agrega los espacios para firmar.
\DeclareOption{unafirma}{\@unafirmatrue\@confirmastrue}%  No agrega el espacio para que firme quien recibe.
\DeclareOption{dosfirmas}{\@unafirmafalse\@confirmastrue}%  Pone las dos firmas para firmar.
\DeclareOption{descuentos}{\booltrue{Descuentos}\@descuentostrue}%  Para los descuentos individuales.
\DeclareOption{sincondiciones}{\@concondicionesfalse}%  No agrega el texto con las condiciones del documento.
\DeclareOption{denom}{\@denomtrue}%  Agrega el texto con la denominación del documento, para las formas libres que no tienen el número de factura.
\DeclareOption{sinnumero}{\@sinnumerotrue\@denomtrue}%  Escribir el texto de la denominación del documento pero sin escribir el número.
\DeclareOption{G}{\@Gtrue}%  Con esta opción sale la letra 'G' en los items con IVA general, y sale el porcentaje en la base imponible general.
\DeclareOption{filas}{\@filastrue}%  Estilo de totalización en filas.
\DeclareOption{centrado}{%  Total y exento 'centrado'; sólo para estilo 'filas'
 \if@filas
  \@centradotrue
 \else
  \ClassWarning{factura}{La opción 'centrado' no es compatible con el modo de totalización en columnas. Sin efecto opción 'centrado'.}{}
 \fi}
\DeclareOption{agrupado}{%  Agrupados los elementos totalizadores en el modo en columnas.
 \if@filas
  \ClassWarning{factura}{La opción 'agrupado' no es compatible con el modo de totalización en filas. Sin efecto opción 'agrupado'.}{}
 \else
  \@agrupadotrue
 \fi}
\DeclareOption{impdesc}{\@impdesctrue}%  Para el tipo de impuesto en la descripción y no en el precio unitario y total.
\DeclareOption{numitem}{\booltrue{NumItem}}%  Para poner una columna extra al principio con el número del ítem.
\DeclareOption{dcu}{%  Descripción, luego cantidad y luego precio unitario.
 \@dcutrue\@cdufalse\@ducfalse
 \booltrue{DCU}\boolfalse{DUC}
 \booltrue{PrimeroDescrip}}
\DeclareOption{duc}{%  Descripción, luego precio unitario y luego cantidad.
 \if@dcu
  \ClassWarning{factura}{Las opciones 'duc' y 'dcu' no son compatibles. Sin efecto ambas opciones}{}
  \boolfalse{PrimeroDescrip}\boolfalse{DCU}\@dcufalse\@cdutrue
 \else
  \@ductrue\@cdufalse\@dcufalse
  \booltrue{DUC}\boolfalse{DCU}
  \booltrue{PrimeroDescrip}
 \fi}
\DeclareOption{siniva}{\AtBeginDocument{\gdef\@ImpuestoG{0}\gdef\@ImpuestoR{0}\gdef\@ImpuestoA{0}}}%  No cobra IVA.
\DeclareOption{todosiva}{\@todosivatrue}%  Con esta opción salen todos los IVA así valgan cero.
\DeclareOption{sinivaexpresado}{%  Cuando no se cobra IVA y tampoco se quiere que aparezca la totalización del IVA.
 \@ivaexpresadofalse
 \if@filas
  \ClassWarning{factura}{La opción 'sinivaexpresado' no es compatible con la opción 'filas'. Sin efecto la opción 'filas'}{}
  \@filasfalse
 \else
  \AtBeginDocument{\gdef\@ImpuestoG{0}\gdef\@ImpuestoR{0}\gdef\@ImpuestoA{0}}
 \fi}
\DeclareOption{sincantidad}{%  Para no poner el campo de la cantidad.
 \booltrue{SinCantidad}
 \if@dcu
  \ClassWarning{factura}{La opción 'sincantidad' no es compatible con 'dcu' . Sin efecto opción 'dcu'}{}
  \@dcufalse\@cdutrue\boolfalse{DCU}\boolfalse{PrimeroDescrip}
 \fi
 \if@duc
  \ClassWarning{factura}{La opción 'sincantidad' no es compatible con 'duc' . Sin efecto opción 'duc'}{}
  \@ducfalse\@cdutrue\boolfalse{DUC}\boolfalse{PrimeroDescrip}
 \fi}

\DeclareOption{conlineasha}{\@conlineashatrue}%  Una línea horizontal para cada ítem, como las facturas a mano.
\DeclareOption{sinlineasv}{%  Estilo 'sinlineasv'.
 \booltrue{SinLineasVertExt}\booltrue{SinLineasVertInt}}
\DeclareOption{sinlineasvi}{\booltrue{SinLineasVertInt}}%  Estilo 'sinlineasvi'.
\DeclareOption{sinlineasve}{\booltrue{SinLineasVertExt}}%  Estilo 'sinlineasve'.
\DeclareOption{sinlineash}{%  Estilo 'sinlineash'.
 \booltrue{SinLineasHoriExt}\booltrue{SinLineasHoriInt}}
\DeclareOption{sinlineashi}{\booltrue{SinLineasHoriInt}}%  Estilo 'sinlineashi'.
\DeclareOption{sinlineashe}{\booltrue{SinLineasHoriExt}}%  Estilo 'sinlineashe'.
\DeclareOption{exparriba}{\@exparribatrue\boolfalse{ExpAbajo}}%  Para rellenar con líneas en blanco de manera automática.
\DeclareOption{sinexpandir}{\boolfalse{ExpAbajo}\@exparribafalse}%  No expande ninguna de las dos partes de la factura.
\DeclareOption{linea}{%  Para la línea que protege el espacio en blanco.
 \if@exparriba
  \@lineatrue
 \else
  \ClassWarning{factura}{La opción 'linea' requiere la opción 'exparriba'. Sin efecto opción 'linea'.}{}
 \fi}
\DeclareOption{conreporte}{\@reportetrue}%  Para imprimir factura y reporte.
\DeclareOption{soloreporte}{\@reportetrue\@facturafalse}%  Para imprimir sólo el reporte.
\DeclareOption{twoside}{\PassOptionsToClass{twoside}{article}}%  Opción 'twoside' de article para los reportes.
\DeclareOption{csv}{%  Para la salida en modo csv también.
 \if@factura
  \@csvtrue
  \AtEndDocument{\@EscribeTotalesEnCSV}
 \else
  \ClassWarning{factura}{La opción 'csv' require generar la factura. Sin efecto opción 'csv'.}{}
 \fi}

\ProcessOptions\relax

\LoadClass[12pt]{article}

\RequirePackage{xparse}%  Algunos comandos los definimos con \NewDocumentCommand.
\RequirePackage[absolute]{textpos}%  Es necesario 'textpos' para colocar texto en ubicaciones arbitrarias.
\RequirePackage{geometry}%  'geometry' para ajustar todos los márgenes.
\RequirePackage{xstring}%  Lo usamos sólo para tomar el menos al principio de una longitud.
\RequirePackage{calc}%  'calc' para hacer aritmética con las dimensiones.
\RequirePackage{fp-upn}%  Fundamental el paquete 'fp-upn' para todos los cálculos.
\RequirePackage{numprint}%  Con 'numprint' expresamos los totales en el formato requerido.
\RequirePackage{tikz}%  Para los recuadros del encabezado de la factura,
 \usetikzlibrary{shadows}%  y para el de la descripción.
\RequirePackage{tabularx}%  Con 'tabularx' hacemos la tabla.
\RequirePackage{environ}%  Con 'environ' podemos usar tabularx dentro del ambiente de la factura y escribir texto en el enddef.
\RequirePackage{fancyhdr}%  Las cabeceras fancy; así se use solamente en reporte, hay que cargarlo siempre.

\AtBeginDocument{%  Da error si algún campo necesario no está definido.
 \if@reporte
  \ifdefvoid{\@Fecha}{\ClassWarning{factura}{** No se especificó una fecha. Puede dar error si el título del reporte no se especifica que aparezca en las cabeceras **}{}}{}%
  \ifdefvoid{\@Num}{\ClassWarning{factura}{** No se especificó el número de la factura. Puede dar error si el título del reporte no se especifica que aparezca en las cabeceras **}{}}{}%
  \ifdefvoid{\@Proveedor}{%
   \ifdefvoid{\@Emisor}
    {\ClassError{factura}{** Hay que definir el nombre del proveedor cuando se emite un reporte **}{}}%
    {\ClassWarning{factura}{** Se toma el emisor como el proveedor por no haberse especificado este último **}{}%
    \let\@Proveedor=\@Emisor}}
   {}%
 \fi
 \ifdefvoid{\@RazonSocial}{\ClassError{factura}{** Hay que definir la razón social **}{}}{}%
 \if@factura
  \ifdefvoid{\@RIF}{\ClassError{factura}{** Hay que definir el R.I.F. **}{}}{}%
  \ifdefvoid{\@Direccion}{\ClassError{factura}{** Hay que definir la dirección fiscal **}{}}{}%
  \ifdefvoid{\@Telefono}{\ClassError{factura}{** Hay que definir un número telefónico **}{}}{}%
  \ifdefvoid{\@Email}{\ClassWarning{factura}{** Pudiera definirse una dirección de correo electrónico **}{}}{}%
  \ifdefvoid{\@Fecha}{\ClassError{factura}{** Hay que definir la fecha de emisión **}{}}{}%
  \if@concondiciones
   \ifdefvoid{\@Condiciones}{\ClassError{factura}{** Hay que definir las condiciones del documento o usar la opción 'sincondiciones' **}{}}{}%
  \fi
  \if@cotizacion
   \ifdefvoid{\@FondoFactura}{\ClassWarning{factura}{** En la opción para cotizacion se recomienda agregar el fondo **}{}}{}%
  \fi
  \if@prefactura
   \ifdefvoid{\@FondoFactura}{\ClassWarning{factura}{** En la opción para prefactura se recomienda agregar el fondo **}{}}{}%
  \fi
  \if@sinnumero
   \if@cotizacion
   \else
    \ClassError{factura}{** La opción para no poner el número sólo es compatible con las cotizaciones **}{}%
   \fi
  \fi
  \if@denom
   \if@sinnumero
   \else
    \ifdefvoid{\@Num}{\ClassError{factura}{** Hay que definir el número de la factura **}{}}{}%
   \fi
  \fi
 \fi
 \ifdefvoid{\@Contacto}{\if@nombre\else\ClassWarning{factura}{** Pudiera definirse una persona de contacto **}{}\fi}{}%
}

%% Escribimos el total como comentario en el .log, y avisamos cuando la fecha no sea la de hoy.
\AtEndDocument{%
 \edef\@Hoy{\ifnum\number\day<10 0\fi\the\day-\ifnum\number\month<10 0\fi\the\month-\the\year}%
 \ifx\undefined\@Fecha
 \else
  \edef\@Fecha{\@Fecha}%
  \ifx\@Fecha\@Hoy
  \else
   \ClassWarning{factura}{** Fecha del documento\space \@Fecha\space distinta de la fecha de hoy. **}{}%
  \fi
 \fi
 \if@factura\ClassInfo{factura}{\@@Total: \space\space\space \Moneda \Total}{}\fi}

%</class>
%<*class|def>
%% La geometría en formato de factura y de reporte.
%% El margen superior está definido desde el encabezado con los datos del cliente.
%% El margen inferior está definido hasta el final de la descripción (o del cuadro de la factura si no hay descripción).
%% Hay elementos que salen fuera de estos márgenes, como las firmas, las condiciones del documento, la numeración y la fecha.
%<class>\def\GeometriaFactura#1{\gdef\@GeometriaFactura{#1}}
%<class>\def\GeometriaReporte#1{\gdef\@GeometriaReporte{#1}}
%<def>\GeometriaFactura{letterpaper,vmargin={5cm,5.5cm},  hmargin={1cm,1cm},footskip=0pt,  headsep=0pt,    headheight=0pt}
%<def>\GeometriaReporte{letterpaper,vmargin={2.8cm,2.5cm},hmargin={3cm,2cm},footskip=1.2cm,headsep=0.777cm,headheight=1.5cm}

%<class>%% Se utiliza '\@Impuesto' como el factor del impuesto, el cual viene predefinido en '\@Alicuota'.
%<class>\def\@ImpuestoG{\@AlicuotaG}
%<class>\def\@ImpuestoR{\@AlicuotaR}
%<class>\def\@ImpuestoA{\@AlicuotaA}
%<def>%% Porcentajes de los distintos IVA (general, reducido y adicional):
%<def>\def\@AlicuotaG{0.12}
%<def>\def\@AlicuotaR{0.08}
%<def>\def\@AlicuotaA{0.22}
%<def>
%</class|def>
%<*def>
%% i) separador de miles, ii) separador decimal, iii) número de decimales para la moneda iv) y para los porcentajes, v) número de dígitos de la numeración de la factura:
\npthousandsep{.}
\npdecimalsign{,}
\def\@DigitosMoneda{2}
\def\@DigitosPorc{2}
\def\@DigitosNumeracion{5}

%% La moneda:
\def\Moneda{Bs.}

%% Al lado de cada ítem va la letra que designa el gravamen que aplica sobre él:
\def\@DenomAlicuotaG{G}
\def\@DenomAlicuotaR{R}
\def\@DenomAlicuotaA{A}
\def\@DenomAlicuotaE{(E)}

%% Macros que guardan textos que corresponden a nombres de campos:
\def\@@Fecha{Fecha de emisi\'on:}
\def\@@RazonSocial{Raz\'on social:}
\def\@@NumItem{\#}
\def\@@Cantidad{Cantidad}
\def\@@Descripcion{Descripci\'on}
\def\@@PrecioU{Precio U.}
\def\@@PrecioT{Precio T.}
\def\@@Precio{Precio}
\def\@@AlicuotaG{IVA G}
\def\@@AlicuotaR{IVA R}
\def\@@AlicuotaA{IVA A}
\def\@@BIG{BI G}
\def\@@BIR{BI R}
\def\@@BIA{BI A}
\def\@@BIE{Exento}% La base imponible exenta. ;)
\def\@@Total{TOTAL}
\def\@@Descuento{Dcto.}
\def\@@DescuentoG{Descuento G}
\def\@@DescuentoR{Descuento R}
\def\@@DescuentoA{Descuento A}
\def\@@DescuentoE{Descuento E}
\def\@@SubtotalG{Subtotal G}
\def\@@SubtotalR{Subtotal R}
\def\@@SubtotalA{Subtotal A}
\def\@@SubtotalE{Subtotal E}
\def\@@RIF{R.I.F.:}
\def\@@CI{C.I.:}
\def\@@Contacto{Persona de contacto:}
\def\@@Direccion{Direcci\'on fiscal:}
\def\@@Telefono{Tel\'efono:}
\def\@@Email{E-mail:}
\def\@@Datos{Datos del cliente}
\def\@@Resumen{Resumen del servicio}
\def\@@Conforme{Recib\'i conforme}
\def\@@Emisor{Por el emisor}
\def\@@Pagado{PAGADO}
\def\@@DenomFactura{FACTURA}
\def\@@DenomCotiza{COTIZACI\'ON}
\def\@@Control{N\textordmasculine\space CONTROL}
\def\@@Proveedor{Proveedor:}
\def\@@Cliente{Cliente:}

%% i) carácter para separar el teléfono del e-mail del cliente,
%% ii) carácter para los campos vacíos cuando se usa \ItemX,
%% iii) carácter para las celdas vacías cuando la descripción del ítem ocupa más que una línea.
%% iv) carácter de retorno de carro en el cuadro de la factura,
\def\@CaracterSeparaTelefonoEmail{$\diamond$}
\def\@CaracterItemXVacio{...}
\def\@CaracterCeldasVacias{\mbox{}\hfill$\cdot$\hfill\mbox{}}
\def\@CaracterCR{\flechaCR}
% \def\@CaracterCR{$\hookleftarrow$}
% \def\@CaracterCR{$\cwrightarcarrow$}% Usando el paquete 'fnsymbol'.
% \def\@CaracterCR{$\cwsearcarrow$}% Usando el paquete 'fnsymbol'.
\def\flechaCR{%
 \raisebox{-0.4ex}{%
  \begin{tikzpicture}
  \draw[line width=0.075ex] (0,0) arc (20:70:0.75ex) + (0,0) arc (-70:-20:0.75ex) ++ (0.8ex,0.55ex) arc (0:-100:1ex);
 \end{tikzpicture}}}

%% Separación entre la última letra y el carácter que indica que se continúa en la línea siguiente en la descripción cuando ocupa más de una línea. No vale la pena hacer una macro para cambiar esto.
\setlength{\@SeparaFinLineaDesc}{0.05cm}

%% Separación entre el inicio de una columna en la tabla y el inicio del texto.
\tabcolsep=0.15cm
%</def>
%<class|def>
%<*class>
%% Fijamos en cero los descuentos totales (necesario).
\def\@DescuentoGporc{0}
\def\@DescuentoRporc{0}
\def\@DescuentoAporc{0}
\def\@DescuentoEporc{0}
\def\@DescuentoGnum{0}
\def\@DescuentoRnum{0}
\def\@DescuentoAnum{0}
\def\@DescuentoEnum{0}

%% \Fecha, \RazonSocial, \Nombre, \RIF, \CI, \Contacto, \Dirección, \Telefono, \Email, \Emisor, \Proveedor.
\def\Fecha#1{\gdef\@Fecha{#1}}
\def\RazonSocial#1{\gdef\@RazonSocial{#1}}
\def\Nombre#1{\gdef\@RazonSocial{#1}\@nombretrue}
\def\RIF#1{\gdef\@RIF{#1}}
\def\CI#1{\gdef\@RIF{#1}\let\@@RIF\@@CI\let\@CI\@RIF}
\def\Contacto#1{\gdef\@Contacto{#1}}
\def\Direccion#1{\gdef\@Direccion{#1}}
\def\Telefono#1{\gdef\@Telefono{#1}}
\def\Email#1{\gdef\@Email{#1}}
\def\Conforme#1{\gdef\@Conforme{#1}}
\def\Emisor#1{\gdef\@Emisor{#1}}
\def\Proveedor#1{\gdef\@Proveedor{#1}}

%% Los descuentos totales.
\NewDocumentCommand{\Descuento}{s m}{%
 \IfBooleanTF{#1}
  {\@DescGnumtrue\@DescRnumtrue\@DescAnumtrue\@DescEnumtrue
  \gdef\@DescuentoGnum{#2}\gdef\@DescuentoRnum{#2}\gdef\@DescuentoAnum{#2}\gdef\@DescuentoEnum{#2}}
  {\@DescGnumfalse\@DescRnumfalse\@DescAnumfalse\@DescEnumfalse
  \gdef\@DescuentoGporc{#2}\gdef\@DescuentoRporc{#2}\gdef\@DescuentoAporc{#2}\gdef\@DescuentoEporc{#2}}%
 \@DescGtrue\@DescRtrue\@DescAtrue\@DescEtrue\@Descuentostrue}

\NewDocumentCommand{\DescuentoG}{s m}{%
 \IfBooleanTF{#1}{\@DescGnumtrue\gdef\@DescuentoGnum{#2}}{\@DescGnumfalse\gdef\@DescuentoGporc{#2}}%
 \@DescGtrue\@Descuentostrue}

\NewDocumentCommand{\DescuentoR}{s m}{%
 \IfBooleanTF{#1}{\@DescRnumtrue\gdef\@DescuentoRnum{#2}}{\@DescRnumfalse\gdef\@DescuentoRporc{#2}}%
 \@DescRtrue\@Descuentostrue}

\NewDocumentCommand{\DescuentoA}{s m}{%
 \IfBooleanTF{#1}{\@DescAnumtrue\gdef\@DescuentoAnum{#2}}{\@DescAnumfalse\gdef\@DescuentoAporc{#2}}%
 \@DescAtrue\@Descuentostrue}

\NewDocumentCommand{\DescuentoE}{s m}{%
 \IfBooleanTF{#1}{\@DescEnumtrue\gdef\@DescuentoEnum{#2}}{\@DescEnumfalse\gdef\@DescuentoEporc{#2}}%
 \@DescEtrue\@Descuentostrue}

\def\Denom#1{\gdef\@Denominacion{#1}}%  La denominación puede ser 'FACTURA', 'COTIZACIÓN' u otra. Se predetermina una de estas dos según las opciones de la clase.

%% Número de la factura con \Num, número de control con \NumControl, y número de serie de control \NumSerieControl.
\def\Num#1{\gdef\@Num{\nplpadding{\@DigitosNumeracion}\npthousandsep{}\numprint{#1}}}
\def\NumControl#1{\gdef\@NumControl{\nplpadding{\@DigitosNumeracion}\npthousandsep{}\numprint{#1}}}%  Si el número de control no se especifica, toma el mismo que el de la factura
\def\NumSerieControl#1{\gdef\@NumSerieControl{#1}}%  Si el número de serie de control no se especifica, toma '00'.

%% Información de página: cabeceras de páginas o piés de página.
\def\InfoPagina#1{\gdef\@InfoPagina{#1}}

%% Texto que esclarece las condiciones del documento.
\NewDocumentCommand{\Condiciones}{+m}{\gdef\@Condiciones{#1}}

%% Resumen opcional que va a la derecha de los datos del cliente.
\NewDocumentCommand{\Resumen}{+m}{\gdef\@Resumen{#1}}

\AtBeginDocument{%
 \ifx\@undefined\@NumControl\let\@NumControl\@Num\fi
 \ifx\@undefined\@NumSerieControl\gdef\@NumSerieControl{00}\fi
 % Establecemos los porcentajes de las alícuotas, y redondeamos los descuentos.
 \FPupn\@AlicuotaGporc{\@AlicuotaG{} 100 * \@DigitosPorc{} round clip}%
 \FPupn\@AlicuotaRporc{\@AlicuotaR{} 100 * \@DigitosPorc{} round clip}%
 \FPupn\@AlicuotaAporc{\@AlicuotaA{} 100 * \@DigitosPorc{} round clip}%
 \FPupn\@DescuentoGporc{\@DescuentoGporc{} \@DigitosPorc{} round clip}%
 \FPupn\@DescuentoRporc{\@DescuentoRporc{} \@DigitosPorc{} round clip}%
 \FPupn\@DescuentoAporc{\@DescuentoAporc{} \@DigitosPorc{} round clip}%
 \FPupn\@DescuentoEporc{\@DescuentoEporc{} \@DigitosPorc{} round clip}%
 \FPupn\@DescuentoGfactor{100 \@DescuentoGporc{} /}%
 \FPupn\@DescuentoRfactor{100 \@DescuentoRporc{} /}%
 \FPupn\@DescuentoAfactor{100 \@DescuentoAporc{} /}%
 \FPupn\@DescuentoEfactor{100 \@DescuentoEporc{} /}}

%</class>
%<*class|def>
%% Posiciones (X,Y) de los objetos: i) fecha, ii) denominación, iii) condiciones, iv) número de control, v) firmas.
%<*class>
\def\PosFecha#1#2{%
 \IfBeginWith{#1}{-}
  {\StrBehind{#1}{-}[\templeng]\setlength{\@PosFechaX}{-\templeng}\booltrue{FechaXnegativo}}
  {\boolfalse{FechaXnegativo}\setlength{\@PosFechaX}{#1}}
 \IfBeginWith{#2}{-}
  {\StrBehind{#2}{-}[\templeng]\setlength{\@PosFechaY}{-\templeng}\booltrue{FechaYnegativo}}
  {\boolfalse{FechaYnegativo}\setlength{\@PosFechaY}{#2}}}

%</class>
%<def>\PosFecha{-0cm}{4.3cm}
%<*class>
\def\PosDenom#1#2{%
 \IfBeginWith{#1}{-}
  {\StrBehind{#1}{-}[\templeng]\setlength{\@PosDenomX}{-\templeng}\booltrue{DenomXnegativo}}
  {\boolfalse{DenomXnegativo}\setlength{\@PosDenomX}{#1}}
 \IfBeginWith{#2}{-}
  {\StrBehind{#2}{-}[\templeng]\setlength{\@PosDenomY}{-\templeng}\booltrue{DenomYnegativo}}
  {\boolfalse{DenomYnegativo}\setlength{\@PosDenomY}{#2}}}

%</class>
%<def>\PosDenom{0cm}{4.3cm}
%<*class>
\def\PosControl#1#2{%
 \IfBeginWith{#1}{-}
  {\StrBehind{#1}{-}[\templeng]\setlength{\@PosControlX}{-\templeng}\booltrue{ControlXnegativo}}
  {\boolfalse{ControlXnegativo}\setlength{\@PosControlX}{#1}}
 \IfBeginWith{#2}{-}
  {\StrBehind{#2}{-}[\templeng]\setlength{\@PosControlY}{-\templeng}\booltrue{ControlYnegativo}}
  {\boolfalse{ControlYnegativo}\setlength{\@PosControlY}{#2}}}

%</class>
%<def>\PosControl{0cm}{-2.5cm}
%<*class>
\def\PosCond#1#2{%
 \setlength{\@PosCondX}{#1}%
 \IfBeginWith{#2}{-}
  {\StrBehind{#2}{-}[\templeng]\setlength{\@PosCondY}{-\templeng}\booltrue{CondYnegativo}}
  {\boolfalse{CondYnegativo}\setlength{\@PosCondY}{#2}}}
%</class>
%<def>\PosCond{0cm}{-5.3cm}
%% 'X' no acepta valores negativos en \PosCond.
%<*class>

\def\PosFirmas#1#2#3{%
 \setlength{\@PosFirmasXuno}{#1}%
 \setlength{\@PosFirmasXdos}{#2}%
 \IfBeginWith{#3}{-}
  {\StrBehind{#3}{-}[\templeng]\setlength{\@PosFirmasY}{-\templeng}\booltrue{FirmasYnegativo}}
  {\boolfalse{FirmasYnegativo}\setlength{\@PosFirmasY}{#3}}}
%</class>
%<def>\PosFirmas{5cm}{1cm}{-2.4cm}
%% La firma se define con un X_inicial, un X_final y un Y_inicial (Xo,Xf,Y)

%% Tamaño y grosor de la línea de las firmas.
%<*class>
\def\LineaFirmas#1#2{%
 \setlength{\@TamLineaFirmas}{#1}%
 \setlength{\@GrosorLineaFirmas}{#2}}
%</class>
%<def>\LineaFirmas{5.5cm}{0.7pt}

%% Separación mínima horizontal entre los totales en modo de filas y distancia vertical entre esas líneas, fija.
%<class>\def\SepFilas#1#2{\setlength{\@SeparaMinTotales}{#1}\setlength{\@SeparaFilas}{#2}}
%<def>\SepFilas{0.8cm}{2.5pt}

%% Separación vertical entre los elementos de la factura (entre el encabezado y el cuadro de la 'factura', luego desde dicho cuadro hasta la descripción, o hasta los totales en modo de filas).
%<class>\def\SepElementos#1{\setlength{\@SeparaElementos}{#1}}
%<def>\SepElementos{0.2cm}

%% Separación horizontal entre las cajas del encabezado y separación interna entre la línea y el texto.
%<class>\def\SepEncabez#1#2{\setlength{\@SeparaEncabez}{#1}\setlength{\@SeparaInternaEncabez}{#2}}
%<def>\SepEncabez{0.2cm}{6pt}

%% Separación interna entre la línea y el texto de la descripción.
%<class>\def\SepDescrip#1{\setlength{\@SeparaInternaDescrip}{#1}}
%<def>\SepDescrip{6pt}

%% Grosor de la línea de las cajas del encabezado, curvatura de la esquina y sombra.
%<class>\def\LineaEncabez#1#2#3{\setlength{\@GrosorLineaEncabez}{#1}\setlength{\@EsquinaLineaEncabez}{#2}\setlength{\@SombraEncabez}{#3}}
%<def>\LineaEncabez{0.4pt}{10pt}{0pt}

%% Grosor de la línea de la descripción, curvatura de la esquina y sombra.
%<class>\def\LineaDescrip#1#2#3{\setlength{\@GrosorLineaDescrip}{#1}\setlength{\@EsquinaLineaDescrip}{#2}\setlength{\@SombraDescrip}{#3}}
%<def>\LineaDescrip{0.4pt}{0pt}{4pt}

%% El espacio vertical que hay que avanzar sólo en la primera página del reporte antes de empezar a escribir sobre él. Usable cuando la primera página tiene un membrete y las demás no, es decir, cuando se usa \FondoReporte y no \FondoReporte*.
%<class>\def\InicioReporte#1{\setlength{\@InicioReporte}{#1}}
%<def>\InicioReporte{1.6cm}

%% Tipos de letra para cada elemento posible:
%% Esta es la letra de la descripción de los items; y el espacio \baselineskip de *toda* la tabla de la factura se fija en este comando únicamente (se predeterminó 18pt).
%<class>\def\LetraItems#1{\gdef\@LetraItems{#1\selectfont}}
%<def>\LetraItems{\fontsize{14}{18}}

%% Con este comando se cambia la etra del título de la tabla, es decir, los textos 'Cantidad, 'Descripción', etc...
%<class>\def\LetraTitCuadro#1{\gdef\@LetraTitCuadro{#1\selectfont}}
%<def>\LetraTitCuadro{\fontsize{10}{10}\bfseries}

%% Tipo de letra de los títulos de los totales, por ejemplo los textos: 'B.I. G', 'IVA G'.
%<class>\def\LetraTitTotales#1{\gdef\@LetraTitTotales{#1\selectfont}}
%<def>\LetraTitTotales{\fontsize{12}{12}\bfseries}

%% Letra con la que salen los totales parciales, es decir, los números, exceptuando el total general.
%<class>\def\LetraNumTotales#1{\gdef\@LetraNumTotales{#1\selectfont}}
%<def>\LetraNumTotales{\fontsize{14}{12}}

%% Letra con la que sale la palabra 'TOTAL'.
%<class>\def\LetraTitTotal#1{\gdef\@LetraTitTotal{#1\selectfont}}
%<def>\LetraTitTotal{\fontsize{12}{12}\bfseries}

%% Letra para el total general, el monto.
%<class>\def\LetraNumTotal#1{\gdef\@LetraNumTotal{#1\selectfont}}
%<def>\LetraNumTotal{\fontsize{14}{14}\bfseries}

%% Tipo de letra para los títulos de las cajas del encabezado, por ejemplo: 'Datos del cliente'.
%<class>\def\LetraTitEnc#1{\gdef\@LetraTitEnc{#1\selectfont}}
%<def>\LetraTitEnc{\fontsize{11}{12.5}\slshape}

%% Tipo de letra para el texto en el encabezado de la factura.
%<class>\def\LetraEncFactura#1{\gdef\@LetraEncFactura{#1\selectfont}}
%<def>\LetraEncFactura{\fontsize{11}{12.5}}

%% Tipo de letra para el texto en el encabezado del reporte.
%<class>\def\LetraEncReporte#1{\gdef\@LetraEncReporte{#1\selectfont}}
%<def>\LetraEncReporte{\fontsize{13}{16}}

%% Letra para los montos individuales de la factura y las cantidades.
%<class>\def\LetraNumeros#1{\gdef\@LetraNumeros{#1\selectfont}}
%<def>\LetraNumeros{\fontsize{14}{14}}

%% El tipo de IVA ('G', 'R', 'A' o '(E)') también tiene su tipo de letra.
%<class>\def\LetraTipoIVA#1{\gdef\@LetraTipoIVA{#1\selectfont}}
%<def>\LetraTipoIVA{\fontsize{12}{12}}

%% Letra para la descripción larga (comando \Descripcion).
%<class>\def\LetraDescripcion#1{\gdef\@LetraDescripcion{#1\selectfont}}
%<def>\LetraDescripcion{\fontsize{14}{16.8}}

%% Tipo de letra para el texto bajo las líneas para firmar.
%<class>\def\LetraFirmas#1{\gdef\@LetraFirmas{#1\selectfont}}
%<def>\LetraFirmas{\fontsize{12}{12}}

%% Tipo de letra para las condiciones del documento.
%<class>\def\LetraCondiciones#1{\gdef\@LetraCondiciones{#1\selectfont}}
%<def>\LetraCondiciones{\fontsize{12}{12}}

%% Letra para la denominación del documento ('FACTURA', 'COTIZACIÓN',...).
%<class>\def\LetraDenom#1{\gdef\@LetraDenom{#1\selectfont}}
%<def>\LetraDenom{\fontsize{14}{14}\bfseries}

%% Letra para la numeración de la factura.
%<class>\def\LetraNumeracion#1{\gdef\@LetraNumeracion{#1\selectfont}}
%<def>\LetraNumeracion{\fontsize{14}{14}\bfseries\color{red}}

%% Letra para la fecha de emisión.
%<class>\def\LetraFecha#1{\gdef\@LetraFecha{#1\selectfont}}
%<def>\LetraFecha{\fontsize{14}{14}}

%% Letra para el título del reporte.
%<class>\def\LetraTitReporte#1{\gdef\@LetraTitReporte{#1\selectfont}}
%<def>\LetraTitReporte{\fontsize{16}{22}\bfseries}

%% Letra para las cabeceras de las páginas en el modo reporte.
%<class>\def\LetraInfoPagina#1{\gdef\@LetraInfoPagina{#1\selectfont}}
%<def>\LetraInfoPagina{\fontsize{12}{12}\slshape}

%% Letra para el reporte.
%<class>\def\LetraReporte#1{\gdef\@LetraReporte{#1\selectfont}}
%<def>\LetraReporte{\fontsize{12}{20}}

%</class|def>
%<*class>
%% Comando para incluir la firma escaneada en el sitio donde va la línea de la firma del emisor.
\NewDocumentCommand{\FirmaFactura}{m O{0pt} O{0pt}}{% \FirmaFactura{imagen}[x-corr][y-corr]
 \if@factura
  \RequirePackage{graphicx}
  \ifx&#2&\else\setlength{\@FirmaFacturaXcorr}{#2}\fi
  \ifx&#3&\else\setlength{\@FirmaFacturaYcorr}{#3}\fi
  \savebox{\@CajaFirmaEmisor}{#1}
  \if@reporte
   \expandafter\AtBeginShipoutNext
  \else
   \expandafter\AtEndDocument
  \fi
  {%
   \begin{textblock*}{\@TamLineaFirmas}%
    (\textwidth+\oddsidemargin+1in-\@TamLineaFirmas/2-\wd\@CajaFirmaEmisor/2-\@PosFirmasXdos+\@FirmaFacturaXcorr,\@PosFirmasY-\ht\@CajaFirmaEmisor-\dp\@CajaFirmaEmisor+\@FirmaFacturaYcorr)%
    \usebox{\@CajaFirmaEmisor}%
   \end{textblock*}}%
 \fi}

\NewDocumentCommand{\FirmaReporte}{O{} O{0pt} O{0pt} G{\@Proveedor} O{2cm} O{1.5cm}}{% \Firma[imagen][x-corr][y-corr]{texto}[posición en X desde la derecha][tamaño linea]
 \renewcommand{\baselinestretch}{1}\selectfont
 \newif\if@firma@dibujo
 \newbox{\TextoFirma}%
 \newbox{\DibujoFirma}%
 \ifx&#1&\else\savebox{\DibujoFirma}{#1}\@firma@dibujotrue\fi
 \ifx&#2&\else\setlength{\@FirmaReporteXcorr}{#2}\fi
 \ifx&#3&\else\setlength{\@FirmaReporteYcorr}{#3}\fi
 \savebox{\TextoFirma}{#4}%
 \ifx&#5&\setlength{\@FirmaReporteTextPos}{2cm}\else\setlength{\@FirmaReporteTextPos}{#5}\fi
 \ifx&#6&\setlength{\@FirmaReporteTamLinea}{1.5cm}\else\setlength{\@FirmaReporteTamLinea}{#6}\fi
 \@LetraFirmas
 \if@firma@dibujo
  \newlength{\@FirmaReporteoddeven}%
  \setlength{\@FirmaReporteFirmaPos}{\zposy{Firma@zref@PosY}sp}%
 \fi
 \ifdim\wd\DibujoFirma>\wd\TextoFirma
  \setlength{\@FirmaReporteTamLinea}{\@FirmaReporteTamLinea+\wd\DibujoFirma}%
 \else
  \setlength{\@FirmaReporteTamLinea}{\@FirmaReporteTamLinea+\wd\TextoFirma}%
 \fi
 \par
 \vspace*{\ht\DibujoFirma}%
 \vspace*{\dp\DibujoFirma}%
 \hfill
 \parbox{\@FirmaReporteTamLinea}{%
  \if@firma@dibujo\zsaveposy{Firma@zref@PosY}\fi
  \rule{\@FirmaReporteTamLinea}{\@GrosorLineaFirmas}\\
  \centering{\usebox{\TextoFirma}}}%
 \hspace*{\@FirmaReporteTextPos}\par
 \if@firma@dibujo
  \mbox{}%
  \par
  \ifodd\c@page
   \setlength{\@FirmaReporteoddeven}{\oddsidemargin}%
  \else
   \setlength{\@FirmaReporteoddeven}{\evensidemargin}%
  \fi
  \begin{textblock*}{\@FirmaReporteTamLinea}
  (\textwidth+\@FirmaReporteoddeven+1in-0.5\@FirmaReporteTamLinea-0.5\wd\DibujoFirma-\@FirmaReporteTextPos+\@FirmaReporteXcorr,
   \paperheight-\@FirmaReporteFirmaPos-\ht\DibujoFirma-\dp\DibujoFirma+\@FirmaReporteYcorr)
   \noindent\usebox{\DibujoFirma}%
  \end{textblock*}
 \fi}

%% Con \FondoFactura le damos el nombre del archivo que contiene el formato de la factura, por ejemplo para compilaciones con 'prefactura', 'cotizacion' o para incluir una imagen de fondo como 'marca de agua'.
\newcommand{\FondoFactura}[1]{
 \if@factura
  \RequirePackage{graphicx}
  \@fondofacturatrue
  \gdef\@FondoFactura{#1}
 \fi}

%% Con \FondoReporte le damos el nombre del archivo que contiene el formato del reporte. Existen dos posibilidades: que dicho fondo salga en todas las páginas o sólo en la primera.
\NewDocumentCommand{\FondoReporte}{s m}{
 \if@reporte
  \@fondoreportetrue
  \RequirePackage{graphicx}
  \gdef\@FondoReporte{#2}
  \IfBooleanT{#1}{\@fondoreportestartrue}% Con * sale en todas las páginas; sin * sale sólo en la primera página.
 \fi}

%% Comando para establecer desde el preámbulo el estilo de página (\pagestyle) del reporte, tanto para la primera página como para las siguientes.
\NewDocumentCommand{\EstiloPagReporte}{o m}{
 \gdef\@EstiloPagReporteResto{#2}
 \IfValueTF{#1}{\gdef\@EstiloPagReporteUno{#1}}{\gdef\@EstiloPagReporteUno{\@EstiloPagReporteResto}}}

%% El título para el reporte.
\NewDocumentCommand{\TituloReporte}{s m}{
 \gdef\@TituloReporte{#2}%
 \IfBooleanTF{#1}{% Con '*' sale el título en las cabeceras o piés. Sin '*' no.
  \gdef\@InfoPagina{\let\\\relax\@InfoPaginaTitulo}}%
 {\let\@InfoPagina\@InfoPaginaNoTitulo}}

%% Para cada cliente o para cada personalización se puede tener un archivo .def o .tex con su nombre y ciertas macros cargadas. Ese archivo lo ponemos incluir con '\Cliente' en lugar de usar \input, y la extensión deberá ser .def o .tex.
\newcommand{\Cliente}[1]{%
 \IfFileExists{#1.def}{\input{#1.def}}{
  \IfFileExists{#1.tex}{\input{#1.tex}}{
   \ClassError{factura}{** No existe #1.def ni #1.tex **}{}}}}

%% Comando para mostrar macros con '@'.
\newcommand{\mostrar}[1]{\csname #1\endcsname}

%% Longitudes para uso interno.
\newlength{\@TamDatos}
\newlength{\@TamResumen}
\newlength{\@TamFinalEncabez}
\newlength{\@TamLineaFirmas}
\newlength{\@TamNumItem}
\newlength{\@TamCantidad}
\newlength{\@TamDescrip}
\newlength{\@TamPrecioU}
\newlength{\@TamDescuento}
\newlength{\@TamPrecioT}
\newlength{\@GrosorLineaFirmas}
\newlength{\@GrosorLineaEncabez}
\newlength{\@GrosorLineaDescrip}
\newlength{\@EsquinaLineaEncabez}
\newlength{\@EsquinaLineaDescrip}
\newlength{\@SombraEncabez}
\newlength{\@SombraDescrip}
\newlength{\@LineaNodoXo}
\newlength{\@LineaNodoYo}
\newlength{\@LineaNodoXf}
\newlength{\@LineaNodoYf}
\newlength{\@SepTotales}
\newlength{\@PosFechaX}
\newlength{\@PosFechaY}
\newlength{\@PosDenomX}
\newlength{\@PosDenomY}
\newlength{\@PosFirmasXuno}
\newlength{\@PosFirmasXdos}
\newlength{\@PosFirmasY}
\newlength{\@PosCondX}
\newlength{\@PosCondY}
\newlength{\@PosControlX}
\newlength{\@PosControlY}
\newlength{\@EspacioVacioInicial}
\newlength{\@EspacioVacioFinal}
\newlength{\@SeparaEncabez}
\newlength{\@SeparaInternaEncabez}
\newlength{\@SeparaInternaDescrip}
\newlength{\@SeparaElementos}
\newlength{\@SeparaMinTotales}
\newlength{\@SeparaFilas}
\newlength{\@SeparaFinLineaDesc}
\newlength{\@InicioReporte}
\newlength{\@FirmaFacturaXcorr}
\newlength{\@FirmaFacturaYcorr}
\newlength{\@FirmaReporteXcorr}
\newlength{\@FirmaReporteYcorr}
\newlength{\@FirmaReporteTextPos}
\newlength{\@FirmaReporteFirmaPos}
\newlength{\@FirmaReporteTamLinea}
\newlength{\@TempDimen}

%% Cajas para uso interno.
\newbox{\@CajaDatos}
\newbox{\@CajaResumen}
\newbox{\@CajaFirmaEmisor}
\newbox{\@CajaFirmas}
\newbox{\@CajaFecha}
\newbox{\@CajaDenom}
\newbox{\@CajaControl}
\newbox{\@CajaCond}
\newbox{\@CajaEspacioVacio}
\newbox{\@CajaPrueba}
\newbox{\@CajaCaracterCR}

%% Contadores para uso interno para uso interno:
\newcounter{@IVANoGeneral}%  '0' con sólo IVA G, '1' cuando hay IVA R o IVA A, y '2' cuando hay ambos.
\newcounter{@NumItem}%  Número del ítem actual, para uso de algunas macros en el cuadro de la factura y para cuando se usa la opción 'numitem'.

\input{factura.def}%  Cargamos los valores predeterminados.

\if@todosiva
 \@BIRtrue
 \@BIAtrue
 \@Exentotrue
 \@Gtrue
\fi

\if@csv%  Abre el archivo csv.
 \newwrite\csv
 \immediate\openout\csv=\jobname.csv
\fi

\if@spanish
 \RequirePackage[spanish]{babel}%  Babel en castellano.
 \RequirePackage[T1]{fontenc}%  Codificación T1 para las tipografías.
 \IfFileExists{lmodern.sty}{\RequirePackage{lmodern}}{}
\fi

\if@exparriba
 \RequirePackage{zref-savepos}[2016/05/21]%  Para guardar la posición en 'Y'.
\fi

\if@reporte
 \RequirePackage{eso-pic}%  Para el comando \AddToShipoutPicture.
 \RequirePackage{zref-savepos}%  Para la firma, que debe ser cargado aquí porque \FirmaReporte no se ejecuta desde el preámbulo.
\fi

%% Comando para escribir el encabezado en la factura.
\newcommand\@EncabezadoFactura{%
 \ifdefvoid{\@Resumen}{\@EscribeDatos}{\@EscribeDatosResumen}%
 \vspace*{\@SeparaElementos}%
 \if@exparriba\else\vfill\fi}

%% Comando para escribir el encabezado en el reporte.
\newcommand\@EncabezadoReporte{%
 \vspace*{-\topskip}%
 \if@fondoreporte
  \if@fondoreportestar
  \else
   \vspace*{\@InicioReporte}%
  \fi
 \fi
 \@EscribeDatosReporte
 \@LetraReporte}

%% El ambiente 'factura', usando el paquete 'environ' para su definición, y el comando auxiliar \@FacturaAuxCmd.
%% Gracias a Heiko Oberdiek y David Carlisle (Thanks to Heiko Oberdiek and David Carlisle).
%% http://tex.stackexchange.com/questions/108565/know-the-cell-width-with-tabular-or-include-a-paragraph-box-without-specifying
\NewEnviron{factura}{%
 \expandafter\@FacturaAuxCmd\expandafter{\BODY}%
 \ifnum\value{page}=1\else\ClassError{factura}{** La factura ocupa mas que una pagina **}{}\fi
}

%% Comando auxiliar para agregar un carácter al final de cada línea en la descripción dentro del cuadro de la factura si ocupa ésta más de una línea.
%% Gracias a Gustavo Mezzetti y David Carlisle (Thanks to Gustavo Mezzetti and David Carlisle)
%% http://tex.stackexchange.com/questions/296035/insert-a-special-character-at-each-end-of-line-in-a-paragraph
%% http://tex.stackexchange.com/questions/248944/how-to-put-before-lines
\newcommand{\@DescripcionAuxCmd}[2]{%
 \immediate\write\@auxout{\gdef\noexpand\@TamDescrip{\the\linewidth}}% Para poder establecer la línea diagonal hay que saber el tamaño del campo de la descripción.
 \setbox0\hbox{\parbox[t]{\linewidth}{#1%
  \if@impdesc\hfill\ \@EscribeTipoDeImpuesto{#2}\fi%
  \par\global\count1=\prevgraf}}%
 \ifnum\count1 = 1
  #1%
  \if@impdesc\hfill\ \@EscribeTipoDeImpuesto{#2}\fi
 \else
  \parbox[t]{\linewidth-\wd\@CajaCaracterCR-\@SeparaFinLineaDesc}{%
   \David@XStart#1\David@XEnd
   \par
   \count0=\prevgraf
   \count2=\prevgraf
   \loop
    \ifnum\count0=\count2
     \if@impdesc
      \vskip-\baselineskip
      \mbox{}\hfill\rlap{\hspace*{\wd\@CajaCaracterCR}\hspace*{\@SeparaFinLineaDesc}\llap{\@EscribeTipoDeImpuesto{#2}}}%
     \fi
    \else
     \mbox{}\hfill\rlap{\hspace*{\@SeparaFinLineaDesc}\usebox{\@CajaCaracterCR}}%
    \fi
    \vskip-2\baselineskip
    \advance\count0 -1
    \ifnum\count0 > 0
   \repeat
   \kern\count2\baselineskip\mbox{}%
   \strut}%
 \fi}

%% Comandos auxiliares para colocar en \parbox cada celda.
\newcommand{\@NumItemAuxCmd}[1]{%
 \savebox{\@CajaPrueba}{#1}%
 \ifdim\wd\@CajaPrueba > \@TamNumItem \global\@TamNumItem=\wd\@CajaPrueba\fi
 \parbox[t]{\@TamNumItem}{#1}}

\newcommand{\@CantidadAuxCmd}[1]{%
 \savebox{\@CajaPrueba}{#1}%
 \ifdim\wd\@CajaPrueba > \@TamCantidad \global\@TamCantidad=\wd\@CajaPrueba\fi
 \parbox[t]{\@TamCantidad}{#1}}

\newcommand{\@PrecioUAuxCmd}[1]{%
 \savebox{\@CajaPrueba}{#1}%
 \ifdim\wd\@CajaPrueba > \@TamPrecioU \global\@TamPrecioU=\wd\@CajaPrueba\fi
 \parbox[t]{\@TamPrecioU}{#1}}

\newcommand{\@DescuentoAuxCmd}[1]{%
 \savebox{\@CajaPrueba}{#1}%
 \ifdim\wd\@CajaPrueba > \@TamDescuento \global\@TamDescuento=\wd\@CajaPrueba\fi
 \parbox[t]{\@TamDescuento}{#1}}

\newcommand{\@PrecioTAuxCmd}[1]{%
 \savebox{\@CajaPrueba}{#1}%
 \ifdim\wd\@CajaPrueba > \@TamPrecioT \global\@TamPrecioT=\wd\@CajaPrueba\fi
 \parbox[t]{\@TamPrecioT}{#1}}

%% Presentación de totales en modo de columnas.
\newcommand{\@EscribeTotalCol}[1]{%
 \expandafter\FPifeq\csname Desc#1\endcsname{0}%
  \if@ivaexpresado\@EscribeTotalColBI{#1}\fi
 \else
  \@EscribeTotalColSubt{#1}%
  \@EscribeTotalColDesc{#1}%
  \if@ivaexpresado\@EscribeTotalColBI{#1}\fi
 \fi}

%% Forma agupada para la presentación de totales en modo de columnas.
\newcommand{\@EscribeTotalColAgrupado}{%
 \if@Exento\if@DescE\@EscribeTotalColSubt{E}\fi\fi
 \if@BIR\if@DescR\@EscribeTotalColSubt{R}\fi\fi
 \if@DescG\@EscribeTotalColSubt{G}\fi
 \if@BIA\if@DescA\@EscribeTotalColSubt{A}\fi\fi
 \if@Exento\if@DescE\@EscribeTotalColDesc{E}\fi\fi
 \if@BIR\if@DescR\@EscribeTotalColDesc{R}\fi\fi
 \if@DescG\@EscribeTotalColDesc{G}\fi
 \if@BIA\if@DescA\@EscribeTotalColDesc{A}\fi\fi
 \if@ivaexpresado
  \if@Exento\@EscribeTotalColBI{E}\fi
  \if@BIR\@EscribeTotalColBI{R}\fi
  \@EscribeTotalColBI{G}%
  \if@BIA\@EscribeTotalColBI{A}\fi
  \if@BIR\@EscribeTotalColAlicuota{R}\fi
  \@EscribeTotalColAlicuota{G}%
  \if@BIA\@EscribeTotalColAlicuota{A}\fi
 \fi}

\newcommand{\@EscribeTotalColBI}[1]{%
 \@LetraTitTotales \csname @@BI#1\endcsname
  \ifx#1E%
  \else
   \if@G\ \hfill(\csname @Alicuota#1porc\endcsname\%)\else\mbox{}\fi
  \fi
 & \@LetraNumTotales\numprint{\csname BI#1\endcsname} \\}

\newcommand{\@EscribeTotalColAlicuota}[1]{%
 {\@LetraTitTotales \csname @@Alicuota#1\endcsname\ \hfill (\csname @Alicuota#1porc\endcsname\%)}
 & \@LetraNumTotales\numprint{\csname Alicuota#1\endcsname} \\}

\newcommand{\@EscribeTotalColSubt}[1]{%
 {\@LetraTitTotales \csname @@Subtotal#1\endcsname}
 & \@LetraNumTotales\numprint{\csname Subt#1\endcsname} \\}

\newcommand{\@EscribeTotalColDesc}[1]{%
 {\@LetraTitTotales \csname @@Descuento#1\endcsname
 \csname if@Desc#1num\endcsname \else \ \hfill (\csname @Descuento#1porc\endcsname\%)\fi}
 & \@LetraNumTotales\numprint{\csname Desc#1\endcsname} \\}

%% Presentación de los totales en modo filas.
\newcommand{\@EscribeTotalFilasBI}[1]{%
 \@EscribeTotalFilasBIizq{#1}: & \@EscribeTotalFilasBIder{#1}}

\newcommand{\@EscribeTotalFilasAlicuota}[1]{%
 \@EscribeTotalFilasAlicuotaizq{#1}: & \@EscribeTotalFilasAlicuotader{#1}}

\newcommand{\@EscribeTotalFilasDesc}[1]{%
 \@EscribeTotalFilasDescizq{#1}: & \@EscribeTotalFilasDescder{#1}}

\newcommand{\@EscribeTotalFilasSoloBI}[1]{%
 {\@LetraTitTotales\@EscribeTotalFilasBIizq{#1}:} {\@LetraNumTotales\@EscribeTotalFilasBIder{#1}}}

\newcommand{\@EscribeTotalFilasSoloDesc}[1]{%
 {\@LetraTitTotales\@EscribeTotalFilasDescizq{#1}:} {\@LetraNumTotales\@EscribeTotalFilasDescder{#1}}}

\newcommand{\@EscribeTotalFilasSoloAlicuota}[1]{%
 {\@LetraTitTotales\@EscribeTotalFilasAlicuotaizq{#1}:} {\@LetraNumTotales\@EscribeTotalFilasAlicuotader{#1}}}

\newcommand{\@EscribeTotalFilasBIizq}[1]{%
 \@LetraTitTotales\csname @@BI#1\endcsname
 \ifx#1G%
  \if@G \ (\@AlicuotaGporc\%)\fi%  Si hay otra B.I. que no sea general, escribimos el porcentaje explícito en la general.
 \else
  \ifx#1E%
  \else
  \ (\csname @Alicuota#1porc\endcsname\%)%
  \fi
 \fi}

\newcommand{\@EscribeTotalFilasBIder}[1]{%
 \@LetraNumTotales\numprint{\csname BI#1\endcsname}}

\newcommand{\@EscribeTotalFilasAlicuotaizq}[1]{%
 \@LetraTitTotales\csname @@Alicuota#1\endcsname \ (\csname @Alicuota#1porc\endcsname\%)}

\newcommand{\@EscribeTotalFilasAlicuotader}[1]{%
 \@LetraNumTotales\numprint{\csname Alicuota#1\endcsname}}

\newcommand{\@EscribeTotalFilasDescizq}[1]{%
 \@LetraTitTotales\csname @@Descuento#1\endcsname \ (\csname @Descuento#1porc\endcsname\%)}

\newcommand{\@EscribeTotalFilasDescder}[1]{%
 \@LetraNumTotales\numprint{\csname Desc#1\endcsname}}

\newcommand{\@EscribeTotalFilasAuxTotal}{\@LetraTitTotal\@@Total: & \@LetraNumTotal\numprint{\Total}}
 
\newcommand{\@EscribeTotalFilas}[2][]{%
 \begin{tabular}[b]{@{}l@{\extracolsep{1ex}}r@{}}% ¡Esta tabla tiene que abrir hacia abajo para que la separación entre las filas se 
  \csname @EscribeTotalFilasBI\endcsname{#2}%
  \ifx#2E%
   \ifx#1T%
    \\[\@SeparaFilas]%
    \@EscribeTotalFilasAuxTotal
   \fi
  \else
   \\[\@SeparaFilas]%
   \csname @EscribeTotalFilasAlicuota\endcsname{#2}%
  \fi
 \end{tabular}}

\newcommand{\@GeneraCajasTotalesFilas}{%
 \if@Exento
  \newbox{\@CajaBIE}\newbox{\@CajaBIET}%
  \savebox{\@CajaBIE}{\@EscribeTotalFilasSoloBI{E}}%
  \savebox{\@CajaBIET}{\@EscribeTotalFilas[T]{E}}%
 \fi
 \if@BIR
  \addtocounter{@IVANoGeneral}{1}%
  \newbox{\@CajaBIR}\newbox{\@CajaAliR}\newbox{\@CajaBIAliR}%
  \savebox{\@CajaBIR}{\@EscribeTotalFilasSoloBI{R}}%
  \savebox{\@CajaAliR}{\@EscribeTotalFilasSoloAlicuota{R}}%
  \savebox{\@CajaBIAliR}{\@EscribeTotalFilas{R}}%
 \fi
 \newbox{\@CajaBIG}\newbox{\@CajaAliG}\newbox{\@CajaBIAliG}%
 \savebox{\@CajaBIG}{\@EscribeTotalFilasSoloBI{G}}%
 \savebox{\@CajaAliG}{\@EscribeTotalFilasSoloAlicuota{G}}%
 \savebox{\@CajaBIAliG}{\@EscribeTotalFilas{G}}%
 \if@BIA
  \addtocounter{@IVANoGeneral}{1}%
  \newbox{\@CajaBIA}\newbox{\@CajaAliA}\newbox{\@CajaBIAliA}%
  \savebox{\@CajaBIA}{\@EscribeTotalFilasSoloBI{A}}%
  \savebox{\@CajaAliA}{\@EscribeTotalFilasSoloAlicuota{A}}%
  \savebox{\@CajaBIAliA}{\@EscribeTotalFilas{A}}%
 \fi}

\newcommand{\@EscribeTotalesFilasGET}{%
 \hspace*{\@SepTotales}\usebox{\@CajaBIG}%
 \hspace*{\@SepTotales}\usebox{\@CajaAliG}%
 \if@Exento\hspace*{\@SepTotales}\usebox{\@CajaBIE}\fi
 \hspace*{\@SepTotales}\usebox{\@CajaTotal}%
 \if@centrado\hspace*{\@SepTotales}\fi}

\newcommand{\@EscribeTotalesFilasGxET}{%
 \if@BIR\hspace*{\@SepTotales}\usebox{\@CajaBIAliR}\fi
 \hspace*{\@SepTotales}\usebox{\@CajaBIAliG}%
 \if@BIA\hspace*{\@SepTotales}\usebox{\@CajaBIAliA}\fi
 \hspace*{\@SepTotales}\if@Exento\usebox{\@CajaBIET}\else\usebox{\@CajaTotal}\fi
 \if@centrado\hspace*{\@SepTotales}\fi}

\newcommand{\@EscribeTotalesFilasRGA}{%
 \hspace*{\@SepTotales}\usebox{\@CajaBIAliR}%
 \hspace*{\@SepTotales}\usebox{\@CajaBIAliG}%
 \hspace*{\@SepTotales}\usebox{\@CajaBIAliA}%
 \hspace*{\@SepTotales}}

\newcommand{\@EscribeTotalesFilasRGAET}{%
 \@EscribeTotalesFilasRGA
 \if@Exento\usebox{\@CajaBIET}\else\usebox{\@CajaTotal}\fi
 \if@centrado\hspace*{\@SepTotales}\fi}

%% Escribe la letra que designa al tipo de impuesto que aplica al ítem.
\NewDocumentCommand{\@EscribeTipoDeImpuesto}{m}{%
 % Hay que abrir un grupo de ejecución porque el cambio en la tipografía altera la celda.
 {\if@G
   \@LetraTipoIVA
   \ifx#1G\@DenomAlicuotaG\fi% Si tiene IVA general escribimos 'G'.
   \ifx#1E\@DenomAlicuotaE\fi% Si está exento escribimos '(E)'.
   \ifx#1R\@DenomAlicuotaR\fi% Si tiene IVA reducido escribimos 'R'.
   \ifx#1A\@DenomAlicuotaA\fi% Si tiene IVA adicional escribimos 'A'.
  \fi}}
 
%% Comando para poner en cero los contadores de los totales porque el ambiente de la factura se evalúa tres veces y los totales se sumarían todos tres veces.
\newcommand{\@ZERO}{%
 \FPset\BIG{0}\global\let\BIG\BIG
 \FPset\BIR{0}\global\let\BIR\BIR
 \FPset\BIA{0}\global\let\BIA\BIA
 \FPset\BIE{0}\global\let\BIE\BIE
 \FPset\SubtE{0}\global\let\SubtE\SubtE
 \FPset\SubtG{0}\global\let\SubtG\SubtG
 \FPset\SubtR{0}\global\let\SubtR\SubtR
 \FPset\SubtA{0}\global\let\SubtA\SubtA
 \FPset\SubtX{0}\global\let\SubtX\SubtX
 \FPset\DescE{0}\global\let\DescE\DescE
 \FPset\DescG{0}\global\let\DescG\DescG
 \FPset\DescR{0}\global\let\DescR\DescR
 \FPset\DescA{0}\global\let\DescA\DescA
 \FPset\DescX{0}\global\let\DescX\DescX
 \FPset\AlicuotaG{0}\global\let\AlicuotaG\AlicuotaG
 \FPset\AlicuotaR{0}\global\let\AlicuotaR\AlicuotaR
 \FPset\AlicuotaA{0}\global\let\AlicuotaA\AlicuotaA}

%% Comandos para calcular todos los totales parciales y el total general.
\newcommand{\@CalculaTotalesI}{%
 \FPifeq\SubtG{0}\else\@CalculaTotalesII{G}\fi
 \FPifeq\SubtR{0}\else\@CalculaTotalesII{R}\fi
 \FPifeq\SubtA{0}\else\@CalculaTotalesII{A}\fi
 \FPifeq\SubtE{0}\else\@CalculaTotalesII{E}\fi
 \FPupn\Total{\BIE{} \BIR{} + \BIG{} + \BIA{} + \AlicuotaR{} + \AlicuotaG{} + \AlicuotaA{} + \@DigitosMoneda{} round}%
 \global\let\Total\Total}

\newcommand{\@CalculaTotalesII}[1]{%
 % Sumamos al descuento.
 \expandafter\FPupn\csname Desc#1\endcsname{\csname @Descuento#1factor\endcsname{} \csname Subt#1\endcsname{} * \csname @Descuento#1num\endcsname{} + \@DigitosMoneda{} round}%
 \global\expandafter\let\csname Desc#1\expandafter\endcsname\csname Desc#1\endcsname
 % Sumamos a la base imponible.
 \expandafter\FPupn\csname BI#1\endcsname{\csname Desc#1\endcsname{} \csname Subt#1\endcsname{} - \@DigitosMoneda{} round}%
 \global\expandafter\let\csname BI#1\expandafter\endcsname\csname BI#1\endcsname
 \ifx#1E%
 \else{%
  % Sumamos a la alícuota.
  \expandafter\FPupn\csname Alicuota#1\endcsname{\csname BI#1\endcsname{} \csname @Impuesto#1\endcsname{} * \@DigitosMoneda{} round}%
  \global\expandafter\let\csname Alicuota#1\expandafter\endcsname\csname Alicuota#1\endcsname}%
 \fi}

%% Comandos auxiliares para poder evaluar la definición de las columnas en la tabla con un comando que se expande completamente.
\def\@FacturaAuxColumnasEval{
 % Primera línea, la más externa.
 \ifbool{SinLineasVertExt}{}{|}
 % Columna para el número del ítem, si aplica.
 \ifbool{NumItem}{c}{r@{\extracolsep{0pt}}}
 % Segunda línea, que sale solamente cuando se usa la opción 'numitem'
 \ifbool{NumItem}{\ifbool{SinLineasVertInt}{}{|}}{}
 % Columna 'X' con DCU, columna fantasma con 'sincantidad' y columna 'c' con CDU.
 \ifbool{PrimeroDescrip}{X}{
  \ifbool{SinCantidad}{l@{\extracolsep{0pt}}}{c}}
 % Tercera línea.
 \ifbool{SinCantidad}{}{\ifbool{SinLineasVertInt}{}{|}}
 % Columna 'c' con DCU, columna 'r' con DUC, columna 'X' sin espacio para 'sincantidad' y columna 'X' con CDU.
 \ifbool{DCU}{c}{
  \ifbool{DUC}{r}{
   \ifbool{SinCantidad}{X@{\extracolsep{0pt}}}{X}}}
 % Cuarta línea, que sale solamente cuando no se usa 'sincantidad'. 
 \ifbool{SinCantidad}{}{\ifbool{SinLineasVertInt}{}{|}}
 % Columna 'c' para DUC y columna 'r' para cualquier otro caso (DCU, CDU y 'sincantidad').
 \ifbool{DUC}{c}{r}
 % Quinta línea. 
 \ifbool{SinLineasVertInt}{}{|}
 % Columna 'c' para 'descuentos' y columna 'r' sin espacio si no hay descuentos individuales.
 \ifbool{Descuentos}{c}{r@{\extracolsep{0pt}}}
 % Sexta línea, que sale solamente cuando hay descuentos.
 \ifbool{Descuentos}{\ifbool{SinLineasVertInt}{}{|}}{}
 % Columna 'r' siempre.
 r
 % Séptima y última línea.
 \ifbool{SinLineasVertExt}{}{|}}

%% Comando auxiliar para abrir la tabla del cuadro de la factura y expandir completamente las columnas.
\edef\@FacturaAuxInicioCmd{\noexpand\begin{tabularx}{\textwidth}{\@FacturaAuxColumnasEval}}

%% Comando auxiliar para abrir el '\multicolumn' para los totales en el modo de columnas y expandir completamente las columnas cuando hay o no barras verticales.
\edef\@ColumnasMultiColumnTotalesAuxCmd{%
 \noexpand\multicolumn{6}{\ifbool{SinLineasVertExt}{}{|} r}\begingroup
   \noexpand\ifdim \noexpand\ht\noexpand\@CajaEspacioVacio=0pt
   \noexpand\else
    \noexpand\if@linea\noexpand\zsaveposx{LineaNodoBCoordX}\noexpand\zsaveposy{LineaNodoBCoordY}\noexpand\fi\noexpand\fi% Fijamos la posición (x,y) final para la línea ya que estaremos justo en el punto donde escribimos el total, y hasta allí llega la línea en el modo de columnas.
    \noexpand\begin{tabular}[b]{@{\noexpand\extracolsep{2\noexpand\tabcolsep}}lr \ifbool{SinLineasVertExt}{}{|}}}

%% Comando para hacer los cálculos sobre cada ítem y establecer las macros con el contenido de cada ítem introducido.
\newcommand{\@CalculaItem}[5]{%
 \addtocounter{@NumItem}{1}%
 % Calculamos.
 \FPupn\PrecioU{#4 \@DigitosMoneda{} round}%
 \ifx\\#5\\\FPset\Dcto{0}\else\FPupn\Dcto{#5 \@DigitosPorc{} round clip}\fi% Fijamos en 0 el descuento si no se especifica.
 \FPupn\PrecioT{100 \Dcto{} 100 - / #2 * \PrecioU{} * \@DigitosMoneda{} round}%
 \global\let\PrecioU\PrecioU
 \global\let\Dcto\Dcto
 \global\let\PrecioT\PrecioT
 % Suma el elemento actual al subtotal acumulado.
 \expandafter\FPupn\csname Subt#1\endcsname{\PrecioT{} \csname Subt#1\endcsname{} + \@DigitosMoneda{} round}%
 \global\expandafter\let\csname Subt#1\expandafter\endcsname\csname Subt#1\endcsname
 % Guardamos en macros cada elemento agregado a la factura; por ejemplo: \@Item@i@Cantidad contiene la cantidad que se introdujo para el primer ítem; así mismo con ii@, @iii@, y así mismo también con @Descripcion, @PrecioU, @Descuento y @PrecioT.
 \expandafter\gdef\csname @Item@\romannumeral\value{@NumItem}@Cantidad\endcsname{\numprint{#2}}%
 \expandafter\gdef\csname @Item@\romannumeral\value{@NumItem}@Descripcion\endcsname{#3}%
 \expandafter\global\expandafter\edef\csname @Item@\romannumeral\value{@NumItem}@PrecioU\endcsname{\noexpand\numprint{\PrecioU}}%
 \expandafter\global\expandafter\edef\csname @Item@\romannumeral\value{@NumItem}@Descuento\endcsname{\noexpand\numprint{\Dcto}}%
 \expandafter\global\expandafter\edef\csname @Item@\romannumeral\value{@NumItem}@PrecioT\endcsname{\noexpand\numprint{\PrecioT}}}

% Macro interna para saber si una etiqueta existe o no.
\gdef\@pruebaref#1{%
 \expandafter\ifx\csname @Etiqueta@#1\endcsname\relax
  \ClassWarning{factura}{La etiqueta `#1' no está definida}{}\ignorespaces
  \@pruebareffalse
 \else
  \@pruebareftrue
 \fi}

% Comandos para las referencias: i) referencia al número de ítem, ii) a la cantidad, iii) a la descripción, iv) al precio unitario, v) al descuento, vi) al precio total.
\gdef\itemref#1{%
 \ifbool{NumItem}{}{\ClassWarning{factura}{Es recomendable usar la opción 'numitem' para enumerar los ítems}{}}%
 \@pruebaref{#1}\if@pruebaref \csname @Etiqueta@#1\endcsname \fi}
\gdef\cantref#1{\@pruebaref{#1}\if@pruebaref \csname @Item@\expandafter\romannumeral\csname @Etiqueta@#1\endcsname @Cantidad\endcsname \fi}
\gdef\descref#1{\@pruebaref{#1}\if@pruebaref \csname @Item@\expandafter\romannumeral\csname @Etiqueta@#1\endcsname @Descripcion\endcsname \fi}
\gdef\puref#1{\@pruebaref{#1}\if@pruebaref \csname @Item@\expandafter\romannumeral\csname @Etiqueta@#1\endcsname @PrecioU\endcsname \fi}
\gdef\dctoref#1{\@pruebaref{#1}\if@pruebaref \csname @Item@\expandafter\romannumeral\csname @Etiqueta@#1\endcsname @Descuento\endcsname \fi}
\gdef\ptref#1{\@pruebaref{#1}\if@pruebaref \csname @Item@\expandafter\romannumeral\csname @Etiqueta@#1\endcsname @PrecioT\endcsname \fi}

% Definimos un comando para la etiqueta, que se define dentro del entorno de la factura para que tenga alcance local; cuando se acaba dicho entorno, el comando \label vuelve a ser lo que está definido en latex.ltx.
\newcommand{\label@factura}[1]{%
 \expandafter\ifx\csname @Etiqueta@#1\endcsname\relax
  \expandafter\global\expandafter\edef\csname @Etiqueta@#1\endcsname{\arabic{@NumItem}}\ignorespaces
  \ClassInfo{factura}{Etiqueta `#1' definida para el ítem \arabic{@NumItem}}{}%
 \else
  \edef\@label@test@uno{\csname @Etiqueta@#1\endcsname}%
  \edef\@label@test@dos{\the@NumItem}%
  \ifx\@label@test@uno\@label@test@dos
  \else
   \ClassWarning{factura}{La etiqueta `#1' se definió más de una vez}{}\ignorespaces
  \fi
 \fi}

%% Comando auxiliar para la definición del ambiente de la factura; al final de este comando está el texto que va en el enddef del ambiente de la factura.
\newcommand{\@FacturaAuxCmd}[1]{%
 \if@exparriba
  \setlength{\@EspacioVacioInicial}{\zposy{EspacioVacioInicial}sp}%
  \setlength{\@EspacioVacioFinal}{\zposy{EspacioVacioFinal}sp}%
  \global\@EspacioVacioInicial=\@EspacioVacioInicial% ¿por qué tendré que globalizarlas?
  \global\@EspacioVacioFinal=\@EspacioVacioFinal
  \savebox{\@CajaEspacioVacio}{\parbox[b][\@EspacioVacioInicial-\@EspacioVacioFinal]{\@TamDescrip}{%
   \if@linea
    \if@lineacompleta
     \zsaveposy{LineaNodoBCoordY}%
    \else
     \if@lineahastatotal
     \else
      \zsaveposx{LineaNodoACoordX}\mbox{}\hfill \zsaveposx{LineaNodoBCoordX}\zsaveposy{LineaNodoBCoordY}%
     \fi
    \fi
   \fi}}%
  \ifdim \ht\@CajaEspacioVacio=0pt \global\@lineafalse \fi
 \fi
 
 \ifx\undefined\Total\relax\else\ClassError{factura}{** Parece ya haberse usado un entorno de factura **}{}\fi
 %
 % Comandos \David@SavePos, \David@XStart, \David@XEnd, \David@XPad, \David@XLeft y \David@XRight para poder manejar el salto de línea en las columnas adyacentes a la columna 'X' del tabularx (la descripción), cuando esta ocupa más que una línea.
 % Gracias a David Carlisle (Thanks to David Carlisle).
 % http://tex.stackexchange.com/questions/111203/tabularx-bottom-alignment-on-r-or-l-columns-when-x-column-wraps
 \def\David@SavePos##1{\leavevmode\pdfsavepos\write\@auxout{\gdef\noexpand##1{\the\pdflastypos sp}}}%
 \def\David@XStart{\expandafter\David@SavePos\csname save@start@\romannumeral\value{@NumItem}\endcsname}%
 \def\David@XEnd{\expandafter\David@SavePos\csname save@end@\romannumeral\value{@NumItem}\endcsname}%
 \def\David@XPad##1##2##3{%
  \vtop{%
   \baselineskip\normalbaselineskip
   ##2%
   \expandafter
   \ifx\csname save@start@##1\endcsname
    \relax
   \else
    \dimen@\csname save@start@##1\endcsname\relax
    \loop
     \ifdim\dimen@>\csname save@end@##1\endcsname
     \advance\dimen@-\baselineskip
     \settowidth{\@TempDimen}{##3}%
      \ifdim\@TempDimen=0pt\settowidth{\@TempDimen}{##2}\fi
     \hbox{\parbox{\@TempDimen}{\@CaracterCeldasVacias}}%
    \repeat
   \fi
   ##3}}%
 \def\David@XLeft##1{\David@XPad{\romannumeral\value{@NumItem}}{\hbox{##1}}{}}%
 \def\David@XRight##1{\David@XPad{\romannumeral\value{@NumItem}}{}{\hbox{##1}}}%
 %
 % Caja auxiliar para el caracter de retorno de carro y poder saber si tamaño en el campo de la descripción.
 \savebox{\@CajaCaracterCR}{\@LetraItems\@CaracterCR}
 %
 % Comando interno general para agregar cualquier ítem.
 \newcommand{\@ITEM}[5]{% 1. [R|G|A|E|X]; 2. cantidad; 3. descripción; 4. p/u; 5. dcto.
  \@CalculaItem{##1}{##2}{##3}{##4}{##5}%
  % Si no es el primer ítem, entonces hace falta \\ para terminar el ítem anterior.
  \ifnum\value{@NumItem}=1%
  \else
   \\
   \if@conlineasha\hline\fi% Líneas para separar cada ítem, si hiciera falta.
  \fi
  % Primer -opcional- campo: El número del ítem.
  \ifbool{NumItem}{\David@XLeft{\@NumItemAuxCmd{\mbox{}\hfill \@LetraNumeros \arabic{@NumItem}\hfill\mbox{}}}}{}%
  &
  % Segundo campo: Acá puede ir la cantidad (cdu) o la descripción (dcu y duc).
  \ifbool{SinCantidad}{}{%
   \ifbool{PrimeroDescrip}
   {\@DescripcionAuxCmd{##3}{##1}}% dcu y duc.
   {\David@XLeft{\@CantidadAuxCmd{\mbox{}\hfill \@LetraNumeros \numprint{##2}\hfill\mbox{}}}}}% cdu.
  &
  % Tercer campo: Acá puede ir la descripción (cdu), la cantidad (dcu), o el precio unitario (duc).
  \ifbool{PrimeroDescrip}{%
   \if@dcu
    \David@XRight{\@CantidadAuxCmd{\mbox{}\hfill \@LetraNumeros \numprint{##2}\hfill\mbox{}}}% dcu.
   \else
    \David@XRight{\@PrecioUAuxCmd{%
     \ifx##1X \hfill \@CaracterItemXVacio \hfill\mbox{}%
     \else
      \if@impdesc\else\@EscribeTipoDeImpuesto{##1}\fi \hfill \@LetraNumeros \numprint{\PrecioU}
     \fi}}% duc.
   \fi}
  {\@DescripcionAuxCmd{##3}{##1}}% cdu.
  &
  % Cuarto campo: Acá puede ir el precio unitario (cdu y dcu) o la cantidad (duc).
  \FPifeq\PrecioU{##4}\else\ClassWarning{factura}{** Se está introduciendo un precio con más de dos decimales: (##3 - ##4. Redondeado a \PrecioU) **}{}\fi% Advertimos cuando el precio unitario tiene más de dos decimales.
  \ifbool{SinCantidad}{}{%
   \if@duc
    \David@XRight{\@CantidadAuxCmd{\mbox{}\hfill \@LetraNumeros \numprint{##2}\hfill\mbox{}}}% duc.
   \else
    \David@XRight{\@PrecioUAuxCmd{%
     \ifx##1X \hfill \@CaracterItemXVacio \hfill\mbox{}%
     \else
      \if@impdesc\else\@EscribeTipoDeImpuesto{##1}\fi \hfill \@LetraNumeros \numprint{\PrecioU}
     \fi}}% dcu y cdu.
   \fi}%
  &
  % Quinto -opcional- campo: Descuento.
  \ifbool{Descuentos}{%
   \David@XRight{\@DescuentoAuxCmd{%
    \ifx##1X \hfill \@CaracterItemXVacio \hfill\mbox{}%
    \else
     \mbox{}\hfill \@LetraNumeros \numprint{\Dcto}\%\hfill\mbox{}%
    \fi}}}{}% Tenemos que usar un condicional booleano porque si no da problemas con el condicional \FPifeq.
  &
  % Sexto campo: El total.
  \David@XRight{\@PrecioTAuxCmd{%
   \ifx##1X \hfill \@CaracterItemXVacio \hfill\mbox{}%
   \else
    \if@impdesc\else\@EscribeTipoDeImpuesto{##1}\fi \hfill \@LetraNumeros \numprint{\PrecioT}
   \fi}}%
  % Escribimos al csv.
  \if@csv
   \ifbool{SinCantidad}
    {\if@descuentos
      \immediate\write\csv{"\unexpanded{##3}","\Dcto","\PrecioT","##1"}%
     \else
      \immediate\write\csv{"\unexpanded{##3}","\PrecioT","##1"}%
     \fi}
    {\if@cdu
      \if@descuentos
       \immediate\write\csv{"##2","\unexpanded{##3}","\PrecioU","\Dcto","\PrecioT","##1"}%
      \else
       \immediate\write\csv{"##2","\unexpanded{##3}","\PrecioU","\PrecioT","##1"}%
      \fi
     \fi
     \if@dcu
      \if@descuentos
       \immediate\write\csv{"\unexpanded{##3}","##2","\PrecioU","\Dcto","\PrecioT","##1"}%
      \else
       \immediate\write\csv{"\unexpanded{##3}","##2","\PrecioU","\PrecioT","##1"}%
      \fi
     \fi
     \if@duc
      \if@descuentos
       \immediate\write\csv{"\unexpanded{##3}","\PrecioU","##2","\Dcto","\PrecioT","##1"}%
      \else
       \immediate\write\csv{"\unexpanded{##3}","\PrecioU","##2","\PrecioT","##1"}%
      \fi
     \fi}%
   \fi}%
 %
 % Usamos la definición de \label@factura dentro del entorno de la factura para que sea local aquí nada más.
 \let\label\label@factura
 \@LetraItems% Este es el tipo de letra que tendrán los ítems, y en este tipo de letra se define el \baselineskip de toda la factura.
 \@FacturaAuxInicioCmd
 \ifbool{SinLineasHoriExt}{}{\hline}%
 \@ZERO
 % Estamos en el número del ítem, si aplicara.
 \if@lineadesdeinicio \hspace*{-\tabcolsep}\zsaveposx{LineaNodoACoordX}\hspace*{\tabcolsep}\fi
 \ifbool{NumItem}{\@NumItemAuxCmd{\mbox{}\hfill \@LetraTitCuadro \@@NumItem \hfill\mbox{}}}{}%
 &
 % Avanzamos a la cantidad, o la descripción.
 \ifbool{SinCantidad}{}{\ifbool{PrimeroDescrip}{\@DescripcionAuxCmd{\@LetraTitCuadro \@@Descripcion}{}}{\@CantidadAuxCmd{\mbox{}\hfill \@LetraTitCuadro \@@Cantidad \hfill\mbox{}}}}%
 &% Avanzamos hasta la descripción, la cantidad o el precio unitario.
 \ifbool{SinCantidad}{\@DescripcionAuxCmd{\@LetraTitCuadro \@@Descripcion}{}}
  {\if@cdu \@DescripcionAuxCmd{\@LetraTitCuadro \@@Descripcion}{}\fi
   \if@dcu \@CantidadAuxCmd{\mbox{}\hfill \@LetraTitCuadro \@@Cantidad \hfill\mbox{}}\fi
   \if@duc \@PrecioUAuxCmd{\mbox{}\hfill \@LetraTitCuadro \@@PrecioU \space (\Moneda)\hfill\mbox{}}\fi}%
 &% Avanzamos hasta el precio unitario, o la cantidad, o columna fantasma cuando es 'sincantidad'.
 \ifbool{SinCantidad}{}
  {%
   \mbox{}\hfill
   \if@duc
    \@CantidadAuxCmd{\mbox{}\hfill \@LetraTitCuadro \@@Cantidad \hfill\mbox{}}%
   \else
    \@PrecioUAuxCmd{\mbox{}\hfill \@LetraTitCuadro \@@PrecioU \space (\Moneda)\hfill\mbox{}}%
   \fi}%
 &% Avanzamos hasta el descuento, que puede o no existir.
 \if@descuentos \@DescuentoAuxCmd{\mbox{}\hfill \@LetraTitCuadro \@@Descuento \hfill\mbox{}}\fi
 &% Avanzamos hasta el precio total.
 \@PrecioTAuxCmd{\mbox{}\hfill \@LetraTitCuadro \ifbool{SinCantidad}{\@@Precio}{\@@PrecioT}\space (\Moneda)\hfill\mbox{}}%
 \if@lineacompleta \hspace*{\tabcolsep}\zsaveposx{LineaNodoBCoordX}\hspace*{-\tabcolsep}\fi
 \\
 \ifbool{SinLineasHoriInt}{}{\hline}%
 %
 #1% Aquí entran todos los items que el usuario declara dentro del ambiente.
 \\% El último fin de línea se hace aquí.
 \if@conlineasha\hline\fi% Se verifica si hace falta una línea horizontal o no.
 \if@filas
  % Esto en lugar de \if@exparriba para que no se haga una linea vacía en la tabla cuando la caja está vacía.
  \ifdim \ht\@CajaEspacioVacio=0pt
   \ifbool{SinLineasHoriExt}{}{\if@conlineasha\else\hline\fi}% Verificamos si hay que poner la línea horizontal. Si está 'conlineasha' ya salió debido a esta opción.
  \else
   \ifbool{PrimeroDescrip}{&\usebox{\@CajaEspacioVacio}&&&&\\}{&&\usebox{\@CajaEspacioVacio}&&&\\}%
   \ifbool{SinLineasHoriExt}{}{\hline}% Siempre que hay relleno se pone la línea acá.
  \fi
 \else
  \ifbool{SinLineasHoriInt}{}{\if@conlineasha\else\hline\fi}% Línea que cierra los ítems en la tabla.
  % Agregamos el espacio espúreo.
  \ifdim \ht\@CajaEspacioVacio=0pt
  \else
   % Rellenamos la tabla con espacio espúreo, y le agregamos las lineas externas, si aplica.
   \ifbool{SinLineasVertExt}{\multicolumn{6}{c}{\usebox{\@CajaEspacioVacio}}}{\multicolumn{6}{|c|}{\usebox{\@CajaEspacioVacio}}}\\
  \fi
  % Modo de columnas: Abrimos la tabla para escribir los totales, y le agregamos las líneas verticales externas, si aplica.
  \@ColumnasMultiColumnTotalesAuxCmd
  \@CalculaTotalesI
  \if@agrupado
   \@EscribeTotalColAgrupado
  \else
   \if@Exento \@EscribeTotalCol{E}\fi
   \if@BIR\@EscribeTotalCol{R}\if@ivaexpresado\@EscribeTotalColAlicuota{R}\fi\fi
   \@EscribeTotalCol{G}\if@ivaexpresado\@EscribeTotalColAlicuota{G}\fi
   \if@BIA\@EscribeTotalCol{A}\if@ivaexpresado\@EscribeTotalColAlicuota{A}\fi\fi
  \fi
  \if@ivaexpresado\cline{2-2}\fi
  \hfill \@LetraTitTotal\@@Total & \@LetraNumTotal\numprint{\Total}\\
  \end{tabular}\endgroup
  \\
  \ifbool{SinLineasHoriExt}{}{\hline}%
 \fi
 \end{tabularx}%
 %
 \if@filas
  \@CalculaTotalesI
  \@LetraNumTotales
  \vspace*{\@SeparaElementos}\par
  \if@exparriba\else\vfill\fi
  \@GeneraCajasTotalesFilas
  \newbox{\@CajaTotal}%
  \savebox{\@CajaTotal}{{\@LetraTitTotal\@@Total}: \@LetraNumTotal\numprint{\Total}}%
  %
  \ifnum \value{@IVANoGeneral}=0%
   \newbox{\@CajaGET}%
   \savebox{\@CajaGET}{\@EscribeTotalesFilasGET}%
   \ifdim \the\wd\@CajaGET < \textwidth
    \parbox{\textwidth}{\@EscribeTotalesFilasGET}%
   \else
    \hspace*{\@SepTotales}%
    \usebox{\@CajaBIAliG}\hspace*{\@SepTotales}%
    \if@Exento\usebox{\@CajaBIET}\else\usebox{\@CajaTotal}\fi
    \if@centrado\hspace*{\@SepTotales}\fi
   \fi
  \fi
  \ifnum \value{@IVANoGeneral}=1%
   \newbox{\@CajaGxET}%
   \savebox{\@CajaGxET}{\@EscribeTotalesFilasGxET}%
   \ifdim \the\wd\@CajaGxET < \textwidth
    \@EscribeTotalesFilasGxET
   \else
    \hspace*{\@SepTotales}%
    \if@BIR\usebox{\@CajaBIAliR}\hspace*{\@SepTotales}\fi
    \usebox{\@CajaBIAliG}\hspace*{\@SepTotales}%
    \if@BIA\usebox{\@CajaBIAliA}\hspace*{\@SepTotales}\fi
    \\[\@SeparaFilas]\mbox{}%
    \if@centrado\hspace*{\@SepTotales}\else\hfill\fi
    \if@Exento\usebox{\@CajaBIE}\hspace*{\@SeparaMinTotales}\fi\usebox{\@CajaTotal}%
    \if@centrado\hspace*{\@SepTotales}\fi
   \fi
  \fi
  \ifnum \value{@IVANoGeneral}=2%
  \newbox{\@CajaRGAET}%
  \savebox{\@CajaRGAET}{\@EscribeTotalesFilasRGAET}%
   \ifdim \the\wd\@CajaRGAET < \textwidth
    \@EscribeTotalesFilasRGAET
   \else
    \newbox{\@CajaRGA}%
    \savebox{\@CajaRGA}{\@EscribeTotalesFilasRGA}%
    \ifdim \the\wd\@CajaRGA < \textwidth
     \@EscribeTotalesFilasRGA
     \\[\@SeparaFilas]\mbox{}%
     \if@centrado\hspace*{\@SepTotales}\else\hfill\fi
     \if@Exento\usebox{\@CajaBIE}\hspace*{\@SeparaMinTotales}\fi\usebox{\@CajaTotal}%
     \if@centrado\hspace*{\@SepTotales}\fi
    \else% Aquí casi cualquier cosa tiene aspecto feo.
     \ClassWarning{factura}{Es mejor no usar la opción de totalización en filas en este caso, o disminuir los tamaños de los tipos de letra para la totalización}{}%
     \centering{%
      \begin{tabular}{r@{\hspace*{\@SeparaMinTotales}}l}
       \usebox{\@CajaBIAliR} & \usebox{\@CajaBIAliA} \\[\@SeparaFilas]
       \usebox{\@CajaBIAliG} & \if@Exento\usebox{\@CajaBIET}\else\usebox{\@CajaTotal}\fi
      \end{tabular}}%
    \fi
   \fi
  \fi
 \fi
 \par
 \if@exparriba
  \vspace*{-\@EspacioVacioInicial}%
  \vspace*{\@EspacioVacioFinal}%
  \zsaveposy{EspacioVacioInicial}%
 \fi
 \vfill
 \if@exparriba\zsaveposy{EspacioVacioFinal}\fi
 \vspace*{\@SeparaElementos}\par}

 \ifbool{SinCantidad}
 % Definamos todos los comandos \Item***.
 {%
  \if@descuentos
   \newcommand{\Item}[3]{\@ITEM{G}{1}{#1}{#2}{#3}}% Ítem normal.
   \newcommand{\ItemR}[3]{\global\@BIRtrue\global\@Gtrue\@ITEM{R}{1}{#1}{#2}{#3}}% Ítem con IVA reducido.
   \newcommand{\ItemA}[3]{\global\@BIAtrue\global\@Gtrue\@ITEM{A}{1}{#1}{#2}{#3}}% Ítem con IVA reducido.
   \newcommand{\ItemE}[3]{\global\@Exentotrue\global\@Gtrue\@ITEM{E}{1}{#1}{#2}{#3}}% Ítem con IVA reducido.
  \else
   \newcommand{\Item}[2]{\@ITEM{G}{1}{#1}{#2}{0}}% Ítem normal.
   \newcommand{\ItemR}[2]{\global\@BIRtrue\global\@Gtrue\@ITEM{R}{1}{#1}{#2}{0}}% Ítem con IVA reducido.
   \newcommand{\ItemA}[2]{\global\@BIAtrue\global\@Gtrue\@ITEM{A}{1}{#1}{#2}{0}}% Ítem con IVA reducido.
   \newcommand{\ItemE}[2]{\global\@Exentotrue\global\@Gtrue\@ITEM{E}{1}{#1}{#2}{0}}% Ítem con IVA reducido.
  \fi
  \newcommand{\ItemX}[1]{\@ITEM{X}{1}{#1}{0}{0}}% Ítem sin precio.
  \let\ItemG\Item
  \if@csv
   \if@descuentos
    \immediate\write\csv{"\@@Descripcion","\@@Descuento","\@@Precio \space (\Moneda)"}
   \else
    \immediate\write\csv{"\@@Descripcion","\@@Precio \space (\Moneda)"}
   \fi
  \fi}
 {%
  \if@descuentos
   \newcommand{\Item}[4]{\@ITEM{G}{#1}{#2}{#3}{#4}}% Ítem normal.
   \newcommand{\ItemR}[4]{\global\@BIRtrue\global\@Gtrue\@ITEM{R}{#1}{#2}{#3}{#4}}% Ítem con IVA reducido.
   \newcommand{\ItemA}[4]{\global\@BIAtrue\global\@Gtrue\@ITEM{A}{#1}{#2}{#3}{#4}}% Ítem con IVA adicional.
   \newcommand{\ItemE}[4]{\global\@Exentotrue\global\@Gtrue\@ITEM{E}{#1}{#2}{#3}{#4}}% Ítem exento de IVA.
  \else
   \newcommand{\Item}[3]{\@ITEM{G}{#1}{#2}{#3}{0}}% Ítem normal.
   \newcommand{\ItemR}[3]{\global\@BIRtrue\global\@Gtrue\@ITEM{R}{#1}{#2}{#3}{0}}% Ítem con IVA reducido.
   \newcommand{\ItemA}[3]{\global\@BIAtrue\global\@Gtrue\@ITEM{A}{#1}{#2}{#3}{0}}% Ítem con IVA adicional.
   \newcommand{\ItemE}[3]{\global\@Exentotrue\global\@Gtrue\@ITEM{E}{#1}{#2}{#3}{0}}% Ítem exento de IVA.
  \fi
  \newcommand{\ItemX}[2]{\@ITEM{X}{#1}{#2}{0}{0}}% Ítem sin precio.
  \let\ItemG\Item
  \if@csv
   \if@cdu
    \if@descuentos
     \immediate\write\csv{"\@@Cantidad","\@@Descripcion","\@@PrecioU \space (\Moneda)","\@@Descuento","\@@PrecioT \space (\Moneda)"}%
    \else
     \immediate\write\csv{"\@@Cantidad","\@@Descripcion","\@@PrecioU \space (\Moneda)","\@@PrecioT \space (\Moneda)"}%
    \fi
   \fi
   \if@dcu
    \if@descuentos
     \immediate\write\csv{"\@@Descripcion","\@@Cantidad","\@@PrecioU \space (\Moneda)","\@@Descuento","\@@PrecioT \space (\Moneda)"}%
    \else
     \immediate\write\csv{"\@@Descripcion","\@@Cantidad","\@@PrecioU \space (\Moneda)","\@@PrecioT \space (\Moneda)"}%
    \fi
   \fi
   \if@duc
    \if@descuentos
     \immediate\write\csv{"\@@Descripcion","\@@PrecioU \space (\Moneda)","\@@Cantidad","\@@Descuento","\@@PrecioT \space (\Moneda)"}%
    \else
     \immediate\write\csv{"\@@Descripcion","\@@PrecioU \space (\Moneda)","\@@Cantidad","\@@PrecioT \space (\Moneda)"}%
    \fi
   \fi
  \fi}

 
\if@factura
 % Los descuentos totales no son compatibles -y no sé si lo serán- con el modo de totalización en filas.
 \if@filas
  \if@Descuentos
   \ClassWarning{factura}{La opción 'filas' no es compatible con los descuentos totales; sin efecto opción 'filas'.}{}
   \@filasfalse
  \fi
 \fi
 \if@cotizacion\def\@Denominacion{\@@DenomCotiza}\else\def\@Denominacion{\@@DenomFactura}\fi%  Fijamos la denominación del documento paras las cotizaciones o facturas, que son casos particulares del modo 'factura'.
 \AtEndPreamble{%  La geometría debe aplicarse aquí.
  \expandafter\geometry\expandafter{\@GeometriaFactura}}
 \AtBeginDocument{%  Aquí en la factura hay que cargar el estilo de página del reporte, pero con la factura se aplicará \thispagestyle{empty} luego, aunque quedará \pagestyle aplicado desde ahora.
  \if@fondoreportestar
   \pagestyle{soloabajo}%  Cuando el fondo es con '*' la información de página va sólo abajo.
  \else
   \pagestyle{plain}%  Esto aplica para cuando se define un fondo sin '*' y cuando no se define fondo en el reporte.
  \fi
  \addtolength{\@PosFechaX}{\oddsidemargin+1in}%  Le sumamos el margen izquierdo a las posiciones de las cosas; importante que se haga en un \AtBeginDocument antes de que empiecen a escribirse otras cosas que también se agregan a \AtBeginDocument.
  \addtolength{\@PosDenomX}{\oddsidemargin+1in}%
  \addtolength{\@PosControlX}{\oddsidemargin+1in}%
  \addtolength{\@PosCondX}{\oddsidemargin+1in}%
  \addtolength{\@PosFirmasXuno}{\oddsidemargin+1in}%
  \setlength{\parindent}{0pt}%
  \setlength{\lineskip}{0pt}%
  \setlength{\parskip}{0pt plus 1pt}%
  \expandafter\setlength{\@SepTotales}{\the\@SeparaMinTotales plus 1fill}% \@SeparaMinTotales es el mínimo espacio entre los totales en el modo 'filas', y SepTotales es una dimensión interna, estirable, con ese como su mínimo.
  \thispagestyle{empty}%
  \pagenumbering{roman}%
  \@EncabezadoFactura}
  \if@reporte
   \expandafter\AtBeginShipoutNext
  \else
   \expandafter\AtEndDocument%  Para la factura no puede estar lo que viene en un \AtBeginDocument porque se inserta un espacio extra que genera una página extra; tiene que estar en \AtEndDocument.
  \fi
   {%
   \@CargaFondoFactura
   \@PosicionaFecha
   \if@denom\@PosicionaDenom\fi
   \if@confirmas\@PosicionaFirmas\fi
   \if@concondiciones\@PosicionaCondiciones\fi
   \if@prefactura\@PosicionaNumControl\fi}

 \if@linea
  \RequirePackage{zref-savepos}%  Para determinar las coordenadas de la línea.
  \RequirePackage{eso-pic}%  Para poder usar \AtBeginShipoutNext porque si no se hace en el 'shipout' de la página se genera un espacio en blanco extra.
  \AtBeginShipoutNext{\if@linea\@DibujaLinea\fi}
   \if@filas
    \ifbool{SinLineasVertInt}{\@lineacompletatrue}
   \else
    \@lineahastatotaltrue\@lineadesdeiniciotrue
   \fi
 \fi

 %% El comando para la descripción del servicio prestado.
 \NewDocumentCommand{\Descripcion}{+m}{%
  \@LetraDescripcion
  \begin{tikzpicture}
   \node[draw=black, fill=white, inner sep=\@SeparaInternaDescrip, line width=\@GrosorLineaDescrip, rounded corners=\@EsquinaLineaDescrip,
         copy shadow={top color=black, bottom color=black, shadow xshift=\@SombraDescrip, shadow yshift=-\@SombraDescrip}]{%
    \ifbool{ExpAbajo}
     {\parbox[t][\textheight-\pagetotal-2\@SeparaInternaDescrip-\@GrosorLineaDescrip-\@SombraDescrip]
      {\textwidth-2\@SeparaInternaDescrip-\@GrosorLineaDescrip-\@SombraDescrip}}%
     {\parbox[t]{\textwidth-\@SombraDescrip-2\@SeparaInternaDescrip-2\@GrosorLineaDescrip}}%
    {\setlength{\parindent}{0.5cm}%
     \setlength{\parskip}{2pt plus 8pt}%
     \ifbool{ExpAbajo}{\vfill}{}%
      #1%
     \ifbool{ExpAbajo}{\vfill}{}}};%
  \end{tikzpicture}
  \par\vspace*{\@SombraDescrip}}%
\else
 \RenewEnviron{factura}{%
  \@ZERO
  \let\label\label@factura
  \let\@ITEM\@CalculaItem
  \BODY
  \@CalculaTotalesI}
 \NewDocumentCommand{\Descripcion}{+m}{}
\fi

\if@reporte
 \ifdefvoid{\@InfoPagina}{\let\@InfoPagina\@InfoPaginaNoTitulo}{}%
 \if@factura
 \else
  \AtEndPreamble{%
  \expandafter\geometry\expandafter{\@GeometriaReporte}}%  La geometría del reporte debe aplicarse aquí cuando sólo hay reporte, así se puede establecer el tamaño del papel.
 \fi
 \NewEnviron{reporte}{%
  \if@factura
   \expandafter\newgeometry\expandafter{\@GeometriaReporte}\cleardoublepage%  La geometría debe aplicarse aquí cuando también hay factura, pero no se puede cambiar el tamaño del papel.
  \fi
  \fancy@setoffs
  \@CargaFondoReporte
  \@EncabezadoReporte
  \ifdefvoid{\@EstiloPagReporteResto}{%
   \if@fondoreportestar%  Si no usamos \EstiloPagReporte entonces se fijará 'soloabajo' cuando se use \FondoReporte* para que sólo use marcas de pie de página, y si no se usó \FondoReporte* entonces se fijará 'plain' que usa cabeceras y piés de página.
    \pagestyle{soloabajo}%
   \else
    \pagestyle{plain}%
   \fi}
   {\pagestyle{\@EstiloPagReporteResto}}%  Si usamos \EstiloPagReporte en su argumento obligatorio entonces fijamos ese estilo de página.
  \ifdefvoid{\@EstiloPagReporteUno}{%
   \if@fondoreporte%  Si no le damos a \EstiloPagReporte su argumento opcional, entonces se fijará 'solonumpag' como el estilo de página para la primera página, pero solamente si usamos \FondoReporte, ya que el estilo de página predeterminado al usar \FondoReporte* ya se acaba de fijar y no necesita el caso especial de la primera hoja (\thispagestyle).
    \if@fondoreportestar
    \else
     \thispagestyle{solonumpag}%
    \fi
   \fi}
   {\thispagestyle{\@EstiloPagReporteUno}}%  Si usamoe el argumento opcional de \EstiloPagReporte establecemos ese estilo de página.
  \pagenumbering{arabic}%
  \setlength{\parindent}{0.666cm}%
  \setlength{\parskip}{4pt plus 6pt minus 2pt}% separación entre párrafos en el reporte.
  \vskip\baselineskip
  \BODY\clearpage}% espacio antes de empezar con el reporte, después del título -si lo hubiera-.
\else
 \NewEnviron{reporte}{}
\fi

%% Comando para el diseño de la forma libre.
\newcommand{\@CargaFondoFactura}{%
 \if@fondofactura
  \begin{textblock*}{\paperwidth}(0pt,0pt)%
   \includegraphics{\@FondoFactura}%
  \end{textblock*}%
 \fi}

%% Comando para el fondo del reporte.
\newcommand{\@CargaFondoReporte}{%
 \begin{textblock*}{\paperwidth}(0pt,0pt)% Tuve que abrir el textblock* aquí para que aplique siempre; de esta manera se corrige un defecto que se produce cuando se usa \vspace* al inicio de la página (dentro de \@EncabezadoReporte).
  \if@fondoreporte
   \if@fondoreportestar
    \AddToShipoutPictureBG{\includegraphics{\@FondoReporte}}%
   \else
     \noindent\includegraphics{\@FondoReporte}%
   \fi
  \fi
 \end{textblock*}}

%% Comando que coloca los espacios para firmar.
\newcommand{\@PosicionaFirmas}{%
 \savebox{\@CajaFirmas}{%
  \parbox{\textwidth+\oddsidemargin+1in-\@PosFirmasXuno-\@PosFirmasXdos}{\@EstiloFirmas}}%
 \ifbool{FirmasYnegativo}
  {\addtolength{\@PosFirmasY}{\paperheight-\ht\@CajaFirmas-\dp\@CajaFirmas}}
  {}%
 \begin{textblock*}{\wd\@CajaFirmas}(\@PosFirmasXuno,\@PosFirmasY)%
  \usebox{\@CajaFirmas}%
 \end{textblock*}}

%% Comando que coloca las condiciones del documento.
\newcommand{\@PosicionaCondiciones}{%
 \savebox{\@CajaCond}{%
  \parbox{\textwidth+\oddsidemargin+1in-\@PosCondX}{\@EstiloCondiciones}}%
 \ifbool{CondYnegativo}
  {\addtolength{\@PosCondY}{\paperheight}}% Aquí la caja abre hacia abajo, por eso no restamos el tamaño de la caja (\ht y \dp).
  {}%
 \begin{textblock*}{\wd\@CajaCond}(\@PosCondX,\@PosCondY)%
  \usebox{\@CajaCond}%
 \end{textblock*}}

%% Comando que coloca el número de control.
\newcommand{\@PosicionaNumControl}{%
 \savebox{\@CajaControl}{\@EstiloNumControl}%
 \ifbool{ControlXnegativo}
  {\addtolength{\@PosControlX}{\textwidth-\wd\@CajaControl}}
  {}%
 \ifbool{ControlYnegativo}
  {\addtolength{\@PosControlY}{\paperheight-\ht\@CajaControl-\dp\@CajaControl}}
  {}%
 \begin{textblock*}{\wd\@CajaControl}(\@PosControlX,\@PosControlY)%
  \usebox{\@CajaControl}%
 \end{textblock*}}

%% Comando que coloca la denominación del documento.
\newcommand{\@PosicionaDenom}{%
 \savebox{\@CajaDenom}{\@EstiloDenom}%
 \ifbool{DenomXnegativo}
  {\addtolength{\@PosDenomX}{\textwidth-\wd\@CajaDenom}}
  {}%
 \ifbool{DenomYnegativo}
  {\addtolength{\@PosDenomY}{\paperheight-\ht\@CajaDenom-\dp\@CajaDenom}}
  {}%
 \begin{textblock*}{\wd\@CajaDenom}(\@PosDenomX,\@PosDenomY)%
  \usebox{\@CajaDenom}%
 \end{textblock*}}

%% Comando que coloca la fecha.
\newcommand{\@PosicionaFecha}{%
 \savebox{\@CajaFecha}{\@EstiloFecha}%
 \ifbool{FechaXnegativo}
  {\addtolength{\@PosFechaX}{\textwidth-\wd\@CajaFecha}}
  {}%
 \ifbool{FechaYnegativo}
  {\addtolength{\@PosFechaY}{\paperheight-\ht\@CajaFecha-\dp\@CajaFecha}}
  {}%
 \begin{textblock*}{\wd\@CajaFecha}(\@PosFechaX,\@PosFechaY)%
  \usebox{\@CajaFecha}%
 \end{textblock*}}

%% Comando que coloca la identificación del reporte al inicio.
\newcommand{\@EscribeDatosReporte}{%
 {\@LetraEncReporte
  \setlength{\parindent}{0pt}%
  {\bfseries \@@Proveedor} \@Proveedor \par
  {\bfseries \@@Cliente} \@RazonSocial \par
  \ifdefvoid{\@Contacto}{}{{\bfseries \@@Contacto} \@Contacto \par}%
  \ifdefvoid{\@TituloReporte}{}{\vspace*{\baselineskip}{\@LetraTitReporte \centering \@TituloReporte \par}}}}

%% Comando que coloca la caja con los datos del cliente.
\newcommand{\@EscribeDatos}{%
 {\@LetraEncFactura% Abrimos un nuevo grupo para que el cambio de tipografía sea sólo local.
  \begin{tikzpicture}
   \node[draw=black, fill=white, inner sep=\@SeparaInternaEncabez, line width=\@GrosorLineaEncabez, rounded corners=\@EsquinaLineaEncabez,
         copy shadow={top color=black, bottom color=black, shadow xshift=\@SombraEncabez, shadow yshift=-\@SombraEncabez}]{%
   \parbox{\textwidth-\@SombraEncabez-2\@SeparaInternaEncabez-\@GrosorLineaEncabez}{%
    \hfill {\@LetraTitEnc \@@Datos} \hfill \mbox{}\par
    {\bfseries \@@RazonSocial} \@RazonSocial
    \dotfill
    {\bfseries \@@RIF} {\ttfamily \@RIF}%
    \par
    \ifdefvoid{\@Contacto}{}{{\bfseries \@@Contacto} \@Contacto \par}%
    {\bfseries \@@Direccion} \@Direccion
    \par
    {\bfseries \@@Telefono} {\ttfamily \@Telefono}%
    \ifdefvoid{\@Email}{}{\hspace*{0.666em}\@CaracterSeparaTelefonoEmail\hspace*{0.666em}{\bfseries \@@Email} {\ttfamily \@Email}}}};%
  \end{tikzpicture}%
  \par\vspace*{\@SombraEncabez}}}%  Para que textblock* esté en modo vertical.

%% Comandos auxiliares para los datos y el resumen.
\newcommand{\@DatosAux}{%
 \vfill
 \hfill {\@LetraTitEnc \@@Datos}\hfill \mbox{}\par
 {\bfseries \@@RazonSocial} \@RazonSocial \par
 {\bfseries \@@RIF} {\ttfamily \@RIF} \par
 \ifdefvoid{\@Contacto}{}{{\bfseries \@@Contacto} \@Contacto \par}%
 {\bfseries \@@Direccion} \@Direccion \par
 {\bfseries \@@Telefono} {\ttfamily \@Telefono} \hfill \par
 \ifdefvoid{\@Email}{}{{\bfseries \@@Email} {\ttfamily \@Email}}%
 \vfill}

\newcommand{\@ResumenAux}{%
 \hfill {\@LetraTitEnc \@@Resumen}\hfill \mbox{}%
 \vfill\@Resumen\vfill}

%% Comando que coloca las dos cajas del encabezado: la de los datos del cliente y la del resumen.
\newcommand{\@EscribeDatosResumen}{%
 {\@LetraEncFactura% Abrimos un nuevo grupo para que el cambio de tipografía sea sólo local.
  \savebox{\@CajaDatos}{%
   \parbox[t]{\textwidth/2-\@SeparaEncabez/2-2\@SeparaInternaEncabez-\@GrosorLineaEncabez-\@SombraEncabez}{%
    \@DatosAux}}%
  \savebox{\@CajaResumen}{%
   \parbox[t]{\textwidth/2-\@SeparaEncabez/2-2\@SeparaInternaEncabez-\@GrosorLineaEncabez-\@SombraEncabez}{%
    \@ResumenAux}}%
  \setlength{\@TamDatos}{\ht\@CajaDatos+\dp\@CajaDatos}%
  \setlength{\@TamResumen}{\ht\@CajaResumen+\dp\@CajaResumen}%
  \ifdim\@TamDatos>\@TamResumen
   \setlength{\@TamFinalEncabez}{\@TamDatos}%
  \else
   \setlength{\@TamFinalEncabez}{\@TamResumen}%
  \fi
  \begin{tikzpicture}
   \node[draw=black, fill=white, inner sep=\@SeparaInternaEncabez, line width=\@GrosorLineaEncabez, rounded corners=\@EsquinaLineaEncabez,
         copy shadow={top color=black, bottom color=black, shadow xshift=\@SombraEncabez, shadow yshift=-\@SombraEncabez}]{%
    \parbox[t][\@TamFinalEncabez]{\textwidth/2-\@SeparaEncabez/2-2\@SeparaInternaEncabez-\@GrosorLineaEncabez-\@SombraEncabez}{%    
    \@DatosAux}};%
  \end{tikzpicture}%
  \hspace*{\@SeparaEncabez}\hspace*{\@SombraEncabez}%
  \begin{tikzpicture}
   \node[draw=black, fill=white, inner sep=\@SeparaInternaEncabez, line width=\@GrosorLineaEncabez, rounded corners=\@EsquinaLineaEncabez,
         copy shadow={top color=black, bottom color=black, shadow xshift=\@SombraEncabez, shadow yshift=-\@SombraEncabez}]{%
    \parbox[t][\@TamFinalEncabez]{\textwidth/2-\@SeparaEncabez/2-2\@SeparaInternaEncabez-\@GrosorLineaEncabez-\@SombraEncabez}{%
     \@ResumenAux}};%
  \end{tikzpicture}%
  \par\vspace*{\@SombraEncabez}}}%  El \par es para que textblock* esté en modo vertical.

%% Comando que coloca la línea diagonal.
\newcommand{\@DibujaLinea}{%
 \@LetraItems% Volvemos a fijar el \baselineskip de la tabla.
 \setlength{\@LineaNodoXo}{\zposx{LineaNodoACoordX} sp}%
 \setlength{\@LineaNodoYo}{\zposy{LineaNodoBCoordY} sp}%
 \setlength{\@LineaNodoXf}{\zposx{LineaNodoBCoordX} sp}%
 \setlength{\@LineaNodoYf}{\zposy{LineaNodoBCoordY} sp}%
 \addtolength{\@LineaNodoYo}{\@EspacioVacioInicial-\@EspacioVacioFinal}%
 \if@filas
 \else
  \if@DescG \addtolength{\@LineaNodoYo}{2\baselineskip}\fi
  \if@DescR \if@BIR \addtolength{\@LineaNodoYo}{2\baselineskip}\fi\fi
  \if@DescA \if@BIA \addtolength{\@LineaNodoYo}{2\baselineskip}\fi\fi
  \if@DescE \if@Exento \addtolength{\@LineaNodoYo}{2\baselineskip}\fi\fi
  \addtolength{\@LineaNodoYo}{\baselineskip/2}%
  \if@ivaexpresado
   \addtolength{\@LineaNodoYo}{2\baselineskip}%
   \if@BIR\addtolength{\@LineaNodoYo}{2\baselineskip}\fi
   \if@BIA\addtolength{\@LineaNodoYo}{2\baselineskip}\fi
   \if@Exento\addtolength{\@LineaNodoYo}{\baselineskip}\fi
  \fi
 \fi
 \if@linea
  \begin{textblock*}{\paperwidth-\@LineaNodoXo}(\@LineaNodoXo,\paperheight-\@LineaNodoYo)%
   \begin{tikzpicture}%
    \draw (\@LineaNodoXo,\@LineaNodoYo) -- (\@LineaNodoXf,\@LineaNodoYf);%
   \end{tikzpicture}%
  \end{textblock*}%
 \fi}

%% Escribimos los totales al archivo csv.
\newcommand{\@EscribeTotalesEnCSV}{%
 \if@csv
  \if@Exento
   \if@DescE
    \immediate\write\csv{Totales: \@@SubtotalE: \Moneda \SubtE}%
    \immediate\write\csv{Totales: \@@DescuentoE: \Moneda \DescE}%
   \fi
   \immediate\write\csv{Totales: \@@BIE: \Moneda \BIE}%
  \fi
  \if@BIR
   \if@DescE
    \immediate\write\csv{Totales: \@@SubtotalR: \Moneda \SubtR}%
    \immediate\write\csv{Totales: \@@DescuentoR: \Moneda \DescR}%
   \fi
   \immediate\write\csv{Totales: \@@BIR: \Moneda \BIR}%
  \immediate\write\csv{Totales: \@@AlicuotaR: \Moneda \AlicuotaR}%
  \fi
  \if@DescG
   \immediate\write\csv{Totales: \@@SubtotalG: \Moneda \SubtG}%
   \immediate\write\csv{Totales: \@@DescuentoG: \Moneda \DescG}%
  \fi
  \immediate\write\csv{Totales: \@@BIG: \Moneda \BIG}%
  \immediate\write\csv{Totales: \@@AlicuotaG: \Moneda \AlicuotaG}%
  \if@BIA
   \if@DescA
    \immediate\write\csv{Totales: \@@SubtotalA: \Moneda \SubtA}%
    \immediate\write\csv{Totales: \@@DescuentoA: \Moneda \DescA}%
   \fi
   \immediate\write\csv{Totales: \@@BIA: \Moneda \BIA}%
   \immediate\write\csv{Totales: \@@AlicuotaA: \Moneda \AlicuotaA}%
  \fi
  \immediate\write\csv{Totales: \@@Total: \Moneda \Total}%
  \immediate\closeout\csv
 \fi}

%% Hubo que redefinir \cleardoublepage agregándole \thispagestyle{empty} porque si no queda una página en blanco con cabeceras de página usando twoside.
\def\cleardoublepage{%
 \clearpage
 \if@twoside
  \ifodd\c@page
   \else
    \hbox{}\thispagestyle{empty}\newpage
    \if@twocolumn
     \hbox{}\newpage
    \fi
   \fi
 \fi}

\let\headrulebak\headrule%  Para poder volver a poner la línea de fancyhdr si algún estilo de página la quitó.

%</class>
%<*def>
%% El diseño de las distintas partes de la hoja.
\newcommand{\@EstiloFirmas}{%
 \@LetraFirmas
 \if@unafirma
 \else
  \parbox{\@TamLineaFirmas}{%
   \rule{\@TamLineaFirmas}{\@GrosorLineaFirmas}
   \centering \ifdefvoid{\@Conforme}{\@@Conforme}{\@Conforme}}%
 \fi
 \hfill
 \parbox{\@TamLineaFirmas}{%
  \rule{\@TamLineaFirmas}{\@GrosorLineaFirmas}
  \centering \ifdefvoid{\@Emisor}{\if@cotizacion \@@Emisor \else \@@Pagado \fi}{\@Emisor}}}

\newcommand{\@EstiloCondiciones}{\@LetraCondiciones \@Condiciones}

\newcommand{\@EstiloNumControl}{%
 \begin{tabular}{@{\extracolsep{0pt}}l}
  \@LetraDenom \@@Control \\
  {\@LetraDenom\@NumSerieControl-}\space\@LetraNumeracion\@NumControl
 \end{tabular}}

\newcommand{\@EstiloDenom}{%
 \@LetraDenom\@Denominacion
 \if@sinnumero
 \else
  \space\space{\@LetraNumeracion N\textordmasculine\space\@Num}%
 \fi}

\newcommand{\@EstiloFecha}{\@LetraFecha\@@Fecha{\ttfamily\ \@Fecha}}

\newcommand{\@InfoPaginaNoTitulo}{\@LetraInfoPagina Reporte correspondiente a la factura n\'umero \@Num \space de fecha \@Fecha}

\newcommand{\@InfoPaginaTitulo}{\@LetraInfoPagina \@TituloReporte \space - \@Proveedor \space - \@Fecha}

%% Estilos de página: normal, sólo cabeceras, sólo piés de página y sólo número de página al pié.
\fancypagestyle{plain}{%
 \expandafter\ps@fancy
 \fancyhf{}%
 \renewcommand{\headrule}{\headrulebak}%
 \fancyhead[LEO]{\@InfoPagina}%
 \fancyfoot[C]{\thepage}}

\fancypagestyle{soloarriba}{%
 \expandafter\ps@fancy
 \fancyhf{}%
 \renewcommand{\headrule}{\headrulebak}%
 \fancyhead[LO]{\@InfoPagina}%
 \fancyhead[RO]{\thepage}%
 \if@twoside
  \fancyhead[LE]{\thepage}%
  \fancyhead[RE]{\@InfoPagina}%
 \fi}

\fancypagestyle{soloabajo}{%
 \expandafter\ps@fancy
 \fancyhf{}%
 \renewcommand{\headrule}{}%
 \fancyfoot[LO]{\@InfoPagina}%
 \fancyfoot[RO]{\thepage}%
 \if@twoside
  \fancyfoot[RE]{\@InfoPagina}%
  \fancyfoot[LE]{\thepage}%
 \fi}

\fancypagestyle{solonumpag}{%
 \expandafter\ps@fancy
 \fancyhf{}%
 \renewcommand{\headrule}{}%
 \fancyfoot[C]{\thepage}}

%</def>
%<*!class&!def&!firma&!fondo&!membrete&!batchfile>
%% Descripción de este ejemplo:
%
%<factuno|factdos|facttres|factcuatro|factcinco|factseis|factsiete|factocho|repuno|repdos>%%  Escribimos una factura,
%<prefac>%%  Escribimos una prefactura (prefactura),
%<cotiza>%%  Escribimos una cotización (cotizacion),
%<repuno|repdos|reptres>%%  Escribimos un reporte,
%<repuno>%%  Generamos factura y reporte (conreporte),
%<repdos>%%  Escribimos factura y reporte, pero sólo producimos el reporte (soloreporte),
%<reptres>%%  Generamos solamente un reporte (soloreporte),
%<factcinco|factocho>%%  Escribimos factura y reporte, pero sólo producimos la factura,
%
%<factuno>%%  Todo con los valores por omisión,
%
%<reptres>%%  El reporte se imprime en las dos caras del papel (twoside),
%
%<factcinco>%%  Cuadro de la factura sin la columna de cantidades (sincantidad),
%<factdos|factseis>%%  Con la columna para enumerar los ítems (numitem),
%<factdos>%%  Con descuentos individuales (descuentos),
%
%<facttres>%%  Agrupados los totales por gravámenes (agrupado),
%<factcuatro|factcinco|factsiete>%%  Totalización en modo de filas (filas),
%<factcinco>%%  Centrados los totales en el modo de filas (centrado),
%
%<factdos>%%  Primero la descripción, luego la cantidad, luego el precio unitario (dcu),
%<factcuatro>%%  Primero la descripción, luego el precio unitario, luego la cantidad (duc),
%<factcinco|factseis>%%  Escribe la denominación ("FACTURA") y el número (denom),
%<cotiza>%%  Escribe la denominación ("COTIZACIÓN") pero sin número (sinnumero),
%
%<factdos|factseis>%%  Sin líneas verticales externas (sinlineasve),
%<facttres|factcuatro>%%  Sin líneas verticales internas (sinlineasvi),
%<factcuatro>%%  Sin líneas horizontales internas (sinlineashi),
%<factseis>%%  Sin líneas horizontales externas (sinlineashe),
%<facttres|factcinco>%%  Separado cada ítem con una línea horizontal (conlineasha),
%
%<factcinco|factocho>%%  Sin expandir el cuadro de la factura ni la descripción (sinexpandir),
%<facttres|factcuatro|prefac>%%  Expande el cuadro de la factura con espacio en blanco (exparriba),
%<prefac|facttres>%%  Con línea protectora del espacio en blanco (linea),
%
%<facttres>%%  Con el tipo de impuesto como parte de la descripción y no de los precios (impdesc),
%<factcinco|factseis|factsiete>%%  Obligando a especificar todos los IVA así no existan productos gravados con ellos (todosiva),
%<factseis>%%  Especificando 'G' en los ítems gravados con IVA general (G),
%<factocho>%%  Sin IVA (siniva),
%<factdos>%%  Sólo la firma del emisor (unafirma),
%<facttres>%%  Sin firmas (sinfirmas),
%<factcuatro>%%  Sin condiciones del documento (sincondiciones),
%<factseis>%%  Escribe un archivo CSV con la información numérica de la factura (csv),
%
%<factsiete>%%  Cambiando la geometría del papel de la factura (\GeometriaFactura),
%<repdos>%%  Cambiando la geometría del papel del reporte (\GeometriaReporte),
%<prefac|cotiza>%%  Con el fondo de la imprenta agregado (\FondoFactura),
%<repuno>%%  Especificamos el fondo (membrete) del reporte, sólo para la primera página (\FondoReporte),
%<repdos>%%  Especificamos el fondo (membrete) del reporte para todas las páginas (\FondoReporte*),
%<reptres>%%  Sin especificar fondo de reporte,
%<repuno>%%  Estableciendo un margen superior distinto para la primera página del reporte por presencia de membrete (\InicioReporte),
%<repuno|reptres>%%  Establecemos el título del reporte sin que salga en las cabeceras (\TituloReporte),
%<repdos>%%  Establecemos el título del reporte para que salga en las cabeceras (\TituloReporte*),
%<reptres>%%  Personalizamos la información de la cabecera del reporte y mostramos el nombre del proveedor allí (\InfoPagina),
%<reptres>%%  Cambiamos el estilo de página para que la información del reporte aparezca como pie de página (\EstiloPagReporte),
%<cotiza>%%  Agregando la firma escaneada en la factura, es decir, en la cotización (\FirmaFactura),
%<repdos>%%  Agregando la firma escaneada en el reporte (\FirmaReporte),
%<reptres>%%  Agregando en el reporte la línea para firmar a mano (\FirmaReporte),
%
%<factdos|facttres|factsiete>%%  Alterando la separación mínima vertical entre los elementos (\SepElementos),
%<factdos|facttres|factsiete>%%  Alterando la separación horizontal en el encabezado y la distancia desde el contorno hasta el texto (\SepEncabez),
%<factdos|factsiete>%%  Alterando la la distancia desde el contorno hasta el texto en la descripción (\SepDescrip),
%<factsiete>%%  Alterando la separación horizontal y vertical entre los totales en el modo de filas (\SepFilas),
%<facttres|factsiete>%%  Alterando la línea de las cajas del encabezado, la curvatura en la esquina y la sombra (\LineaEncabez),
%<factdos|factsiete>%%  Alterando la línea de la descripción, la curvatura en la esquina y la sombra (\LineaDescrip),
%<factsiete>%%  Alterando la longitud de las líneas para firmar y su grosor (\LineaFirmas),
%<factsiete>%%  Alterando la posición de la fecha, las firmas y de la denominación del documento (\PosFecha, \PosFirmas y \PosDenom),
%<factcuatro|factocho>%%  Cambiando varias de las tipografías (\Letra...),
%<factseis>%%  Redefiniendo el formato de la fecha (redefiniendo \@@Fecha y \@EstiloFecha),
%
%<factdos|factcuatro>%%  Usando \Nombre y \CI en lugar de \RazonSocial y \RIF,
%<factcuatro>%%  Sin especificar la persona de contacto,
%<factcuatro>%%  Sin especificar el e-mail del cliente,
%<factcinco|repuno>%%  Especificando el nombre del emisor de la factura (\Emisor),
%<factcinco|factseis>%%  Especificando el nombre de quien firma la copia de la factura como recibida (\Conforme),
%<repuno>%%  Sin especificar el proveedor, así toma el emisor de la factura como el nombre del proveedor,
%
%<facttres>%%  Con descuentos totales en porcentajes para exentos y gravables con IVA general (\DescuentoE y \DescuentoG),
%<factocho>%%  Con descuentos totales en moneda aplicables por igual a todos los tipos de elementos existentes (\Descuento*),
%<prefac>%%  Con descuentos totales en porcentaje aplicables por igual a todos los tipos de elementos existentes (\Descuento),
%<factuno|factdos|factcinco|factocho>%%  Con resumen (\Resumen),
%<facttres|factcuatro|prefac|cotiza|repuno|repdos>%%  Sin resumen,
%
%<factdos|factcuatro|factcinco>%%  Agregando un ítem sin precio (\ItemX),
%<factdos|facttres>%%  Con artículos gravados con todos los IVA,
%
%<factseis|repdos>%%  Con etiquetas y referencias,
%
%<!facttres&!reptres&!beispiel>%%  Con descripción larga (\Descripcion).
%<facttres|reptres>%%  Sin descripción larga.
%<beispiel>%%  Adaptado a otra legislación.
%%
%<factuno>\documentclass{factura}
%<!factuno>\documentclass[
%<prefac|beispiel>prefactura,
%<cotiza>cotizacion,
%<repuno>conreporte,
%<repdos|reptres>soloreporte,
%<beispiel>nospanish,
%<reptres>twoside,
%<factcinco>sincantidad,
%<factdos|factseis>numitem,
%<factdos>descuentos,
%<factcuatro|factcinco|factsiete>filas,
%<factcinco>centrado,
%<facttres>agrupado,
%<factcinco|factseis>denom,
%<cotiza>sinnumero, % sin esta opción aparecerá el número de la cotización.
%<factdos>dcu,
%<factcuatro>duc,
%<factdos|factseis>sinlineasve,
%<facttres|factcuatro>sinlineasvi,
%<factdos|facttres|factcuatro|factseis>% sinlineasv, % sin ninguna línea vertical
%<factcuatro>sinlineashi,
%<factseis>sinlineashe,
%<factcuatro|factseis>% sinlineash, % sin ninguna línea horizontal
%<facttres|factcinco>conlineasha,
%<factcinco|factocho>sinexpandir,
%<facttres|factcuatro|prefac>exparriba,
%<facttres|prefac>linea,
%<facttres>impdesc,
%<factcinco|factseis|factsiete>todosiva,
%<factseis>G,
%<factocho>siniva,
%<factdos>unafirma,
%<prefac|cotiza>% dosfirmas, % para poner las dos firmas
%<prefac>% unafirma, % para poner la firma del emisor
%<cotiza>% sinfirmas, % para no poner firmas
%<facttres>sinfirmas,
%<factcuatro>sincondiciones,
%<factseis>csv,
%<!factuno>]{factura}

\usepackage[utf8]{inputenc}
%<beispiel>\usepackage[official]{eurosym}
%<beispiel>\usepackage[ngerman]{babel}
%<beispiel>\usepackage[T1]{fontenc}
%<beispiel>
%<beispiel> \def\Moneda{\euro{}}
%<beispiel>\makeatletter
%<beispiel> \def\@AlicuotaG{0.19}
%<beispiel> \def\@AlicuotaR{0.07}
%<beispiel> \def\@DenomAlicuotaG{A}
%<beispiel> \def\@DenomAlicuotaR{C}
%<beispiel> \def\@DenomAlicuotaE{B}
%<beispiel> \def\@@Datos{Kundenidentifikation}
%<beispiel> \def\@@Resumen{Zusammenfassung}
%<beispiel> \def\@@Fecha{Datum:}
%<beispiel> \def\@@Nombre{Kunde:} \def\@@RazonSocial{Kunde:}
%<beispiel> \def\@@RIF{USt-IdNr:} \def\@@CT{USt-IdNr:}
%<beispiel> \def\@@Contacto{Kontactperson:}
%<beispiel> \def\@@Direccion{Adresse:}
%<beispiel> \def\@@Telefono{Telefon:}
%<beispiel> \def\@@Email{E-mail:}
%<beispiel> \def\@@Cliente{Kunde:}
%<beispiel> \def\@@Proveedor{Lieferant:}
%<beispiel> \def\@@Cantidad{Menge}
%<beispiel> \def\@@Descripcion{Beschreibung}
%<beispiel> \def\@@PrecioU{Einzelpreis}
%<beispiel> \def\@@PrecioT{Gesamt}
%<beispiel> \def\@@Precio{Preis}
%<beispiel> \def\@@AlicuotaG{MwSt A}
%<beispiel> \def\@@AlicuotaR{MwSt C}
%<beispiel> \def\@@BIG{Netto 19\%}
%<beispiel> \def\@@BIR{Netto 7\%}
%<beispiel> \def\@@BIE{Mwst-befreit}
%<beispiel> \def\@@Total{Brutto}% Zu zahlen / Brutto / Summe / Gesamt
%<beispiel> \def\@@Conforme{der Kunde}
%<beispiel> \def\@@DenomFactura{Rechnung}
%<beispiel> \def\@@DenomCotiza{Voranschlag}
%<beispiel> % \LetraNumeracion{\fontsize{14}{14}\bfseries}
%<beispiel> \renewcommand{\@EstiloDenom}{\@LetraDenom\@Denominacion-\if@sinnumero\else\@LetraNumeracion Nr:\space\@Num\fi}
%<beispiel> \renewcommand{\@EstiloNumControl}{}
%<beispiel>\makeatother

%<factsiete>\GeometriaFactura{legalpaper,vmargin={5cm,5.5cm},hmargin={1cm,1cm},footskip=0pt,headsep=0pt,headheight=0pt}
%<repdos>\GeometriaReporte{letterpaper,vmargin={4.4cm,2.5cm},hmargin={3cm,2cm},footskip=1.2cm,headsep=0.777cm,headheight=1.5cm}
%<prefac|cotiza|beispiel>\FondoFactura{factura-ejemplo-fondo}
%<repuno>\FondoReporte{factura-ejemplo-membrete}
%<repdos>\FondoReporte*{factura-ejemplo-membrete}
%<repuno>\InicioReporte{2.2cm}
%<repuno|reptres>\TituloReporte{El título del reporte}
%<repdos>\TituloReporte*{El título del reporte}
%<reptres>\InfoPagina{La cabecera o pie del reporte - \mostrar{@Proveedor}}
%<repuno|reptres>% \EstiloPagReporte{soloabajo}
%<repuno|reptres>% \EstiloPagReporte[soloabajo]{plain}
%<repuno|reptres>% \EstiloPagReporte[empty]{plain}
%<repdos|reptres>% \EstiloPagReporte[empty]{soloabajo}
%<reptres>% \EstiloPagReporte{plain}
%<repuno|repdos|reptres>% \EstiloPagReporte{solonumpag}
%<repdos>% \EstiloPagReporte{soloabajo}
%<repuno|reptres>% \EstiloPagReporte[solonumpag]{plain}
%<repuno|reptres>% \EstiloPagReporte[solonumpag]{soloarriba}
%<reptres>\EstiloPagReporte[solonumpag]{soloabajo}
%<repuno>% \EstiloPagReporte[solonumpag]{soloabajo}
%<repuno|reptres>% \EstiloPagReporte[empty]{soloarriba}
%<repuno|reptres>% \EstiloPagReporte{soloarriba}
%<cotiza>\FirmaFactura{\includegraphics[width=5cm]{factura-ejemplo-firma.pdf}}[0pt][21pt]
%<factdos|facttres|factsiete>\SepElementos{1cm}
%<factdos|facttres|factsiete>\SepEncabez{1cm}{16pt}
%<factdos|factsiete>\SepDescrip{16pt}
%<factsiete>\SepFilas{1cm}{10pt}
%<facttres|factsiete>\LineaEncabez{1pt}{20pt}{3pt}
%<factdos|factsiete>\LineaDescrip{1pt}{20pt}{3pt}
%<factsiete>\LineaFirmas{6.5cm}{2pt}
%<factsiete>\PosFecha{-0cm}{-1.5cm}
%<factsiete>\PosFirmas{1cm}{1cm}{-3cm}
%<factsiete>\PosDenom{-0cm}{4.3cm}
%<factcuatro>\LetraDescripcion{\fontsize{20}{30}}
%<factcuatro>\LetraTitEnc{\fontsize{15}{20}\bfseries}
%<factcuatro>\LetraFirmas{\fontsize{16}{20}\itshape}
%<factcuatro>\LetraCondiciones{\fontsize{18}{28}\bfseries}
%<factocho>\LetraItems{\fontsize{20}{30}}
%<factocho>\LetraNumeros{\fontsize{20}{30}}
%<factocho>\LetraTipoIVA{\fontsize{20}{30}\bfseries}
%<factocho>\LetraTitTotales{\fontsize{20}{30}\slshape}
%<factocho>\LetraNumTotales{\fontsize{20}{30}}
%<factocho>\LetraTitCuadro{\fontsize{15}{20}}
%<factocho>\LetraTitTotal{\fontsize{20}{30}\bfseries\slshape}
%<factocho>\LetraNumTotal{\fontsize{20}{30}\bfseries}
%<factocho>\tabcolsep7pt
%<factseis>\makeatletter
%<factseis> \renewcommand{\@@Fecha}{\slshape FECHA DE EMISIÓN:}
%<factseis> \renewcommand{\@EstiloFecha}{\@LetraFecha\bfseries\@@Fecha\space{\color{blue}\@Fecha}}
%<factseis>\makeatother
%<!factuno&!factcinco>
%<cotiza>% \Denom{PRESUPUESTO} % También podemos cambiar el nombre del documento
\Fecha{05-11-2016}
%<factcinco|factseis|cotiza|prefac|repuno|repdos|beispiel>\Num{1}
%<!factdos&!factcuatro&!beispiel>\RazonSocial{Ayala San Vicente Usureros}
%<factdos|factcuatro|beispiel>\Nombre{Jacinto de Ayala y San Vicente}
%<!factdos&!factcuatro&!beispiel&!reptres>\RIF{Y-12.345.678-9}
%<factdos|factcuatro|beispiel>\CI{V-987.654.321}
%<!factdos&!factcuatro&!reptres&!beispiel>\Contacto{Jacinto de Ayala}
%<!reptres>\Direccion{Av. Ayala, Galpón San Vicente, Sector Arauca, Apure, Venezuela}
%<!reptres>\Telefono{+58 (987) 654.32.10}
%<!factcuatro&!reptres>\Email{jacinto@ayala.sv}
%<factcinco|repuno>\Emisor{Lázaro de la Vega}
%<factcinco>\Conforme{\mostrar{@Contacto}}
%<factseis>\Conforme{Ramela San Vicente}
%<repdos|reptres>\Proveedor{Lázaro de la Vega y San Román}
%<!factcuatro&!beispiel&!reptres>\Condiciones{Las condiciones del documento...}
%<beispiel>\Condiciones{Die Zahlungsbedingungen}
%<prefac>\Descuento{18}
%<facttres>\DescuentoE{15}
%<facttres>\DescuentoG{20}
%<factocho>\Descuento*{300}
%<factuno|factdos|factcinco|factocho>\Resumen{El resumen opcional}
%<beispiel>\Resumen{Zusammenfassung}

\begin{document}
%<!reptres>
%<!reptres>\begin{factura}
%<!factdos&!factcinco&!factseis&!repdos&!reptres&!beispiel> \Item{1}{ítem con IVA general}{1000}
%<factseis|repdos> \Item{2}{ítem con IVA general}{1000}\label{primeritem}
%<factuno|factcuatro|factseis|repdos> \Item{4}{otro ítem con IVA general}{100}
%<facttres|prefac> \ItemR{1}{ítem con IVA reducido}{1000}
%<facttres> \ItemA{1}{ítem con IVA adicional}{1000}
%<facttres> \ItemE{1}{ítem exento de impuesto}{1000}
%<factdos> \Item{1}{ítem con IVA general, con descuento}{1000}{8}
%<factdos> \ItemR{1}{ítem con IVA reducido, con descuento}{1000}{5}
%<factdos> \ItemA{1}{ítem con IVA adicional, con descuento}{1000}{10}
%<factdos> \ItemE{1}{ítem exento de impuesto, con descuento}{1000}{8}
%<factdos|factcuatro> \ItemX{1}{línea sin precio}
%<factcinco> \Item{ítem sin cantidad, con IVA general}{1000}
%<factcinco> \ItemA{ítem sin cantidad, con IVA adicional}{1000}
%<factcinco> \ItemX{línea sin precio}
%<beispiel> \Item{1}{Artikel mit 19\% MwSt}{100}
%<beispiel> \ItemR{1}{Artikel mit 7\% MwSt}{100}
%<beispiel> \ItemE{1}{Artikel mit kein MwSt}{100}
%<!reptres>\end{factura}
%<!facttres&!reptres>
%<!facttres&!factseis&!reptres&!beispiel>\Descripcion{Descripción larga del servicio}
%<factseis>\Descripcion{Descripción larga del servicio.
%<factseis>
%<beispiel>\Descripcion{Lange Beschreibung.}
%<repuno|repdos|reptres|factcinco|factocho>
%<repuno|repdos|reptres|factcinco|factocho>\begin{reporte}
%<repuno|repdos|reptres|factcinco|factocho> El reporte - página 1\newpage El reporte - página 2 \newpage El reporte - página 3.
%<repdos>
%<factseis|repdos> En el artículo número \itemref{primeritem} se facturaron \cantref{primeritem} \descref{primeritem} por un valor de \Moneda\puref{primeritem} cada uno, dando un total de \Moneda\ptref{primeritem}, el IVA de este ítem es de \Moneda\AlicuotaG; luego se facturó otro ítem dando un total final de \Moneda\Total.
%<factseis|repdos> % También podemos usar \dctoref{primeritem} para la referencia al descuento, y en cuanto a las totalizaciones: \BIE, \BIR, \BIA, \AlicuotaR, \AlicuotaA, \SubtG, \SubtE, \SubtR, \SubtA, \DescG, \DescE, \DescR, \DescA para los demás totales.
%<factseis>}
%<repdos%<repdos|factcinco|factocho> \FirmaReporte[\includegraphics[width=5cm]{factura-ejemplo-firma}][0pt][21pt]
%<reptres> \vspace{1.5cm}\FirmaReporte
%<repuno|repdos|reptres|factcinco|factocho>\end{reporte}

\end{document}
%</!class&!def&!firma&!fondo&!membrete&!batchfile>
%<*firma>
%% (PSTricks code generated with LaTeXDraw 2.0.8)
%% (Compilar con XeLaTeX)
\documentclass{article}
\usepackage[hmargin={0cm,0cm},vmargin={0cm,0cm},paperwidth=5cm,paperheight=2.3cm]{geometry}
\usepackage[usenames,dvipsnames]{pstricks}
\usepackage{epsfig}
\usepackage{pst-grad}
\usepackage{pst-plot}
\parindent0pt
\begin{document}
\scalebox{0.35}
{
 \begin{pspicture}(0,-3.19388)(13.8397665,3.18)
  \pscustom[linewidth=0.1,linecolor=red]{
   \newpath
   \moveto(0.0,0.9762225)
   \lineto(1.0057193,0.95771605)
   \curveto(1.5085789,0.94846284)(2.4492223,1.1335286)(2.8870058,1.3278477)
   \curveto(3.3247895,1.5221668)(4.064289,2.0079648)(4.366005,2.2994435)
   \curveto(4.667721,2.5909224)(4.9457726,2.9518008)(4.9221087,3.0212007)
   \curveto(4.8984447,3.0906003)(4.762377,3.16)(4.6499724,3.16)
   \curveto(4.5375686,3.16)(4.1175327,2.9934406)(3.8099012,2.8268814)
   \curveto(3.5022693,2.6603222)(2.721358,1.6748462)(2.2480783,0.85592973)
   \curveto(1.7747989,0.037013244)(1.1358713,-0.91607606)(0.97022337,-1.050249)
   \curveto(0.8045755,-1.1844217)(0.5975156,-1.3185943)(0.5561036,-1.3185943)
   \curveto(0.5146916,-1.3185943)(0.43186772,-1.2121814)(0.39045575,-1.1057684)
   \curveto(0.34904376,-0.9993555)(0.37270775,-0.7495166)(0.4377837,-0.6060907)
   \curveto(0.50285965,-0.46266478)(0.6152636,-0.3608783)(0.6625916,-0.4025183)
   \curveto(0.7099195,-0.44415832)(0.82232344,-0.56907773)(0.8873994,-0.65235716)
   \curveto(0.9524753,-0.7356369)(1.354763,-0.86980957)(1.6919748,-0.9207028)
   \curveto(2.0291865,-0.97159606)(2.5202143,-1.0178626)(2.67403,-1.0132358)
   \curveto(2.827846,-1.008609)(3.0112422,-0.9207028)(3.0408218,-0.8374231)
   \curveto(3.0704017,-0.75414366)(3.0999818,-0.69862366)(3.0999818,-0.7263837)
   \curveto(3.0999818,-0.75414366)(3.1709735,-0.80966306)(3.2419655,-0.8374231)
   \curveto(3.3129578,-0.8651831)(3.4667737,-0.80041015)(3.5495975,-0.7078772)
   \curveto(3.6324213,-0.6153442)(3.7744055,-0.6199707)(3.8335655,-0.7171304)
   \curveto(3.8927252,-0.81429017)(4.141197,-0.9114496)(4.330509,-0.9114496)
   \curveto(4.5198207,-0.9114496)(4.7978725,-0.86055636)(4.8866124,-0.80966306)
   \curveto(4.9753523,-0.75877017)(5.0995884,-0.74489015)(5.135084,-0.7819034)
   \curveto(5.1705804,-0.8189166)(5.324396,-0.8281702)(5.442716,-0.80041015)
   \curveto(5.5610366,-0.7726501)(5.6971045,-0.7680234)(5.7148523,-0.7911566)
   \curveto(5.7326,-0.81428987)(5.8745837,-0.83279663)(5.9988194,-0.8281699)
   \curveto(6.1230555,-0.8235431)(6.2887034,-0.78653014)(6.330116,-0.75414366)
   \curveto(6.3715277,-0.7217572)(6.454352,-0.69862366)(6.495764,-0.7078772)
   \curveto(6.537175,-0.7171304)(6.6554956,-0.6060907)(6.7324038,-0.48579803)
   \curveto(6.8093114,-0.36550537)(7.0163713,-0.041640013)(7.1465235,0.16193238)
   \curveto(7.2766747,0.36550477)(7.4245753,0.12491944)(7.442323,-0.3192389)
   \curveto(7.4600706,-0.7633969)(7.5133147,-1.6748462)(7.548811,-2.1421375)
   \curveto(7.5843067,-2.6094286)(7.5251465,-3.10448)(7.4304905,-3.13224)
   \curveto(7.335835,-3.16)(7.1465235,-3.17388)(7.051867,-3.16)
   \curveto(6.9572105,-3.14612)(6.9276304,-2.748228)(6.992707,-2.3642163)
   \curveto(7.057783,-1.980205)(7.436407,-1.4296337)(7.7499547,-1.2630746)
   \curveto(8.063502,-1.0965155)(8.619606,-0.80966306)(8.862162,-0.6893704)
   \curveto(9.104718,-0.56907773)(9.394602,-0.5181845)(9.441929,-0.58758426)
   \curveto(9.489257,-0.656984)(9.589829,-0.67549074)(9.643073,-0.6245975)
   \curveto(9.696317,-0.57370424)(9.767309,-0.5089313)(9.785057,-0.49505126)
   \curveto(9.802805,-0.48117125)(9.897461,-0.49505126)(9.974369,-0.5228113)
   \curveto(10.051277,-0.55057126)(10.175512,-0.62922424)(10.22284,-0.6801172)
   \curveto(10.270168,-0.73101014)(10.388489,-0.76802367)(10.45948,-0.75414366)
   \curveto(10.530473,-0.7402637)(10.65471,-0.6616107)(10.7079525,-0.59683746)
   \curveto(10.761196,-0.5320642)(10.838105,-0.5043045)(10.861769,-0.54131776)
   \curveto(10.885432,-0.5783307)(10.932761,-0.6477307)(10.956425,-0.6801172)
   \curveto(10.980088,-0.7125037)(11.033333,-0.75877017)(11.062913,-0.7726501)
   \curveto(11.092493,-0.78653014)(11.157568,-0.7680234)(11.193064,-0.7356369)
   \curveto(11.2285595,-0.7032504)(11.305469,-0.6662372)(11.34688,-0.6616107)
   \curveto(11.388292,-0.656984)(11.512528,-0.48579773)(11.595351,-0.31923857)
   \curveto(11.678176,-0.15267944)(11.778748,-0.02313324)(11.796496,-0.060146485)
   \curveto(11.814244,-0.09715942)(11.843824,-0.6569836)(11.855657,-1.1797949)
   \curveto(11.867488,-1.7026062)(11.87932,-2.2901905)(11.87932,-2.3549633)
   \curveto(11.87932,-2.4197364)(11.938479,-2.0773644)(11.997639,-1.6702198)
   \curveto(12.056799,-1.263075)(12.186951,-0.85592985)(12.257943,-0.85592985)
   \curveto(12.328936,-0.85592985)(12.459087,-0.8374231)(12.518247,-0.8189166)
   \curveto(12.577407,-0.80041015)(12.719391,-0.78653014)(12.802215,-0.7911566)
   \curveto(12.885039,-0.7957831)(13.03294,-0.7726501)(13.098015,-0.74489015)
   \curveto(13.163091,-0.7171301)(13.257747,-0.5922107)(13.287327,-0.49505126)
   \curveto(13.316907,-0.39789185)(13.352403,-0.33774537)(13.358318,-0.3747583)
   \curveto(13.364233,-0.41177154)(13.3878975,-0.48117125)(13.405647,-0.51355773)
   \curveto(13.423395,-0.5459442)(13.48847,-0.57370424)(13.535798,-0.56907773)
   \curveto(13.583126,-0.564451)(13.66595,-0.5598242)(13.701447,-0.5598242)
   \curveto(13.736943,-0.5598242)(13.784271,-0.5551978)(13.819766,-0.5413177)}
  \pscustom[linewidth=0.1,linecolor=red]{
   \newpath
   \moveto(12.952644,0.18)
   \lineto(13.020389,0.13)
   \curveto(13.05426,0.105)(13.135551,0.085)(13.182974,0.09)
   \curveto(13.230394,0.095)(13.304913,0.13)(13.332009,0.16)
   \curveto(13.359106,0.19)(13.399754,0.285)(13.413303,0.35)
   \curveto(13.426852,0.415)(13.4404,0.49)(13.4404,0.52)}
 \end{pspicture}
}
\end{document}
%</firma>
%<*fondo|membrete>
\documentclass[12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{tikz}\usetikzlibrary{positioning}
\usepackage{calc}
\usepackage[letterpaper,hmargin={1cm,1cm},vmargin={1cm,1cm},footskip=0pt,headsep=0pt,headheight=0pt]{geometry}
\parindent0pt
\lineskip0pt
\pagestyle{empty}
\begin{document}
 \begin{minipage}[b][\textheight]{\textwidth}
  \baselineskip13pt
  \parskip0pt
  \lineskip0pt
  \hspace*{\fill}%
  \begin{tikzpicture}
   \node (Nombre) [draw=none, fill=gray, rounded corners=4pt]{%
    \parbox{0.57\textwidth}{%
     \vspace*{0.1cm}%
     \centering
     \color{white}\fontfamily{ppl}\LARGE\bfseries
     Lázaro de la Vega y San Román}};
   \node [node distance=0pt, below = of Nombre, outer sep=0pt, draw=gray, line width=2pt, inner sep=3.5pt, rounded corners=8pt]{%
    \parbox{0.66\textwidth}{%
     \vspace*{3pt}%
     \parskip2pt
     \centering
     \color{gray}\fontfamily{ppl}\footnotesize\bfseries
     Av. Garcilaso de la Vega, Qta. San Román, Santa Mónica, Caracas, Venezuela.
     \par
     Teléfono: +58 (123) 456.78.90 / email: lázaro@sanrom.án
     \vspace*{3pt}}};
  \end{tikzpicture}
  \hspace*{\fill}\par
  \hspace*{\fill}%
  \parbox{0.63\textwidth}{%
   \color{gray}\fontfamily{aer}\footnotesize\bfseries
   \hfill
   RIF: V-87.654.321-0}%
  \hspace*{\fill}\par
  \vfill\mbox{}%
%<fondo>  \fontsize{6}{8}\selectfont
%<fondo>  \hspace*{0.5cm}%
%<fondo>  \parskip2pt
%<fondo>  {\bfseries ESTA FORMA LIBRE VA SIN TACHADURA NI ENMIENDA \hfill SÓLO EL ORIGINAL DA DERECHO A CRÉDITO FISCAL}
%<fondo>  \hspace*{0.5cm}\par
%<fondo>  \fontdimen2\font=0.55em
%<fondo>  Imprenta: \hfill IMPRESOS DE LA VEGA. Av. Garcilaso de la Vega, Qta. San Román, Santa Mónica, Caracas, Venezuela. RIF: R-87.654.321-0. Tlf: (0123) 456.78.90\newline
%<fondo>  \fontdimen2\font=0.65em
%<fondo>  e-mail: \hfill imprenta@sanrom.án. No. Providencia SENIAT 01/01060 de fecha 12/11/2008 - Control desde No. 00-000001 hasta No. 00-010000 / Fecha 01/01/2016.\par
 \end{minipage}
\end{document}
%</fondo|membrete>
%    \end{macrocode}
% \Finale
% \starttodo
