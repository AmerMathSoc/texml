%%
%% This is file `poemscol.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% poemscol.dtx  (with options: `package')
%% 
%% IMPORTANT NOTICE:
%% 
%% For the copyright see the source file.
%% 
%% Any modified versions of this file must be renamed
%% with new filenames distinct from poemscol.sty.
%% 
%% For distribution of the original source see the terms
%% for copying and modification in the file poemscol.dtx.
%% 
%% This generated file may be distributed as long as the
%% original source files, as listed above, are part of the
%% same distribution. (The sources need not necessarily be
%% in the same archive or directory.)
\NeedsTeXFormat{LaTeX2e}[1997/12/01]
\ProvidesPackage{poemscol}
   [2015/6/18 v2.72 poemscol file]







%%
%% In my own book I also, strictly to save money, and at the price of
%% some ugliness, changed the definition of |\normalsize| and |\small|,
%% so that the former was 10 pt type on 11 pt leading (rather than 12
%% pt), and that the latter was 9 pt type on 10 pt leading.  You can
%% reproduce this setting by issuing |\tightleading|, although I would
%% advise not doing so unless you are under financial constraints.



 \newcommand{\tightgeometry}{\geometry{verbose, tmargin= 33pt,
 textwidth=318.21pt,textheight=550pt,
 marginparsep=7pt,marginparwidth=10pt,
 headheight= 15pt,
 headsep=19pt,
 footskip=15pt,
 lmargin=132pt}
\setlength{\oddsidemargin}{60pt}
\setlength{\evensidemargin}{65.41pt}}
\newcommand{\tightleading}{%
\makeatletter
\renewcommand\normalsize{%
   \@setfontsize\normalsize\@xpt\@xipt
   \abovedisplayskip 10\p@ \@plus2\p@ \@minus5\p@
   \abovedisplayshortskip \z@ \@plus3\p@
   \belowdisplayshortskip 6\p@ \@plus3\p@ \@minus3\p@
   \belowdisplayskip \abovedisplayskip
   \let\@listi\@listI}
\makeatother
\normalsize
\makeatletter
\renewcommand\small{%
   \@setfontsize\small\@ixpt{10}%
   \abovedisplayskip 8.5\p@ \@plus3\p@ \@minus4\p@
   \abovedisplayshortskip \z@ \@plus2\p@
   \belowdisplayshortskip 4\p@ \@plus2\p@ \@minus2\p@
   \def\@listi{\leftmargin\leftmargini
               \topsep 4\p@ \@plus2\p@ \@minus2\p@
               \parsep 2\p@ \@plus\p@ \@minus\p@
               \itemsep \parsep}%
   \belowdisplayskip \abovedisplayskip
}
\makeatother}



\newcommand{\volumetitlefont}{\fontsize{18}{23}\selectfont}
\newcommand{\volumesubtitlefont}{\fontsize{14}{18}\selectfont}
\newcommand{\poemtitlefont}{\fontsize{14}{18}\selectfont}
\newcommand{\sequencetitlefont}{\fontsize{16}{20}\selectfont}
\newcommand{\subsectiontitlefont}{\fontsize{12}{14.5}\selectfont}
\newcommand{\backmatterheaderfont}{\fontsize{16}{20}\selectfont}
\newcommand{\volumetitlesink}{\leavevmode\vspace{23.5pt}}
\newcommand{\backmattersink}{\leavevmode\vspace{21.5pt}}
\newcommand{\backmatterafterheadersink}{\leavevmode\vspace{11pt}}
\newcommand{\backmattertextfont}{\small}
\newcommand{\backmatterintrofont}{\normalsize}
\newcommand{\backmattervolumefont}{\fontsize{12}{14.5}\selectfont}
\newcommand{\backmattervolumesubtitlefont}{\fontsize{11}{13}\selectfont}
\newcommand{\contentsvolumefont}{\fontsize{14}{20}\selectfont}
\newcommand{\contentsvolumesubtitlefont}{\fontsize{12}{14.5}\selectfont}
\newcommand{\contentssequencetitlefont}{\fontsize{10}{14}\selectfont}
\newcommand{\contentspoemtitlefont}{\fontsize{10}{14}\selectfont}

\widowpenalty=300
\clubpenalty=300
\newcommand{\notespoemclubpenalty}{\penalty-300}
\newcommand{\notessequenceclubpenalty}{\penalty-1500}
\newcommand{\notesvolumetitlepenalty}{\penalty-1500}
\hfuzz=2pt
\newcommand{\verseindent}{\hspace{2em}}
\setlength{\columnsep}{15pt}
\newdimen\titleindentamount \titleindentamount=1pc
\newdimen\titleindenttwoamount \titleindenttwoamount=2pc
\newdimen\titleindentthreeamount \titleindentthreeamount=3pc
\newcommand{\titleindent}{\hspace{\titleindentamount}}
\setlength{\parindent}{\titleindentamount}
\newcommand{\afterpoemtitleskip}{\smallskip}
\newcommand{\afterpoemskip}{\bigskip}
\newcommand{\aftersequencetitleskip}{\medskip}
\newcommand{\stanzaskip}{\medskip}
\newdimen\volumetitleshiftamount \volumetitleshiftamount=1pc
\newcommand{\volumetitleshift}{\hbox{\hspace{\volumetitleshiftamount}}}
\newdimen\voladditionalamount \voladditionalamount=2pc
\newdimen\contentsindentoneamount \contentsindentoneamount=24pt
\newcommand{\contentsindentone}{\hspace{\contentsindentoneamount}}
\newdimen\contentsindenttwoamount \contentsindenttwoamount=42pt
\newcommand{\contentsindenttwo}{\hspace{\contentsindenttwoamount}}
\newdimen\contentsindentthreeamount \contentsindentthreeamount=60pt
\newcommand{\contentsindentthree}{\hspace{\contentsindentthreeamount}}
\newdimen\contentsindentfouramount \contentsindentfouramount=72pt
\newcommand{\contentsindentfour}{\hspace{\contentsindentfouramount}}
\newdimen\contentsindentfiveamount \contentsindentfiveamount=80pt
\newcommand{\contentsindentfive}{\hspace{\contentsindentfiveamount}}
\newcommand{\poemtitlepenalty}{\penalty-1000}
\newcommand{\multilinetitlepenalty}{\penalty-3000}
\newcommand{\sequencetitlepenalty}{\penalty-3000}
\newcommand{\multilinesequencepenalty}{\penalty-3500}

\def\makeatletter{\catcode`\@=11}
\def\makeatother{\catcode`\@=12 }
\newcommand{\runoverindent}[1]{\global\edef\runoverindentvalue{#1}
}
\runoverindent{6em}
\newenvironment{pmclverse}[1][\linewidth]{%
\let\\=\@centercr%
\list{}{\itemsep\z@
\itemindent -\runoverindentvalue
\listparindent \itemindent
         \ifdim #1 < \linewidth
            \rightmargin        \z@
            \setlength{\leftmargin}{\linewidth}%
            \addtolength{\leftmargin}{-#1}%
            \addtolength{\leftmargin}{-0.5\leftmargin}%
          \else
            \rightmargin        \leftmargin
          \fi
\advance\leftmargin\runoverindentvalue}
\item[]}
{\endlist}
\newif\ifinquotedverse
 \newenvironment{quotedverse}{%
 \inquotedversetrue
 \let\\=\@centercr%
 \list{}{\itemsep\z@ \itemindent -\runoverindentvalue\listparindent \itemindent
           \rightmargin 0sp\leftmargin 0sp\advance\leftmargin
           \runoverindentvalue}\item[]}
 {\endlist\inquotedversefalse}

\newcounter{verselinenumber}
\newcounter{printlineindex}
\newcounter{verselinenumberscratch}
\newcounter{printlineindexscratch}
\newcounter{lineindexrepeat} \setcounter{lineindexrepeat}{9}
\newcounter{lemmalines}
\setcounter{lemmalines}{0}
\newcounter{lemmaend}
\setcounter{lemmaend}{0}
\newcounter{poemnumber}
\setcounter{poemnumber}{1}
\newcounter{notepageholdertitle} \setcounter{notepageholdertitle}{1}
\newcounter{notepageholdernote}  \setcounter{notepageholdernote}{1}
\newtoks{\fulltitleholder}
\newtoks{\titlesofar}
\newtoks{\titleincrement}
\newif\ifinstanza
\newif\ifinpoem
\newif\ifpoemcontentson
\newif\iftextnoteson
\newif\ifverselinenumbers
\newif\ifexplanon
\newif\ifemendationson
 \global\verselinenumberstrue
\newif\ifindexingon
\global\indexingontrue
\ifindexingon
  \makeindex
\fi
\newif\ifincludeaccidentals
\global\includeaccidentalstrue
\newif\ifincludetypescripts
\global\includetypescriptstrue
\newif\ifredundantemendations
\global\redundantemendationsfalse
\newif\ifnoemendyet
\newif\ifnoexplainyet
\global\noemendyettrue
\global\noexplainyettrue
\newif{\ifmiddlecontentsline}
\middlecontentslinefalse
\newif{\iflastcontentsline}
\lastcontentslinefalse
\newif{\ifputpagenumberincontents}
\putpagenumberincontentstrue
\newif{\ifputpagenumberinnotes}
\putpagenumberinnotestrue
\newif{\ifsinglelinetitle}
\singlelinetitletrue
\newif{\iftitlefirstline}
\titlefirstlinefalse
\newif{\iftitlemiddleline}
\titlemiddlelinefalse
\newif{\iftitlelastline}
\titlelastlinefalse
\newif{\ifverserightflush}
\verserightflushfalse
\newif\ifrangelemma
\rangelemmafalse
\newcommand{\makeverselinenumbers}{\global\verselinenumberstrue}
\let\makelinenumbers=\makeverselinenumbers% for compatibility
\newif\iftextnotesatend
\textnotesatendtrue
\newif\ifemendationsatend
\emendationsatendtrue
\newif\ifexplanatend
\explanatendtrue
\newif\iftextfootnotespara
\textfootnotesparatrue
\newif\ifsourcesfootnotespara
\sourcesfootnotesparafalse
\newif\ifemendationfootnotespara
\emendationfootnotesparatrue
\newif\ifexplanfootnotespara
\explanfootnotesparafalse

\newcommand{\volumeheader}[1]{\global\edef\volumeheadervalue{#1}
}
\newcommand{\leftheader}[1]{\global\edef\leftheadervalue{#1}
}
\leftheader{\relax}
\volumeheader{\relax}
\newcommand{\rightheader}[1]{\volumeheader{#1}}
\newlength{\headoffsetlength}
\setlength{\headoffsetlength}{-1sp}
\raggedbottom
\pagestyle{fancy}
\fancyhead{}
\fancyfoot{}
\fancyhfoffset[RO,LE]{\headoffsetlength}
\fancyhead[RO]{{\small\textrm{\thepage}}}
\fancyhead[LE]{{\small\textrm{\thepage}}}
\fancyhead[CO]{\hfil{\small{\em \volumeheadervalue}}}
\fancyhead[CE]{{\small{\em \leftheadervalue}}\hfil}
\fancyfoot[CE]{{\small \botmark}\hfil}
\fancyfoot[CO]{\hfil{\small \botmark}}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
\fancypagestyle{main}{%
\fancyhead{}
\fancyfoot{}
\fancyhfoffset[RO,LE]{\headoffsetlength}
\fancyhead[RO]{{\small\textrm{\thepage}}}
\fancyhead[LE]{{\small\textrm{\thepage}}}
\fancyhead[CO]{\hfil{\small{\em \volumeheadervalue}}}
\fancyhead[CE]{{\small{\em \leftheadervalue}}\hfil}
\fancyfoot[CE]{{\small \botmark}\hfil}
\fancyfoot[CO]{\hfil{\small \botmark}}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
}

\fancypagestyle{volumefirststyle}{%
\fancyhf{}
\fancyfoot[C]{\hfil{\small \botmark}\hfil}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
}
\fancypagestyle{plain}{%
\fancyhf{}
\fancyhead[RO,LE]{{\small\textrm{\thepage}}}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
}
\fancypagestyle{volumetitlestyle}{%
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
}

 \newcommand{\resetpagestyle}{\pagestyle{main}
}
 \newcommand{\clearemptydoublepage}{\newpage{\pagestyle{empty}\cleardoublepage}}
\newtoks{\singlepageabbrev}
\singlepageabbrev={p.}
\newcommand{\changesinglepageabbrev}[1]{\singlepageabbrev={#1}}
\newtoks{\multiplepageabbrev}
\newcommand{\changemultiplepageabbrev}[1]{\multiplepageabbrev={#1}}
\multiplepageabbrev{pp.}
\newcommand{\mymarks}{%
   \ifthenelse{\equal{\firstmark}{\botmark}}%
        {\unskip ~\the\singlepageabbrev~\firstmark}% if equal
        {\unskip ~\the\multiplepageabbrev~\firstmark--\botmark}}%if not equal
\newcommand{\poemdotfill}{\dotfill}
\newenvironment{stanza}{\penalty-100\instanzatrue\mark{\nostanzaatbottomvalue\ }}
 {\nobreak\mark{\stanzaatbottomvalue\ }\nobreak\ifspeciallinelock%
\relax\else%
\nolinebreak\incrementverselinenumber%
\fi%
\speciallinelockfalse%
\nobreak
  \instanzafalse

  \stanzaskip
}

\newenvironment{marginenvironment}{}{}
\newcommand{\stanzalinestraddle}
    {\begin{stanza}\addtocounter{verselinenumber}{-1}%
    \addtocounter{printlineindex}{-1}%
    }
\newlength{\contentsentryoverrun}
\setlength{\contentsentryoverrun}{\contentsindentoneamount}
\newenvironment{contentsentryenvironment}{%
\language=255%no hyphenation in contents
\let\\=\@centercr%
\list{}{\topsep\z@%
\partopsep\z@%
\itemsep\z@ \itemindent -\contentsentryoverrun\listparindent \itemindent
          \rightmargin 1sp\leftmargin 1sp\advance\leftmargin
          \contentsentryoverrun}\item[]}{\endlist}
\newlength{\titleentryoverrun}
\setlength{\titleentryoverrun}{\z@}
\newenvironment{titleentryenvironment}{%
\language=255%no hyphenation in poem titles
\let\\=\@centercr%
\list{}{\topsep\z@%
\partopsep\z@%
\itemsep\z@ \itemindent -\titleentryoverrun\listparindent \itemindent
          \rightmargin 1sp\leftmargin 1sp\advance\leftmargin
          \titleentryoverrun}\item[]}{\endlist}
\newlength{\versewidth}
\newenvironment{poem}[1][\linewidth]
{\raggedright%
     \language=255%no hyphenation in verse
     \noemendyettrue%
     \noexplainyettrue%
     \setcounter{verselinenumber}{0}\setcounter{printlineindex}{0}%
     \nobreak\begin{pmclverse}[#1]%
     \inpoemtrue\nobreak\mark{\relax}%
     }{\end{pmclverse}%
     \inpoemfalse\mark{\relax}%
     \goodbreak\afterpoemskip%\bigskip
     }
\newenvironment{rightflushverse}{\let\oldleftskip=\leftskip%
\leftskip=1 \leftskip\advance\leftskip by 0pt plus 1fill}%
{\let\leftskip=\oldleftskip}
\newenvironment{volumetitlepage}
{\par\clearpage{\pagestyle{volumetitlestyle}\cleardoublepage}
\thispagestyle{volumetitlestyle}}
    {\newpage\thispagestyle{volumetitlestyle}
\cleardoublepage\thispagestyle{volumefirststyle}}
\newenvironment{maintitlepage}
{\par\cleardoublepage\thispagestyle{volumetitlestyle}
}{\newpage\thispagestyle{volumetitlestyle}\cleardoublepage}
\newenvironment{booksectionpage}
{\par\newpage\thispagestyle{volumetitlestyle}}{\newpage}
 \setlength{\marginparsep}{18pt}
 \setlength{\marginparwidth}{10pt}
\newif\ifnumbersswitch \numbersswitchfalse
\newif\ifnumbersright \numbersrighttrue
\newcommand{\pmclsidepar}{\@dblarg{\@pmclsidepar}}
\long\def\@pmclsidepar[#1]#2{\@bsphack\strut\vadjust{% added
\checkoddpage
  \ifpmclsideparswitch
    \ifpmclreversesidepar
      \ifoddpage
        \oddpagefalse
      \else
        \oddpagetrue
      \fi
    \fi
  \else
    \oddpagetrue
    \ifpmclreversesidepar
      \oddpagefalse
    \fi
  \fi
  \rlap{\kern-\parindent
    \if@twocolumn
      \if@firstcolumn     % put at left
        \kern -\marginparsep \kern -\marginparwidth % at left
      \else               % put at right
        \kern \columnwidth \kern \marginparsep % at right
      \fi
    \else
      \ifoddpage            % put at right
        \kern \textwidth \kern \marginparsep        % at right
      \else                 % put at left
        \kern -\marginparsep \kern -\marginparwidth % at left
      \fi
    \fi
    \setbox0=\vtop to 0pt{% added
     \begin{minipage}[t]{\marginparwidth}% added
     \ifoddpage #2\else #1\fi%
      \end{minipage}%
\vss}% added
 \vtop to 0pt{\kern\pmclsideparvshift % default should be 0pt
  \kern-\dp\strutbox \kern-\ht0 \box0 \vss}}}\@esphack}% added

\gdef\thepmemc@@page{\the\c@page}

\providecommand{\pmemlabel}[1]{\@bsphack
  \pmemprotected@write\@auxout{}%
    {\string\newpmemlabel{#1}{\thepmemc@@page}}%
  \@esphack}
\long\def\pmemprotected@write#1#2#3{%
  \begingroup
  \let\thepmemc@@page\relax
  #2%
  \let\protect\@unexpandable@protect
  \edef\reserved@a{\write#1{#3}}%
  \reserved@a
  \endgroup
  \if@nobreak\ifvmode\nobreak\fi\fi}

\providecommand{\newpmemlabel}[2]{{\global\@namedef{m@#1}{#2}}}
\providecommand{\pmemlabelref}[1]{%
  \expandafter\ifx\csname m@#1\endcsname\relax
    0%
  \else
    \csname m@#1\endcsname
  \fi}

\newcount\@memcnta
\DeclareRobustCommand{\checkoddpage}{%
  \oddpagefalse%
  \ifstrictpagecheck%
    \stepcounter{cp@cntr}\pmemlabel{\cplabel\thecp@cntr}%
    \@memcnta=\pmemlabelref{\cplabel\thecp@cntr}\relax
    \ifodd\@memcnta\oddpagetrue\fi
  \else
    \ifodd\c@page\oddpagetrue\fi
  \fi}

\newif\ifpmclreversesidepar
  \pmclreversesidepartrue
\newif\ifpmclsideparswitch
  \pmclsideparswitchfalse
\if@twoside \pmclsideparswitchtrue \fi

\newif\ifoddpage
\newif\ifstrictpagecheck
  \strictpagecheckfalse
\newcounter{cp@cntr}
\newcommand{\cplabel}{^_}
\newlength{\pmclsideparvshift}
\setlength{\pmclsideparvshift}{0ex}
\newcommand{\verselinenumberstoleft}{%
   \setlength{\marginparsep}{18pt}%
   \setlength{\marginparwidth}{10pt}%
   \numbersswitchfalse\numbersrightfalse}
\newcommand{\verselinenumberstoright}{%
   \setlength{\marginparsep}{18pt}%
   \setlength{\marginparwidth}{10pt}%
   \numbersswitchfalse\numbersrighttrue}
\newcommand{\verselinenumbersswitch}{%
   \strictpagechecktrue%
   \setlength{\marginparsep}{18pt}%
   \setlength{\marginparwidth}{10pt}%
   \numbersswitchtrue\numbersrightfalse\pmclsideparswitchtrue}
\newif\ifnumbersgutter \numbersgutterfalse%
\newcommand{\verselinenumbersgutter}{\verselinenumbersswitch%
\pmclreversesideparfalse%
\numbersguttertrue%
}
\newcommand{\verselinenumbersouter}{\verselinenumbersswitch%
\pmclreversesidepartrue%
\numbersgutterfalse}
\newcommand{\putverselinenumber}{\nolinebreak\begin{marginenvironment}%
  \nolinebreak%
  \ifnumbersswitch\pmclsidepar{\hfil\textrm{\scriptsize\theverselinenumber}}%
    \else%
    \ifnumbersright\pmclrightsidepar{\hfil\textrm{\scriptsize\theverselinenumber}}%
      \else%
      \pmclleftsidepar
{\textrm{\scriptsize\theverselinenumber}\hfil}%
      \fi%
    \fi%
  \nolinebreak%
  \end{marginenvironment}%
  \nolinebreak%
}
\newif\ifspeciallinelock
\speciallinelockfalse
\newcommand{\verseline}{\ifspeciallinelock%
\relax\else%
\nolinebreak\incrementverselinenumber%
\fi%
\speciallinelockfalse%
\nolinebreak\\
}
\newcommand{\incrementverselinenumber}{%
\nolinebreak\addtocounter{verselinenumber}{1}%
  \addtocounter{printlineindex}{1}%
  \ifnum\theprintlineindex>\thelineindexrepeat%
    \ifverselinenumbers\nobreak%
      \putverselinenumber\nobreak%
    \fi\nobreak%
    \setcounter{printlineindex}{0}%
   \fi%
}
\newcommand{\setverselinemodulo}[1]{%
\setcounter{lineindexrepeat}{#1}%
\addtocounter{lineindexrepeat}{-1}%
}
\newcommand{\linebend}{\\
\hspace{\runoverindentvalue}%
 }
\newcommand{\saveverselinenumber}{\setcounter{verselinenumberscratch}%
    {\value{verselinenumber}}%
   \setcounter{printlineindexscratch}{\value{printlineindex}}}
\newcommand{\restoreverselinenumber}{\setcounter{verselinenumber}%
     {\value{verselinenumberscratch}}%
    \setcounter{printlineindex}{\value{printlineindexscratch}}}
\newcommand{\rightversebegin}
{\leavevmode\nobreak\hskip0pt plus -1fill\ignorespaces}
\newcommand{\hour}[1]{{{\textsc{#1}}\ $\!\!\!$}
 }
\newcommand{\brokenline}{\\}
\newcommand{\versephantom}[1]{\leavevmode\phantom{#1}}
\newcommand{\tweakbrokenline}{%
  \renewcommand{\brokenline}{\ifnumbersswitch\relax%
  \ifnumbersgutter% shift on odd pages for gutter numbers
  \ifodd\c@page \relax \else \speciallinelocktrue\incrementverselinenumber\fi
  \else % shift on even pages for outer numbers
  \ifodd\c@page \speciallinelocktrue\incrementverselinenumber \fi
  \fi
     \else \ifnumbersright \relax%
       \else \speciallinelocktrue\incrementverselinenumber%
       \fi%
     \fi%
\\}
}
\newcommand{\brokenlineatbeginning}{%
  \renewcommand{\brokenline}{%
  \speciallinelocktrue\incrementverselinenumber%
  \\
  }
}
\newcommand{\startverseline}{%
\speciallinelocktrue%
\leavevmode%
\incrementverselinenumber%
}
\newcommand{\tweakstartverseline}{%
\renewcommand{\startverseline}{%
\leavevmode%
\ifnumbersswitch%
  \ifnumbersgutter%
      \ifodd\c@page \relax \else \speciallinelocktrue\incrementverselinenumber\fi
  \else
      \ifodd\c@page \speciallinelocktrue\incrementverselinenumber \fi
  \fi% end of ifnumbersgutter
\else \ifnumbersright \relax% numbers don't switch. Are they to the right?
       \else \speciallinelocktrue\incrementverselinenumber% or to the left?
       \fi% end of ifnumbersright
\fi% end of ifnumbersswitch
}% end of renewcommand
}% end of tweakverseline
\def\poemlinelabel#1{\@bsphack
 \protected@write\@auxout{}%
 {\string\newlabel{#1}{{\theverselinenumber}{\thepage}}}%
\@esphack
}
\newtoks{\pmclcontentsname}
\pmclcontentsname={CONTENTS}
\newtoks{\pmclcontentsheader}
\pmclcontentsheader={Contents}
\newcommand{\changecontentsname}[1]{%
\pmclcontentsname={#1}}
\newcommand{\changecontentsheader}[1]{%
\pmclcontentsheader={#1}}
\newcommand{\makepoemcontents}[1][5]{\global\poemcontentsontrue
  \newwrite\poemcontents
  \immediate\openout\poemcontents=\jobname.ctn
  \literalcontents{\flushbottom\normalfont
{\par\clearpage{\pagestyle{volumetitlestyle}\cleardoublepage}
\pagestyle{fancy}\thispagestyle{volumetitlestyle}}
\pagenumbering{roman}
\setcounter{page}{#1}
\fancyhead[RO,LE]{{\small\textrm{\thepage}}}
\fancyhead[CO]{{\small{\em \the\pmclcontentsheader}}}
\fancyhead[CE]{{\small{\em \the\pmclcontentsheader}}}
\fancyfoot{}
\backmattersink
\begin{center}{\normalfont \backmatterheaderfont
\the\pmclcontentsname}\end{center}
\lefthyphenmin=2\backmatterafterheadersink\tolerance=500\language=0}
\literalcontents{  \relax}}

\newcommand{\setendnotessectiontitledefaults}[6]{%
#2%
#3 \begin{titleentryenvironment}%
{\ifcentertitleson\begin{center}#4 #1\end{center}\else #4 #1\fi}%
\end{titleentryenvironment}%
#5%
\label{#6}
}
\newcommand{\setendnotessectiontitle}[2]{
\setendnotessectiontitledefaults{#1}{\poemtitlepenalty\backmattersink\begin{center}}{\backmatterheaderfont}
{\relax}{\end{center}\lefthyphenmin=2\backmatterafterheadersink}{#2}}
\newcommand{\contentsendnotesdefaults}[4]{\ifpoemcontentson
\immediate\write\poemcontents{\string\begin\string{contentsentryenvironment\string}}%
\literalcontents{#2{#3#1}}%
  \ifputpagenumberincontents
\immediate\write\poemcontents{\string\contentsleaders}%
\immediate\write\poemcontents{\string\pageref
\string{#4\string}}%
  \else
  \literalcontents{\relax}%
  \fi
\immediate\write\poemcontents{\string\end\string{contentsentryenvironment\string}}%
\immediate\write\poemcontents{\string\par}%
\fi
}
\newcommand{\contentsendnotesindent}{\contentsindentone}
\newcommand{\contentsendnotesfont}{\contentspoemtitlefont}
\newcommand{\contentsendnotestitle}[2]{%
\contentsendnotesdefaults{#1}{\contentsendnotesindent}{\contentsendnotesfont}{#2}%
}
\newtoks{\pmclnotesname}
\pmclnotesname={TEXTUAL NOTES}
\newcommand{\changenotesname}[1]{\pmclnotesname={#1}}
\newtoks{\notesheadername}
\notesheadername={Textual Notes to}
\newcommand{\changenotesheader}[1]{\notesheadername={#1}}
\newtoks{\textnotescontentsname}
\textnotescontentsname={Textual Notes}
\newcommand{\changetextnotescontentsname}[1]{\textnotescontentsname={#1}}
\newif\iftextnotestwocol
\textnotestwocolfalse
\newcommand{\maketextnotes}{\global\textnotesontrue
  \global\verselinenumberstrue
  \newwrite\textnotes
  \immediate\openout\textnotes=\jobname.ent
  \literaltextnote{\flushbottom{\par\clearpage
  {\pagestyle{volumetitlestyle}\cleardoublepage}
\thispagestyle{volumetitlestyle}}
\fancyhead{}
\fancyfoot{}
\fancyhead[RO,LE]{{\small\textrm{\thepage}}}
\fancyhead[CO]{{\small{\em \the\notesheadername~\mymarks}}}
\fancyhead[CE]{{\small{\em \the\notesheadername~\mymarks}}}
\fancyfoot[C]{}
\mark{3}
\setendnotessectiontitle{\the\pmclnotesname}{textualnotes}
\tolerance=500\language=0
\normalfont \backmattertextfont
\iftextnotestwocol
\begin{multicols}{2}
\fi
\setlength{\parindent}{-10pt}
}
}


\newtoks{\emendationsname}
\emendationsname={EMENDATIONS}
\newcommand{\changeemendationsname}[1]{\emendationsname={#1}}
\newtoks{\emendationsheadername}
\emendationsheadername={Emendations to}
\newcommand{\changeemendationsheader}[1]{\emendationsheadername={#1}}
\newtoks{\emendationscontentsname}
\emendationscontentsname={Emendations}
\newcommand{\changeemendationscontentsname}[1]{%
\emendationscontentsname={#1}}
\newif\ifemendationstwocol
\emendationstwocolfalse
\newcommand{\makeemendations}{\global\emendationsontrue
  \newwrite\emendations
  \global\verselinenumberstrue
   \immediate\openout\emendations=\jobname.emd
   \literalemend{\flushbottom{\par\clearpage
   {\pagestyle{volumetitlestyle}\cleardoublepage}
\thispagestyle{volumetitlestyle}}
\fancyhead{}
\fancyhead[RO,LE]{{\small\textrm{\thepage}}}
\fancyhead[CO]{{\small{\em \the\emendationsheadername~\mymarks}}}
\fancyhead[CE]{{\small{\em \the\emendationsheadername~\mymarks}}}
\fancyfoot{}
\mark{3}
\setendnotessectiontitle{\the\emendationsname}{emendationnotes}
\tolerance=500\language=0
\normalfont \backmattertextfont
\ifemendationstwocol
\begin{multicols}{2}
\fi
\setlength{\parindent}{-10pt}
}
}

\newtoks{\explanationsname}
\explanationsname={EXPLANATORY NOTES}
\newcommand{\changeexplanationsname}[1]{\explanationsname={#1}}
\newtoks{\explanationsheadername}
\explanationsheadername={Explanatory Notes to}
\newcommand{\changeexplanationsheader}[1]{\explanationsheadername={#1}}
\newtoks{\explanationscontentsname}
\explanationscontentsname={Explanatory Notes}
\newcommand{\changeexplanationscontentsname}[1]{%
\explanationscontentsname={#1}}
\newif\ifexplanationstwocol
\explanationstwocolfalse
\newcommand{\makeexplanatorynotes}{\global\explanontrue
     \global\verselinenumberstrue
     \newwrite\explanations
     \immediate\openout\explanations=\jobname.enx
     \literalexplain{\flushbottom{\par\clearpage
 {\pagestyle{volumetitlestyle}\cleardoublepage}
\thispagestyle{volumetitlestyle}}
\fancyhead[RO,LE]{{\small\textrm{\thepage}}}
\fancyhead[CO]{{\small{\em \the\explanationsheadername~\mymarks}}}
\fancyhead[CE]{{\small{\em \the\explanationsheadername~\mymarks}}}
\fancyfoot{}
\mark{3}
\setendnotessectiontitle{\the\explanationsname}{explanatorynotes}
\tolerance=500\language=0
\normalfont \backmattertextfont
\ifexplanationstwocol
\begin{multicols}{2}
\fi
\setlength{\parindent}{-10pt}
}
}

\newcommand{\@pagemarktotextnotes}[1]{%
\immediate\write\textnotes{\string\setcounterfrompageref\string{notepageholdertitle\string}%
\string{#1\string}\string\unskip}%
\immediate\write\textnotes{\string\mark%
\string{\string\thenotepageholdertitle\string}}%
}
\newcommand{\@poempagetotextnotes}[1]{%
\immediate\write\textnotes{\string\par\string\argpageref\string{#1\string}\string\unskip}%
\@pagemarktotextnotes{#1}}
\newcommand{\@poemtitletotextnotes}[1]{\literaltextnote{\textbf{#1}}}

\newcommand{\wholebooktitle}[1]{{\Huge\begin{center}
\hbox{#1}\end{center}}
}
\newcommand{\booksection}[1]{\volumesection{#1}}
\newcommand{\volumetitle}[1]{%
  \set@p@emtitle{#1}{\volumetitlesink\par}{\volumetitlefont}
  {\relax}{\nobreak\par\nobreak}{\z@}
  \putpagenumberincontentsfalse
  \putpagenumberinnotesfalse
  \literalcontents{\goodbreak}
  \c@ntentsinfo{#1}{\relax}{\contentsvolumefont}
  {\contentsindentoneamount}
  \literalcontents{\vspace{5pt}\par\nobreak}
  \literaltextnote{\notesvolumetitlepenalty\bigskip\goodbreak\par}
  \t@xtnotesinfo{\backmattervolumefont #1 \backmattertextfont\nobreak}
  \putpagenumberincontentstrue
  \putpagenumberinnotestrue}
\newcommand{\volumetitlefirstline}[1]{\firstlinesettings%
  \set@p@emtitle{#1}{\volumetitlesink\par}
  {\volumetitlefont}
  {\relax}{\nobreak\par\nobreak}{\z@}
  \putpagenumberincontentsfalse
  \putpagenumberinnotesfalse
  \c@ntentsinfo{#1}{\relax}{\contentsvolumefont}
  {\contentsindentoneamount}
  \t@xtnotesinfo{\backmattervolumefont #1 \backmattertextfont\nobreak}
  \putpagenumberincontentstrue
  \putpagenumberinnotestrue}
\newcommand{\volumetitlemiddleline}[1]{\middlelinesettings%
  \set@p@emtitle{#1}{\relax}
  {\volumetitlefont}
  {\relax}{\nobreak\par\nobreak}{\z@}
  \putpagenumberincontentsfalse
  \putpagenumberinnotesfalse
  \c@ntentsinfo{#1}{\contentsindentone}{\contentsvolumefont}
  {\contentsindenttwoamount}
  \t@xtnotesinfo{\backmattervolumefont #1 \backmattertextfont\nobreak}
  \putpagenumberincontentstrue
  \putpagenumberinnotestrue}
\newcommand{\volumetitlelastline}[1]{\lastlinesettings%
  \set@p@emtitle{#1}{\relax}
  {\volumetitlefont}
  {\relax}{\nobreak\par\nobreak}{\z@}
  \putpagenumberincontentsfalse
  \putpagenumberinnotesfalse
  \c@ntentsinfo{#1}{\contentsindentone}{\contentsvolumefont}
  {\contentsindenttwoamount}
  \literalcontents{\vspace{5pt}\par\nobreak}
  \t@xtnotesinfo{\backmattervolumefont #1 \backmattertextfont\nobreak}
  \putpagenumberincontentstrue
  \putpagenumberinnotestrue}
\newcommand{\volumesubtitle}[1]{{\volumesubtitlefont
\volumetitleshift #1 \par}
  \ifpoemcontentson
    \literalcontents{{\contentsvolumesubtitlefont
#1\vspace{3pt}\par\nobreak}}
  \fi
  \iftextnoteson\iftextnotesatend
     \immediate\write\textnotes{\string\backmattervolumesubtitlefont\ #1}
     \immediate\write\textnotes{\string\par \string\backmattertextfont}
     \immediate\write\textnotes{\string\nobreak}
  \fi\fi
}
\newcommand{\volumesectiontitle}[1]
{\clearpage\thispagestyle{volumefirststyle}
\begin{center} {\volumesubtitlefont\textbf{#1}}
\end{center} \bigskip\bigskip
  \ifpoemcontentson
  \literalcontents{\goodbreak{\contentsvolumesubtitlefont #1\par\nobreak}}
  \fi
  \iftextnoteson\iftextnotesatend
     \immediate\write\textnotes{\string\notesvolumetitlepenalty}
     \immediate\write\textnotes{\string\par \string\begin{bf}}
     \immediate\write\textnotes{#1 \string\end{bf}}
     \immediate\write\textnotes{\string\par}
     \immediate\write\textnotes{\string\nobreak}
  \fi\fi
}

\newcommand{\makepoemlabel}[1]{\label{#1}}
\newcommand{\argpageref}[1]{\pageref{#1}}

\newcommand{\m@kep@emlabel}{\ifsinglelinetitle%
  \addtocounter{poemnumber}{1}%
  \makepoemlabel{poem\thepoemnumber}%
 \else\iftitlefirstline%
     \addtocounter{poemnumber}{1}%
     \makepoemlabel{poem\thepoemnumber}%
     \else \relax
\fi
\fi
}

\newcommand{\m@ken@teholder}[1]{%
\ifsinglelinetitle
\fulltitleholder={#1}%
\global\edef\@compoundlabelscratch{poem\thepoemnumber}%
\else\iftitlefirstline
       \fulltitleholder={#1}%
       \global\edef\@compoundlabelscratch{poem\thepoemnumber}%
     \else\iftitlemiddleline
     \titlesofar=\fulltitleholder
     \titleincrement={~#1}%
     \global\edef\titleconcat{\the\titlesofar \the\titleincrement}%
     \fulltitleholder=\expandafter{\titleconcat}%
     \global\edef\@compoundlabelscratch{poem\thepoemnumber}%
  \else
      \titlesofar=\fulltitleholder
      \titleincrement={~#1}%
      \global\edef\titleconcat{\the\titlesofar \the\titleincrement}%
      \fulltitleholder=\expandafter{\titleconcat}%
      \global\edef\@compoundlabelscratch{poem\thepoemnumber}%
   \fi
       \fi
  \fi
}
\newif\ifcentertitleson
\newcommand{\centertitles}{\centertitlesontrue}
\makeatletter
\newcommand{\set@p@emtitle}[6]{\setlength{\titleentryoverrun}{#6}%
{#2}%
{#3 \begin{titleentryenvironment}%
{\ifcentertitleson\begin{center}#4 #1\end{center}\else #4 #1\fi}%
\end{titleentryenvironment}}%
{#5}%
\m@kep@emlabel
\m@ken@teholder{#1}%
\setlength{\titleentryoverrun}{\z@}}


\newcommand{\setcontentsleaders}[1]{%
   \def\contentsleaders{#1\nobreak%
}}
\setcontentsleaders{~/~}
\newcommand{\c@ntentsinfo}[4]{\ifpoemcontentson
\immediate\write\poemcontents{\string\setlength\string\contentsentryoverrun\string{#4\string}}%
\immediate\write\poemcontents{\string\begin\string{contentsentryenvironment\string}}%
\literalcontents{#2{#3#1}}%
  \ifputpagenumberincontents
\immediate\write\poemcontents{\string\contentsleaders}%
\immediate\write\poemcontents{\string\pageref
\string{poem\thepoemnumber\string}}%
  \else
  \literalcontents{\relax}%
  \fi
\immediate\write\poemcontents{\string\end\string{contentsentryenvironment\string}}%
\immediate\write\poemcontents{\string\par}%
\immediate\write\poemcontents{\string\setlength\string\contentsentryoverrun
\string{\string\contentsindentoneamount\string}}%
\fi
}
\newif\ifputtitleinnotes
\puttitleinnotestrue
\newcommand{\t@xtnotesinfo}[1]{\iftextnoteson
\iftextnotesatend
 \immediate\write\textnotes{\string\notespoemclubpenalty}%
  \ifputpagenumberinnotes
   \@poempagetotextnotes{poem\thepoemnumber}%
  \fi
\ifputtitleinnotes
   \@poemtitletotextnotes{#1}%
\fi
   \fi\fi
}
\newcommand{\poemtitle}[1]{%
\set@p@emtitle{#1}{\poemtitlepenalty}{\poemtitlefont}%
{\relax}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}{\z@}%
\c@ntentsinfo{#1}{\contentsindentone}{\contentspoemtitlefont}%
{\contentsindenttwoamount}%
\t@xtnotesinfo{#1}%
}
\newcommand{\poemtitlenocontents}[1]{%
\set@p@emtitle{#1}{\poemtitlepenalty}{\poemtitlefont}%
{\relax}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}{\z@}%
\t@xtnotesinfo{#1}%
}
\newcommand{\poemtitlebaretitle}[1]{%
\set@p@emtitle{#1}{\poemtitlepenalty}{\poemtitlefont}%
{\relax}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}{\z@}%
}
\newcommand{\poemtitleitalic}[2]{%
\poemtitle{#1}}
\newcommand{\firstlinesettings}{\singlelinetitlefalse
\titlefirstlinetrue
\putpagenumberincontentsfalse
\putpagenumberinnotestrue}

\newcommand{\middlelinesettings}{\singlelinetitlefalse
\titlemiddlelinetrue
\putpagenumberincontentsfalse
\putpagenumberinnotesfalse}

\newcommand{\lastlinesettings}{\singlelinetitlefalse
\titlelastlinetrue
\putpagenumberincontentstrue
\putpagenumberinnotesfalse}

\newcommand{\restoresinglelinesettings}{\putpagenumberinnotestrue
\putpagenumberincontentstrue
\titlefirstlinefalse
\titlemiddlelinefalse
\titlelastlinefalse
\singlelinetitletrue}

\newcommand{\poemtitlefirstline}[1]{
\firstlinesettings
\set@p@emtitle{#1}{\multilinetitlepenalty}{\poemtitlefont}%
{\relax}{\nobreak\par\nobreak}{\z@}%
\c@ntentsinfo{#1}{\contentsindentone}{\contentspoemtitlefont}%
{\contentsindenttwoamount}%
\t@xtnotesinfo{#1}%
\restoresinglelinesettings
}

\newcommand{\poemtitlemiddleline}[1]{%
\middlelinesettings
\set@p@emtitle{#1}{\par\nobreak}{\poemtitlefont}%
{\relax}{\nobreak\par\nobreak}{\z@}%
\c@ntentsinfo{#1}{\contentsindenttwo}{\contentspoemtitlefont}%
{\contentsindentthreeamount}%
\t@xtnotesinfo{#1}%
\restoresinglelinesettings
}
\newcommand{\poemtitlelastline}[1]{%
\lastlinesettings
\set@p@emtitle{#1}{\par\nobreak}{\poemtitlefont}%
{\relax}{\nobreak\par\afterpoemtitleskip\nobreak}{\z@}%
\c@ntentsinfo{#1}{\contentsindenttwo}{\contentspoemtitlefont}%
{\contentsindentthreeamount}%
\t@xtnotesinfo{#1}%
\restoresinglelinesettings
}
\newcommand{\poemsectiontitle}[1]{%
\set@p@emtitle{#1}{\poemtitlepenalty}{\subsectiontitlefont}%
{\titleindent}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}%
{\titleindentamount}%
\c@ntentsinfo{#1}{\contentsindenttwo}{\contentspoemtitlefont}%
{\contentsindentthreeamount}%
\t@xtnotesinfo{#1}%
}
\newcommand{\poemsectiontitlefirstline}[1]{%
\firstlinesettings
\set@p@emtitle{#1}{\multilinetitlepenalty}{\subsectiontitlefont}%
{\titleindent}{\nobreak\par\nobreak}{\titleindentamount}%
\c@ntentsinfo{#1}{\contentsindenttwo}{\contentspoemtitlefont}%
{\contentsindentthreeamount}%
\t@xtnotesinfo{#1}%
\restoresinglelinesettings
}
\newcommand{\poemsectiontitlemiddleline}[1]{%
\middlelinesettings
\set@p@emtitle{#1}{\relax}{\subsectiontitlefont}%
{\titleindent}{\nobreak\par\nobreak}{\titleindentamount}%
\c@ntentsinfo{#1}{\contentsindentthree}{\contentspoemtitlefont}%
{\contentsindentfouramount}%
\t@xtnotesinfo{#1}%
\restoresinglelinesettings
}
\newcommand{\poemsectiontitlelastline}[1]{%
\lastlinesettings
\set@p@emtitle{#1}{\par\nobreak}{\subsectiontitlefont}%
{\titleindent}{\nobreak\par\afterpoemtitleskip\nobreak}%
{\titleindentamount}%
\c@ntentsinfo{#1}{\contentsindentthree}{\contentspoemtitlefont}%
{\contentsindentfouramount}%
\t@xtnotesinfo{#1}%
\restoresinglelinesettings
}
\newcommand{\poemsectiontitlenocontents}[1]{%
  \sequencesubsectiontitlenocontents{#1}}%
\newcommand{\poemfirstsectiontitle}[1]{%
\set@p@emtitle{#1}{\par\nobreak}{\subsectiontitlefont}%
{\titleindent}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}%
{\titleindentamount}%
\c@ntentsinfo{#1}{\contentsindenttwo}{\contentspoemtitlefont}%
{\contentsindentthreeamount}%
\t@xtnotesinfo{#1}%
}
\newcommand{\poemfirstsectiontitlebaretitle}[1]{%
\set@p@emtitle{#1}{\par\nobreak}{\subsectiontitlefont}%
{\titleindent}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}%
{\titleindentamount}}
\newcommand{\poemsectiontitlebaretitle}[1]{%
\set@p@emtitle{#1}{\poemtitlepenalty}{\subsectiontitlefont}%
{\titleindent}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}%
{\titleindentamount}%
}
\newcommand{\poemsubsectiontitle}[1]{%
\set@p@emtitle{#1}{\poemtitlepenalty}{\subsectiontitlefont}%
{\titleindent\titleindent}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}%
{\titleindenttwoamount}%
\c@ntentsinfo{#1}{\contentsindentthree}{\contentspoemtitlefont}%
{\contentsindentfouramount}%
\t@xtnotesinfo{#1}%
}
\newcommand{\poemtitlenotitle}[1]{%
\m@kep@emlabel
\m@ken@teholder{#1}%
\c@ntentsinfo{#1}{\contentsindentone}{\contentspoemtitlefont}%
{\contentsindenttwoamount}%
\t@xtnotesinfo{#1}%
}
\newcommand{\poemtitlenotitleitalic}[2]{%
\poemtitlenotitle{1}}
\newcommand{\sequencetitle}[1]{
\set@p@emtitle{#1}{\sequencetitlepenalty}{\sequencetitlefont}
{\relax}{\nobreak\par\nobreak\aftersequencetitleskip\nobreak}{\z@}
\putpagenumberincontentsfalse
\c@ntentsinfo{#1}{\contentsindentone}{\contentssequencetitlefont}
{\contentsindenttwoamount}
\putpagenumberincontentstrue
\t@xtnotesinfo{#1}
}

\newcommand{\sequencetitlefirstline}[1]{
\firstlinesettings
\set@p@emtitle{#1}{\multilinesequencepenalty}{\sequencetitlefont}
{\relax}{\nobreak\par\nobreak}{\z@}
\c@ntentsinfo{#1}{\contentsindentone}{\contentssequencetitlefont}
{\contentsindenttwoamount}
\t@xtnotesinfo{#1}
\restoresinglelinesettings
}
\newcommand{\sequencetitlemiddleline}[1]{
\middlelinesettings
\set@p@emtitle{#1}{\par\nobreak}{\sequencetitlefont}
{\relax}{\nobreak\par\nobreak}{\z@}
\c@ntentsinfo{#1}{\contentsindenttwo}{\contentssequencetitlefont}
{\contentsindentthreeamount}
\t@xtnotesinfo{#1}
\restoresinglelinesettings
}
\newcommand{\sequencetitlelastline}[1]{
\lastlinesettings
\set@p@emtitle{#1}{\par\nobreak}{\sequencetitlefont}
{\relax}{\nobreak\par\aftersequencetitleskip\nobreak}{\z@}
\c@ntentsinfo{#1}{\contentsindenttwo}{\contentssequencetitlefont}
{\contentsindentthreeamount}
\t@xtnotesinfo{#1}
\restoresinglelinesettings
}
\newcommand{\sequencesectiontitle}[1]{
\set@p@emtitle{#1}{\poemtitlepenalty}{\poemtitlefont}
{\titleindent}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}
{\titleindentamount}
\c@ntentsinfo{#1}{\contentsindenttwo}{\contentspoemtitlefont}
{\contentsindentthreeamount}
\t@xtnotesinfo{#1}
}

\newcommand{\sequencefirstsectiontitle}[1]{
\set@p@emtitle{#1}{\par\nobreak\afterpoemtitleskip}{\poemtitlefont}
{\titleindent}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}
{\titleindentamount}
\c@ntentsinfo{#1}{\contentsindenttwo}{\contentspoemtitlefont}
{\contentsindentthreeamount}
\t@xtnotesinfo{#1}
}
\newcommand{\sequencetitlenonotes}[1]{
\set@p@emtitle{#1}{\par\nobreak}{\sequencetitlefont}
{\relax}{\nobreak\par\aftersequencetitleskip\nobreak}{\z@}
\c@ntentsinfo{#1}{\contentsindenttwo}{\contentssequencetitlefont}
{\contentsindentthreeamount}
}
\newcommand{\sequencesectiontitlenonotes}[1]{
\set@p@emtitle{#1}{\poemtitlepenalty}{\poemtitlefont}
{\titleindent}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}
{\titleindentamount}
\c@ntentsinfo{#1}{\contentsindenttwo}{\contentspoemtitlefont}
{\contentsindentthreeamount}
}
\newcommand{\sequencesectiontitlefirstline}[1]{
\firstlinesettings
\set@p@emtitle{#1}{\multilinetitlepenalty}{\poemtitlefont}
{\titleindent}{\nobreak\par\nobreak}{\titleindentamount}
\c@ntentsinfo{#1}{\contentsindenttwo}{\contentspoemtitlefont}
{\contentsindentthreeamount}
\t@xtnotesinfo{#1}
\restoresinglelinesettings
}
\newcommand{\sequencesectiontitlemiddleline}[1]{
\middlelinesettings
\set@p@emtitle{#1}{\par\nobreak}{\poemtitlefont}
{\titleindent}{\nobreak\par\nobreak}{\titleindentamount}
\c@ntentsinfo{#1}{\contentsindentthree}{\contentspoemtitlefont}
{\contentsindentfouramount}
\t@xtnotesinfo{#1}
\restoresinglelinesettings
}
\newcommand{\sequencesectiontitlelastline}[1]{
\lastlinesettings
\set@p@emtitle{#1}{\par\nobreak}{\poemtitlefont}
{\titleindent}{\nobreak\par\afterpoemtitleskip\nobreak}{\titleindentamount}
\c@ntentsinfo{#1}{\contentsindentthree}{\contentspoemtitlefont}
{\contentsindentfouramount}
\t@xtnotesinfo{#1}
\restoresinglelinesettings
}
\newcommand{\sequencefirstsectiontitlenocontents}[2]{
\set@p@emtitle{#1}{\par\nobreak\afterpoemtitleskip}{\poemtitlefont}
{\titleindent}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}
{\titleindentamount}
\t@xtnotesinfo{#1}
}
\newcommand{\sequencesectiontitlenocontents}[2]{
\set@p@emtitle{#1}{\poemtitlepenalty}{\poemtitlefont}
{\titleindent}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}
{\titleindentamount}
\t@xtnotesinfo{#1}
}
\newcommand{\sequencefirstsectiontitlefirstline}[1]{
\firstlinesettings
\set@p@emtitle{#1}{\par\nobreak\afterpoemtitleskip}{\poemtitlefont}
{\titleindent}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}
{\titleindentamount}
\c@ntentsinfo{#1}{\contentsindenttwo}{\contentspoemtitlefont}
{\contentsindentthreeamount}
\t@xtnotesinfo{#1}
\restoresinglelinesettings
}
\newcommand{\sequencefirstsectiontitlemiddleline}[1]{
\sequencesectiontitlemiddleline{#1}}

\newcommand{\sequencefirstsectiontitlelastline}[1]
{\sequencesectiontitlelastline{#1}}

\newcommand{\sequencefirstsectiontitlenonotes}[1]{
\set@p@emtitle{#1}{\par\nobreak\afterpoemtitleskip}{\poemtitlefont}
{\titleindent}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}
{\titleindentamount}
\c@ntentsinfo{#1}{\contentsindenttwo}{\contentspoemtitlefont}
{\contentsindentthreeamount}
}

\newcommand{\sequencesectionsubtitle}[1]{{\subsectiontitlefont \hbox{\titleindent #1}}
  \nobreak\par\nobreak\afterpoemtitleskip\nobreak
}
\newcommand{\poemsubtitle}[1]{\sequencesectionsubtitle{#1}
}
\newcommand{\sequencesectiontitleitalicnonotes}[2]
{\sequencesectiontitlenonotes{#1}
}
\newcommand{\sequencesectiontitleitalic}[2]{
\sequencesectiontitle{#1}}
\newcommand{\sequencesectiontitlefirstlineitalic}[2]
{\sequencesectiontitlefirstline{#1}}
\newcommand{\sequencesectiontitlebaretitle}[1]{
\set@p@emtitle{#1}{\poemtitlepenalty}{\poemtitlefont}
{\titleindent}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}{\titleindentamount}
}


\newcommand{\sequencesubsectiontitle}[1]{
\set@p@emtitle{#1}{\poemtitlepenalty}{\subsectiontitlefont}
{\titleindent\titleindent}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}
{\titleindenttwoamount}
\c@ntentsinfo{#1}{\contentsindentthree}{\contentspoemtitlefont}
{\contentsindentfouramount}
\t@xtnotesinfo{#1}
}
\newcommand{\sequencesubsectiontitlenocontents}[1]{
\set@p@emtitle{#1}{\poemtitlepenalty}{\subsectiontitlefont}
{\titleindent\titleindent}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}
{\titleindenttwoamount}
\t@xtnotesinfo{#1}
}
\newcommand{\sequencefirstsubsectiontitle}[1]
{\set@p@emtitle{#1}{\par\nobreak}{\subsectiontitlefont}
{\titleindent\titleindent}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}
{\titleindenttwoamount}
\c@ntentsinfo{#1}{\contentsindentthree}{\contentspoemtitlefont}
{\contentsindentfouramount}
\t@xtnotesinfo{#1}
}
\newcommand{\sequencefirstsubsectiontitlenocontents}[1]
{\set@p@emtitle{#1}{\par\nobreak}{\subsectiontitlefont}
{\titleindent\titleindent}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}
{\titleindenttwoamount}
\t@xtnotesinfo{#1}
}
\newcommand{\sequencesubsectiontitlefirstline}[1]{
\firstlinesettings
\set@p@emtitle{#1}{\multilinetitlepenalty}{\subsectiontitlefont}
{\titleindent\titleindent}{\nobreak\par\nobreak}{\titleindenttwoamount}
\c@ntentsinfo{#1}{\contentsindentthree}{\contentspoemtitlefont}
{\contentsindentfouramount}
\t@xtnotesinfo{#1}
\restoresinglelinesettings
}
\newcommand{\sequencesubsectiontitlemiddleline}[1]{
\middlelinesettings
\set@p@emtitle{#1}{\nobreak}{\subsectiontitlefont}
{\titleindent\titleindent}{\nobreak\par\nobreak}{\titleindenttwoamount}
\c@ntentsinfo{#1}{\contentsindentfour}{\contentspoemtitlefont}
{\contentsindentfiveamount}
\t@xtnotesinfo{#1}
\restoresinglelinesettings
}
\newcommand{\sequencesubsectiontitlelastline}[1]{
\lastlinesettings
\set@p@emtitle{#1}{\nobreak}{\subsectiontitlefont}
{\titleindent\titleindent}{\nobreak\par\afterpoemtitleskip\nobreak}
{\titleindenttwoamount}
\c@ntentsinfo{#1}{\contentsindentfour}{\contentspoemtitlefont}
{\contentsindentfiveamount}
\t@xtnotesinfo{#1}
\restoresinglelinesettings
}
\newcommand{\sequencesubsubsectiontitle}[1]{
\set@p@emtitle{#1}{\poemtitlepenalty}{\subsectiontitlefont}
{\titleindent\titleindent\titleindent}
{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}
{\titleindentthreeamount}
\c@ntentsinfo{#1}{\contentsindentfour}{\contentspoemtitlefont}
{\contentsindentfiveamount}
\t@xtnotesinfo{#1}
}
\newcommand{\sequencesubsubsectiontitlenocontents}[1]{
\set@p@emtitle{#1}{\poemtitlepenalty}{\subsectiontitlefont}
{\titleindent\titleindent\titleindent}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}
{\titleindentthreeamount}
\t@xtnotesinfo{#1}
}
\newcommand{\sequencefirstsubsubsectiontitlenocontents}[1]{
\set@p@emtitle{#1}{\nobreak\par\nobreak}{\subsectiontitlefont}
{\titleindent\titleindent\titleindent}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}
{\titleindentthreeamount}
\t@xtnotesinfo{#1}
}

\newcommand{\sequencefirstsubsectiontitlefirstline}[1]{
\firstlinesettings
\set@p@emtitle{#1}{\par\nobreak}{\subsectiontitlefont}
{\titleindent\titleindent}{\nobreak\par\nobreak}{\titleindenttwoamount}
\c@ntentsinfo{#1}{\contentsindentthree}{\contentspoemtitlefont}
{\contentsindentfouramount}
\t@xtnotesinfo{#1}
\restoresinglelinesettings
}
\newcommand{\sequencefirstsubsectiontitlemiddleline}[1]{
\sequencesubsectiontitlemiddleline{#1}}
\newcommand{\sequencefirstsubsectiontitlelastline}[1]{
\sequencesubsectiontitlelastline{#1}}

\newcommand{\interjectiontitlefirstline}[1]{
\sequencefirstsubsectiontitlefirstline{#1}}
\newcommand{\interjectiontitlelastline}[1]{
\sequencefirstsubsectiontitlelastline{#1}
}
\newcommand{\interjectiontitlemiddleline}[1]{
\sequencefirstsubsectionmiddleline{#1}
}
\newcommand{\setmargpoemtitle}[2]{%
\set@margp@emtitle{#1}{\poemtitlepenalty}{\poemtitlefont}%
{\relax}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}{\z@}{#2}%
\c@ntentsinfo{#1}{\contentsindentone}{\contentspoemtitlefont}%
{\contentsindenttwoamount}%
\t@xtnotesinfo{#1}%
\sources{\label{#2}}%
}
\newcommand{\set@margp@emtitle}[7]{\setlength{\titleentryoverrun}{#6}%
{#2}%
{#3 \begin{titleentryenvironment}%
{#4 #1 #7}\end{titleentryenvironment}}%
{#5}%
\m@kep@emlabel%
\m@ken@teholder{#1}%
\setlength{\titleentryoverrun}{\z@}}
\newcommand{\JHpoemtitle}[2]{%
\set@margp@emtitle{#1}{\poemtitlepenalty}{\poemtitlefont}%
{\relax}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}{\z@}%
{\JHlabel{#2}}%
\c@ntentsinfo{#1}{\contentsindentone}{\contentspoemtitlefont}%
{\contentsindenttwoamount}%
\t@xtnotesinfo{#1}%
\sources{\label{#2}}%
}
\newcommand{\JHprosesectiontitle}[2]{%
\set@margp@emtitle{#1}{\poemtitlepenalty}{\poemtitlefont}%
{\relax}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}{\z@}%
{\JHlabel{#2}}%
\c@ntentsinfo{#1}{\contentsindentone}{\contentspoemtitlefont}%
{\contentsindenttwoamount}%
\t@xtnotesinfo{#1}%
\sources{\label{#2}}%
}
\newcommand{\JHlabel}[1]{%
\marginpar{{\scriptsize{\the\margrefmarker~p.~\pageref{#1}}}}}
\newcommand{\JHsequencetitle}[2]{%
\set@margp@emtitle{#1}{\sequencetitlepenalty}{\sequencetitlefont}%
{\relax}{\nobreak\par\nobreak\aftersequencetitleskip\nobreak}{\z@}%
{\JHlabel{#2}}%
\putpagenumberincontentsfalse%
\c@ntentsinfo{#1}{\contentsindentone}{\contentssequencetitlefont}%
{\contentsindenttwoamount}%
\putpagenumberincontentstrue%
\t@xtnotesinfo{#1}%
\sources{\label{#2}}%
}
\newcommand{\JHsequencesectiontitle}[2]{%
\set@margp@emtitle{#1}{\poemtitlepenalty}{\poemtitlefont}%
{\titleindent}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}%
{\titleindentamount}{\JHlabel{#2}}%
\c@ntentsinfo{#1}{\contentsindenttwo}{\contentspoemtitlefont}%
{\contentsindentthreeamount}%
\t@xtnotesinfo{#1}%
\sources{\label{#2}}%
}
\newcommand{\JHsequencefirstsectiontitle}[2]{%
\set@margp@emtitle{#1}{\par\nobreak\afterpoemtitleskip}{\poemtitlefont}%
{\titleindent}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}%
{\titleindentamount}{\JHlabel{#2}}%
\c@ntentsinfo{#1}{\contentsindenttwo}{\contentspoemtitlefont}%
{\contentsindentthreeamount}%
\t@xtnotesinfo{#1}%
\sources{\label{#2}}%
}
\newcommand{\JHpoemsectiontitle}[2]{%
\set@margp@emtitle{#1}{\poemtitlepenalty}{\subsectiontitlefont}%
{\titleindent}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}%
{\titleindentamount}{\JHlabel{#2}}%
\c@ntentsinfo{#1}{\contentsindenttwo}{\contentspoemtitlefont}%
{\contentsindentthreeamount}%
\t@xtnotesinfo{#1}%
\sources{\label{#2}}%
}
\newcommand{\JHpoemfirstsectiontitle}[2]{%
\set@margp@emtitle{#1}{\par\nobreak}{\subsectiontitlefont}%
{\titleindent}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}%
{\titleindentamount}{\JHlabel{#2}}%
\c@ntentsinfo{#1}{\contentsindenttwo}{\contentspoemtitlefont}%
{\contentsindentthreeamount}%
\t@xtnotesinfo{#1}%
\sources{\label{#2}}%
}
\newcommand{\JHsequencesectionsubtitle}[2]{%
\set@margp@emtitle{#1}{\par\nobreak}{\subsectiontitlefont}%
{\titleindent}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}%
{\titleindentamount}{\JHlabel{#2}}%
\sources{\label{#2}}%
}
\newcommand{\JHpoemsubtitle}[2]{\JHsequencesectionsubtitle{#1}{#2}
}
\newcommand{\JHdedication}[2]{\nopagebreak\afterpoemtitleskip\begin{epigraphquote}%
\emph{#1}\JHlabel{#2}\end{epigraphquote}%
\sources{\label{#2}}\afterpoemtitleskip\nopagebreak}
\newcommand{\JHepigraph}[2]{\nopagebreak\afterpoemtitleskip\begin{epigraphquote}%
\emph{#1}\JHlabel{#2}\end{epigraphquote}%
\sources{\label{#2}}\afterpoemtitleskip\nopagebreak}
\newcommand{\backmattersectiontitle}[1]{%
\set@p@emtitle{#1}{\poemtitlepenalty}{\volumetitlefont}%
{\relax}{\backmattersink}{\z@}%
\c@ntentsinfo{#1}{contentsindentone}{\contentspoemtitlefont}%
{\contentsindenttwoamount}%
\t@xtnotesinfo{#1}
}
\newcounter{margrefnumber}
\setcounter{margrefnumber}{1}
\newtoks{\margrefmarker}
\margrefmarker={\dag}
\newcommand{\setmargrefmarker}[1]{\margrefmarker={#1}}
\newcommand{\makemargreflabel}{\string\label\string{margref\themargrefnumber\string}}
\newcommand{\setmargref}
{\marginpar{\scriptsize {\the\margrefmarker~p.~\pageref{margref\themargrefnumber}}}
}
\newcommand{\margreftextnote}{%
\iftextnoteson\addtocounter{margrefnumber}{1}%
\immediate\write\textnotes{\makemargreflabel}%
\setmargref\else\relax\fi%
}
\newcommand{\margrefexplanatory}{%
\ifexplanon\addtocounter{margrefnumber}{1}%
\immediate\write\explanations{\makemargreflabel}%
\setmargref\else\relax\fi%
}
\newcommand{\margrefemendation}{%
\ifemendationson\addtocounter{margrefnumber}{1}%
\immediate\write\emendations{\makemargreflabel}%
\setmargref\else\relax\fi%
}
\newcommand{\margrefspecial}[1]{%
\marginpar{\scriptsize {\the\margrefmarker~p.~\pageref{#1}}}
}
\newcommand{\epigraph}[1]{\nopagebreak\afterpoemtitleskip\begin{epigraphquote}
  \emph{#1}\end{epigraphquote}\afterpoemtitleskip\nopagebreak}
\newcommand{\headnote}[1]{\epigraph{#1}}
\newcommand{\attribution}[1]{\nopagebreak\afterpoemtitleskip\begin{epigraphquote}
 {\small\emph{#1}}\end{epigraphquote}\afterpoemtitleskip\nopagebreak}
\newcommand{\poemdedication}[1]{\nopagebreak\afterpoemtitleskip\begin{epigraphquote}
 \emph{#1}\end{epigraphquote}\afterpoemtitleskip\nopagebreak}
\providecommand{\dedication}[1]{\poemdedication{#1}}
\newcommand{\volumededication}[1]{\par\bigskip\begin{volumetitlepagequote}
  \emph{#1}\end{volumetitlepagequote}}
\newcommand{\volumeepigraph}[1]{\par\bigskip\begin{volumetitlepagequote}
  \emph{#1}\end{volumetitlepagequote}}
\newcommand{\volumeattribution}[1]{\par\smallskip\begin{volumetitlepagequote}
 {\small \emph{#1}}\end{volumetitlepagequote}}
\def\strip#1>{}
\newcommand{\literaltextnote}[1]{\iftextnotesatend
     \begingroup
        \def\next{#1}%
        \newlinechar='40
        \immediate\write\textnotes{\expandafter\strip\meaning\next}%
     \endgroup\fi
 }
\newcommand{\literalemend}[1]{\ifemendationsatend
     \begingroup
        \def\next{#1}%
        \newlinechar='40
        \immediate\write\emendations{\expandafter\strip\meaning\next}%
     \endgroup\fi
}
\newcommand{\literalexplain}[1]{\ifexplanatend
     \begingroup
        \def\next{#1}%
        \newlinechar='40
        \immediate\write\explanations{\expandafter\strip\meaning\next}%
     \endgroup\fi
}
\newcommand{\literalcontents}[1]{\ifpoemcontentson
     \begingroup
        \def\next{#1}%
        \newlinechar='40
        \immediate\write\poemcontents{\expandafter\strip\meaning\next}%
     \endgroup\fi
}
\newcommand{\literaltextnoteshort}[1]{
\iftextnotesatend
        \begingroup
        \def\next{#1}%
        \immediate\write\textnotes{\expandafter\strip\meaning\next}%
     \endgroup\fi}
\newcommand{\literalemendshort}[1]{\ifemendationsatend
        \begingroup
        \def\next{#1}%
        \immediate\write\emendations{\expandafter\strip\meaning\next}%
     \endgroup\fi}
\newcommand{\literalexplainshort}[1]{\ifexplanatend
        \begingroup
        \def\next{#1}%
        \immediate\write\explanations{\expandafter\strip\meaning\next}%
     \endgroup\fi}
\newcommand{\literalcontentsshort}[1]{\ifpoemcontentson
        \begingroup
        \immediate\write\poemcontents{\expandafter\strip\meaning\next}%
     \endgroup\fi}
\newcommand{\sameword}{$\sim$}
\newcommand{\missingpunct}{${}_{\wedge}$}
\newcommand{\pmccheckifinteger}[1]{%
  \protected@edef\@vsa{#1}%
  \ifcat _\ifnum9<1\pmcgobm{#1} _\else A\fi
    \integertrue%
  \else
    \integerfalse%
  \fi%
}
\newif\ifinteger
\newcommand{\pmcgobm}[1]{#1}
\newcommand{\setlemmarange}[1]{%
\pmccheckifinteger{#1}%
\ifinteger
\setcounter{lemmalines}{#1}%
\ifthenelse{\equal{\value{lemmalines}}{0}}{\rangelemmafalse}{\rangelemmatrue}%
\setcounter{lemmaend}{\theverselinenumber}%
\addtocounter{lemmaend}{\thelemmalines}%
\else
\setcounterfromref{lemmaend}{#1}\rangelemmatrue
\fi
\makeatother}
\newcommand{\citerange}{%
\ifrangelemma
\theverselinenumber --\thelemmaend
\else
\theverselinenumber
\fi}
\newcommand{\resetlemmacounters}{\rangelemmafalse
\setcounter{lemmalines}{0}%
\setcounter{lemmaend}{0}%
}
\newcommand{\checknoteheaders}{\string\setcounter\string{notepageholdernote\string}%
\string{\thepage\string}\string\ifhmode\string\unskip\string\fi%
\string\ifthenelse\string{\string\value\string{notepageholdernote\string}>%
\string\value\string{notepageholdertitle\string}\string}%
\string{\string\mark\string{\string\thenotepageholdernote\string}\string}%
\string{\string\mark\string{\string\thenotepageholdertitle\string}\string}\string\unskip
\string\unskip\string\relax\ \citerange :\string~\string\nolinebreak}%

\newif\iftextnotessinglepar
\newcommand{\textnote}[2][0]{%
\iftextnoteson
    \setlemmarange{#1}%
\immediate\write\textnotes{\checknoteheaders}%
    \literaltextnote{#2}%
    \iftextnotessinglepar%
    \literaltextnote{\par}%
    \fi%
    \fi
\resetlemmacounters
}
\newcommand{\accidental}[1]{%
\iftextnoteson%
 \ifincludeaccidentals%
   \iftextnotesatend\immediate\write\textnotes{\string\nobreak}\fi%
\textnote{#1}%
\iftextnotesatend\immediate\write\textnotes{\string\nobreak}\fi%
    \iftextnotessinglepar%
    \literaltextnote{\par}%
    \fi%
 \fi\fi
}
\newcommand{\tsvariant}[2][0]{%
\iftextnoteson
 \ifincludetypescripts%
 \iftextnotesatend\immediate\write\textnotes{\string\nobreak}\fi%
\textnote[#1]{#2}%
\iftextnotesatend\immediate\write\textnotes{\string\nobreak}\fi%
  \fi\fi
}
\newcommand{\tsaccidental}[1]{\iftextnoteson\ifincludetypescripts\accidental{#1}\fi\fi}
\newcommand{\tsentry}[1]{\iftextnoteson\ifincludetypescripts{\@ifnextchar,{\unskip}{%
\@ifnextchar;{\unskip}{}%
}#1}\fi\fi\unskip}
\newcommand{\sources}[1]{%
\iftextnoteson
    \begingroup
        \newlinechar='40
        \def\next{#1}%
        \immediate\write\textnotes{\expandafter\strip\meaning\next}%
     \endgroup
    \iftextnotessinglepar%
    \literaltextnote{\par}%
    \fi%
 \fi
}
\newcommand{\titletoothernotes}{\string\par
\ifputpagenumberinnotes%
\string\argpageref\string{\@compoundlabelscratch\string}%
\string\setcounterfrompageref\string{notepageholdertitle\string}%
\string{\@compoundlabelscratch\string}%
\fi%
\string\textbf\string{\ \the\fulltitleholder\string}}%
\newif\ifemendationssinglepar
\newcommand{\emendation}[2][0]{
\ifemendationson
    \setlemmarange{#1}%
    \ifredundantemendations
       \iftextnoteson
 \ifrangelemma
     \textnote[#1]{#2}%
 \else
     \textnote{#2}%
 \fi % ifrangelemma}
    \iftextnotessinglepar%
    \literaltextnote{\par}%
    \fi% iftextnotesinglepar
       \fi %iftextnoteson
   \fi % ifredundantemendations
    \ifnoemendyet % firstemendation
     \firstemendation
      \fi %noemendyet
      \global\noemendyetfalse
\immediate\write\emendations{\checknoteheaders}%
    \literalemend{#2}%
    \ifemendationssinglepar%
    \literalemend{\par}%
    \fi% ifemendationssinglepar
\fi % ifemendationson
\resetlemmacounters
}
\newcommand{\firstemendation}{\ifemendationsatend
\immediate\write\emendations{\titletoothernotes}\fi
}
\newif\ifexplanationssinglepar
\newcommand{\explanatory}[2][0]{%
\ifexplanon
    \setlemmarange{#1}%
    \ifnoexplainyet % first explanation
    \firstexplanatory
      \fi %noexplainyet
      \global\noexplainyetfalse
\immediate\write\explanations{\checknoteheaders}%
    \literalexplain{#2}%
    \ifexplanationssinglepar%
    \literalexplain{\par}%
    \fi%
    \fi % ifexplanon
\resetlemmacounters
}

\newcommand{\firstexplanatory}{\ifexplanatend
\immediate\write\explanations{\titletoothernotes}\fi
}

\makeatletter
\long\def\appendtomacro#1#2{%
\begingroup
    \toks@\expandafter{#1#2}%
    \xdef#1{\the\toks@}%
  \endgroup}
\makeatother
\newcommand{\definenewnotetype}[5]{%
\expandafter\newif\csname if#1son\endcsname
\global\csname #1sontrue\endcsname
\expandafter\newif\csname ifno#1yet\endcsname
\csname no#1yettrue\endcsname
\expandafter\newif\csname if#1ssinglepar\endcsname
\csname #1singleparfalse\endcsname
\expandafter\newif\csname if#1stwocol\endcsname
\csname #1stwocolfalse\endcsname
\expandafter\newwrite\csname #1s\endcsname
\immediate\expandafter\openout\csname #1s\endcsname=\expandafter\jobname .#2
 \expandafter\newcommand\csname literal#1\endcsname[1]{
\begingroup
\def\next{##1}%
\newlinechar='40
\immediate\write\expandafter\csname #1s\endcsname{\expandafter\strip\meaning\next}%
\endgroup}
\csname literal#1\endcsname{\flushbottom{\par\clearpage
  {\pagestyle{volumetitlestyle}\cleardoublepage}
\thispagestyle{volumetitlestyle}}
\fancyhead{}
\fancyfoot{}
\fancyhead[RO,LE]{{\small\textrm{\thepage}}}}
\immediate\write\csname #1s\endcsname{\string\fancyhead[CO]\string{\string{\string\small
\string{\string\em\ #3\string~\string\mymarks\string}\string}\string}}
\immediate\write\csname #1s\endcsname{\string\fancyhead[CE]\string{\string{\string\small
\string{\string\em\ #3\string~\string\mymarks\string}\string}\string}}
\csname literal#1\endcsname{\fancyfoot[C]{}
\mark{3}
\backmattersink}
\immediate\write\csname #1s\endcsname{
\string\setendnotessectiontitle\string{#4\string}\string{#1notes\string}}
\csname literal#1\endcsname{\lefthyphenmin=2\backmatterafterheadersink
\tolerance=500\language=0
\normalfont \backmattertextfont}
\immediate\write\csname #1s\endcsname{\string\if#1stwocol}
\csname
literal#1\endcsname{\begin{multicols}{2}\fi\setlength{\parindent}{-10pt}}%
\expandafter\newcommand\csname first#1\endcsname{%
\immediate\write\expandafter\csname #1s\endcsname{\titletoothernotes}%
\immediate\write\csname #1s\endcsname{\string\if#1ssinglepar}%
\immediate\write\csname #1s\endcsname{\string\par}%
\immediate\write\csname #1s\endcsname{\string\fi}%
}
\expandafter\newcommand\csname #1\endcsname[2][0]{%
\setlemmarange{##1}%
\csname ifno#1yet\endcsname%
 \csname first#1\endcsname%
 \fi%
\global\csname no#1yetfalse\endcsname%
\immediate\write\expandafter\csname
#1s\endcsname{\string\nobreak\string\nobreak\checknoteheaders}%
\csname literal#1\endcsname{##2}%
\csname if#1ssinglepar\endcsname%
\csname literal#1\endcsname{\par}%
\fi%
\resetlemmacounters%
}
\expandafter\newcommand\csname prose#1\endcsname[3][0]{%
\unskip\proselinelabel{##2}%
\setproselemmarange{##2}{##1}%
\csname ifno#1yet\endcsname%
\csname first#1\endcsname%
\fi%
\global\csname no#1yetfalse\endcsname%
\immediate\write\expandafter\csname #1s\endcsname{\checkprosenoteheaders}%
\csname literal#1\endcsname{##3}%
\csname if#1ssinglepar\endcsname%
\csname literal#1\endcsname{\par}%
\unskip%
\fi%
\resetlemmacounters\unskip%
}
\expandafter\newcommand\csname pm#1\endcsname[2][0]{%
     \setpmlemmarange{##1}%
     \csname ifno#1yet\endcsname%
     \csname first#1\endcsname%
     \fi%
\global\csname no#1yetfalse\endcsname%
\immediate\write\expandafter\csname #1s\endcsname{\pmchecknoteheaders\string~}%
\immediate\write\expandafter\csname #1s\endcsname{\pmciterange}%
\csname literal#1\endcsname{##2}%
\csname if#1ssinglepar\endcsname%
\csname literal#1\endcsname{\par}%
\fi%
\pmresetlemmacounters\unskip%
}
\makeatletter
\appendtomacro{\endpoem}{\global\expandafter\csname no#1yettrue\endcsname}
\makeatother
\makeatletter
\appendtomacro{\endprosesection}{\global\expandafter\csname no#1yettrue\endcsname}
\makeatother
\makeatletter
\appendtomacro{\endpmsection}{\global\expandafter\csname no#1yettrue\endcsname}
\makeatother

\expandafter\newcommand\csname put#1s\endcsname{
\newpage\hyphenationforsmall
\csname if#1stwocol\endcsname%
\csname literal#1\endcsname{\end{multicols}}%
\fi %\iftwocol
\immediate\expandafter\closeout\csname #1s\endcsname
\expandafter\input \jobname.#2
\ifpoemcontentson
 \contentsendnotestitle{#5}{#1notes}
\fi
  }
\expandafter\newcommand\csname margref#1\endcsname{%
\addtocounter{margrefnumber}{1}
\immediate\write\expandafter\csname #1s\endcsname{\makemargreflabel}%
\setmargref
}
}
\newcounter{proselinenumber}
\setcounter{proselinenumber}{1}
\newcounter{prosemodulo}
\setcounter{prosemodulo}{\value{lineindexrepeat}}
\addtocounter{prosemodulo}{1}
\newcommand{\setprosemodulo}[1]{\modulolinenumbers[#1]}
\newcommand{\prosesectiontitle}[1]{\poemtitle{#1}}
\newcommand{\prosesectiontitlenotitle}[1]{\poemtitlenotitle{#1}}
\setcounter{prosemodulo}{\value{lineindexrepeat}}%
\addtocounter{prosemodulo}{1}%
\ifx\modulolinenumbers\undefined%
 \relax\else
\modulolinenumbers[\value{prosemodulo}]% if lineno is called
\fi
\newif\ifinprosesection
\newenvironment{prosesection}
{\inprosesectiontrue\resetlinenumber\begin{linenumbers}%
\renewcommand{\linenumberfont}{\scriptsize}%
\ifnumbersright\rightlinenumbers*\setlength{\linenumbersep}{-\marginparsep}%
\else\ifnumbersswitch\rightlinenumbers*\setlength{\linenumbersep}{-\marginparsep}%
\else\leftlinenumbers*\setlength{\linenumbersep}{\marginparsep}%
\addtolength{\linenumbersep}{5pt}% seems about right
\fi\fi
\noemendyettrue%
\noexplainyettrue%
}
{\end{linenumbers}\inprosesectionfalse}
\newenvironment{prosesectionnoreset}
{\begin{linenumbers}%
\renewcommand{\linenumberfont}{\scriptsize}
\ifnumbersright\rightlinenumbers*\setlength{\linenumbersep}{-\marginparsep}%
\else\ifnumbersswitch\rightlinenumbers*\setlength{\linenumbersep}{-\marginparsep}%
\else\leftlinenumbers*\setlength{\linenumbersep}{\marginparsep}%
\addtolength{\linenumbersep}{5pt}% seems about right
\fi\fi
}{\end{linenumbers}}
\makeatletter
\newcommand*{\ifrefundefined}[1]{%
  \expandafter\ifx\csname r@#1\endcsname\relax
    \expandafter\@firstoftwo
  \else
    \expandafter\@secondoftwo
  \fi
}
\newcommand*{\@extract@ref}[2]{%
  \expandafter\expandafter\expandafter#1\csname
r@#2\endcsname{}{}\@nil
}

\newcommand*{\@extractref}{%
  \@extract@ref\@car
}

\newcommand*{\@extractpageref}{%
  \@extract@ref\@secondcar
}

\long\def\@secondcar#1#2#3\@nil{#2}

\newcommand*{\setcounterfromref}[2]{%
  \ifrefundefined{#2}{%
    \protect\G@refundefinedtrue
    \@latex@warning{Reference `#2' on page \thepage \space
        undefined}%
    \setcounter{#1}{0}%
  }{%
    \setcounter{#1}{\@extractref{#2}}%
  }%
}
\newcommand*{\setcounterfrompageref}[2]{%
  \ifrefundefined{#2}{%
    \protect\G@refundefinedtrue
    \@latex@warning{Reference `#2' on page \thepage \space
        undefined}%
    \setcounter{#1}{0}%
  }{%
    \setcounter{#1}{\@extractpageref{#2}}%
  }%
}
\makeatother
\newcommand{\setproselemmastart}[1]{%
\unskip
\setcounterfromref{proselinenumber}{#1}}
\newcommand{\setproselemmarange}[2]{%
\setproselemmastart{#1}%
\pmccheckifinteger{#2}%
\ifinteger
\setcounter{lemmalines}{#2}%
\ifthenelse{\equal{\value{lemmalines}}{0}}{\rangelemmafalse}{\rangelemmatrue}%
\setcounter{lemmaend}{\theproselinenumber}%
\addtocounter{lemmaend}{\thelemmalines}\unskip%
\else
\setcounterfromref{lemmaend}{#2}\rangelemmatrue
\fi\unskip
}
\newcommand{\proseciterange}{%
\ifrangelemma%
\theproselinenumber --\thelemmaend%
\else%
\theproselinenumber%
\fi}
\newcommand{\checkprosenoteheaders}{\string\setcounter\string{notepageholdernote\string}%
\string{\thepage\string}\string\ifhmode\string\unskip\string\fi
\string\ifthenelse\string{\string\value\string{notepageholdernote\string}>
\string\value\string{notepageholdertitle\string}\string}%
\string{\string\mark\string{\string\thenotepageholdernote\string}\string}%
\string{\string\mark\string{\string\thenotepageholdertitle\string}\string}\string\unskip
\string\unskip\string\relax\ \proseciterange :\string~\string\nolinebreak}%
\newcommand{\proselinelabel}[1]{\ifhmode\unskip\fi\linelabel{#1}}
\newcommand{\prosetextnote}[3][0]{%
\iftextnoteson%
\unskip\proselinelabel{#2}%
\setproselemmarange{#2}{#1}%
\immediate\write\textnotes{\checkprosenoteheaders}%
\literaltextnote{#3}%
\iftextnotessinglepar%
\literaltextnote{\par}%
\fi%
\resetlemmacounters%
\fi\unskip%
}
\newcommand{\proseemendation}[3][0]{%
\ifemendationson%
\unskip\proselinelabel{#2}%
\setproselemmarange{#2}{#1}%
    \ifredundantemendations
       \iftextnoteson
 \ifrangelemma
     \prosetextnote[#1]{#2}{#3}%
 \else
     \prosetextnote{#2}{#3}%
 \fi % ifrangelemma}
       \fi %iftextnoteson
\iftextnotessinglepar%
\literaltextnote{\par}%
\fi%  iftextnotessinglepar
   \fi % ifredundantemendations
    \ifnoemendyet % firstemendation
     \firstemendation
      \fi%noemendyet
      \global\noemendyetfalse
\immediate\write\emendations{\checkprosenoteheaders}%
    \literalemend{#3}%
\ifemendationssinglepar%
\literalemend{\par}%
\fi% ifemendationssinglep
    \resetlemmacounters%
\fi\unskip%
}
\newcommand{\proseexplanatory}[3][0]{%
\ifexplanon%
\unskip\proselinelabel{#2}%
\setproselemmarange{#2}{#1}%
    \ifnoexplainyet% firstexplanation
     \firstexplanatory%
      \fi%noexplainyet
      \global\noexplainyetfalse%
\immediate\write\explanations{\checkprosenoteheaders}%
    \literalexplain{#3}%
\ifexplanationssinglepar%
    \literalexplain{\par}%
    \fi% ifexplanationssinglepar
    \resetlemmacounters%
\fi\unskip%
}
\newcommand{\proseaccidental}[2]{
\iftextnoteson
 \ifincludeaccidentals
    \immediate\write\textnotes{\string\nobreak}%
\prosetextnote{#1}{#2}%
\immediate\write\textnotes{\string\nobreak}%
    \iftextnotessinglepar%
    \literaltextnote{\par}%
    \fi%
\fi\fi
}
\newcommand{\prosetsvariant}[3][0]{\iftextnoteson
 \ifincludetypescripts
   \immediate\write
\textnotes{\string\nobreak}%
\prosetextnote[#1]{#2}{#3}%
\immediate\write\textnotes{\string\nobreak}%
    \iftextnotessinglepar%
    \literaltextnote{\par}%
    \fi%
\fi\fi
}
\newcommand{\prosetsaccidental}[2]{\iftextnoteson
\ifincludetypescripts\proseaccidental{#1}{#2}\fi\fi}
\newif{\ifprosebysentence}
\newif{\ifrunningsentencenumbers}\runningsentencenumberstrue
\newif{\ifmarginsentencenumbers}\marginsentencenumberstrue

\newtoks{\pmnoteheader}

\newcounter{pmsentencenumber}\setcounter{pmsentencenumber}{0}
\newcounter{pmmodulo}\setcounter{pmmodulo}{3}
\newcounter{pmindexcount}\setcounter{pmindexcount}{0}
\newcommand{\setprosebysentence}{\prosebysentencetrue%
}
\newenvironment{pmsection}{
\noemendyettrue%
\noexplainyettrue%
}{}
\newcommand{\runningsentencenumberformat}[1]{\nobreak%
\textsuperscript{\scriptsize{#1}}\unskip\nobreak}
\newcommand{\marginsentencenumberformat}[1]{\scriptsize{#1}}
\newcommand{\setpmmodulo}[1]{\setcounter{pmmodulo}{#1}%
\addtocounter{pmmodulo}{-1}%
}
\newcommand{\pmnumberstoleft}{%\catcode`\@=11%
\numbersswitchfalse\numbersrightfalse%
\setlength{\marginparsep}{18pt}%
}
\newcommand{\pmnumberstoright}{%\catcode`\@=11%
\numbersswitchfalse\numbersrighttrue%
\setlength{\marginparsep}{-18pt}
}
\newcommand{\pmnumbersswitch}{\strictpagechecktrue\numbersswitchtrue\numbersrightfalse%
\setlength{\marginparsep}{18pt}%
}
\newcommand{\pmnumbersgutter}{%\catcode`\@=11%
\pmnumbersswitch%
\pmclreversesideparfalse\numbersguttertrue%
\setlength{\marginparsep}{18pt}%
}
\newcommand{\pmnumbersouter}{%\catcode`\@=11%
\pmnumbersswitch%
\pmclreversesidepartrue\numbersgutterfalse%
\setlength{\marginparsep}{18pt}%
}
\newcommand{\putpmsentencenumber}{%
\putpmmarginnumber{\thepmsentencenumber}%
{\marginsentencenumberformat}}
\newcommand{\putpmmarginnumber}[2]{%
\nolinebreak\begin{marginenvironment}%
  \nolinebreak%
  \ifnumbersswitch%\marginpar{\hfil #2{#1}}
  \pmclsidepar{\hfil #2{#1}}%
    \else%
    \ifnumbersright%\marginpar{\hfil #2{#1}}
    \pmclrightsidepar{\hfil #2{#1}}%
      \else% \marginpar{#2{#1}\hfil}
      \pmclleftsidepar
{#2{#1}\hfil}%
      \fi%
    \fi%
  \nolinebreak%
  \end{marginenvironment}\nolinebreak%
}
\newcommand{\pmsentence}{%
\addtocounter{pmsentencenumber}{1}%
\ifrunningsentencenumbers% add running number
\runningsentencenumberformat{\thepmsentencenumber}%
\fi%
\ifmarginsentencenumbers% add marginal number
  \addtocounter{pmindexcount}{1}%
  \leavevmode%
\ifthenelse{\value{pmindexcount}>\value{pmmodulo}}%
{     \putpmsentencenumber\nobreak%
    \setcounter{pmindexcount}{0}%
}{\relax}%
\fi%
\ifpmparas%
\global\edef\noteheaderconcat{\thepmparagraph:\thepmsentencenumber}%
\pmnoteheader=\expandafter{\noteheaderconcat}%
\else%
\global\edef\noteheaderconcat{\thepmsentencenumber}
\pmnoteheader=\expandafter{\noteheaderconcat}%
\fi%
}
\newcommand{\pmsentencetwo}{%
\addtocounter{pmsentencenumber}{1}%
\ifrunningsentencenumbers% add running number
\runningsentencenumberformat{\thepmsentencenumber}%
\fi%
\ifmarginsentencenumbers% add marginal number
  \addtocounter{pmindexcount}{1}%
  \leavevmode%
\ifthenelse{\value{pmindexcount}>\value{pmmodulo}}%
{     \putpmsentencenumbertwo\nobreak%
    \setcounter{pmindexcount}{0}%
}{\relax}%
\fi%
\ifpmparas%
\global\edef\noteheaderconcat{\thepmparagraph:\thepmsentencenumber}%
\pmnoteheader=\expandafter{\noteheaderconcat}%
\else%
\global\edef\noteheaderconcat{\thepmsentencenumber}%
\pmnoteheader=\expandafter{\noteheaderconcat}%
\fi%
}

\newcommand{\putpmsentencenumbertwo}{%
\putpmmarginnumber{\rlap{\phantom{1},~\thepmsentencenumber}}%
{\marginsentencenumberformat}}
\newcommand{\pmsentencethree}{%
\addtocounter{pmsentencenumber}{1}%
\ifrunningsentencenumbers% add running number
\runningsentencenumberformat{\thepmsentencenumber}%
\fi%
\ifmarginsentencenumbers% add marginal number
  \addtocounter{pmindexcount}{1}%
  \leavevmode%
\ifthenelse{\value{pmindexcount}>\value{pmmodulo}}%
{     \putpmsentencenumberthree\nobreak%
    \setcounter{pmindexcount}{0}%
}{\relax}%
\fi%
\ifpmparas%
\global\edef\noteheaderconcat{\thepmparagraph:\thepmsentencenumber}%
\pmnoteheader=\expandafter{\noteheaderconcat}%
\else%
\global\edef\noteheaderconcat{\thepmsentencenumber}%
\pmnoteheader=\expandafter{\noteheaderconcat}%
\fi%
}

\newcommand{\putpmsentencenumberthree}{%
\putpmmarginnumber{\rlap{\phantom{1,~2},~\thepmsentencenumber}}%
{\marginsentencenumberformat}}
\newcommand{\pmsentencefour}{%
\addtocounter{pmsentencenumber}{1}%
\ifrunningsentencenumbers% add running number
\runningsentencenumberformat{\thepmsentencenumber}%
\fi%
\ifmarginsentencenumbers% add marginal number
  \addtocounter{pmindexcount}{1}%
  \leavevmode%
\ifthenelse{\value{pmindexcount}>\value{pmmodulo}}%
{     \putpmsentencenumberfour\nobreak%
    \setcounter{pmindexcount}{0}%
}{\relax}%
\fi%
\ifpmparas%
\global\edef\noteheaderconcat{\thepmparagraph:\thepmsentencenumber}%
\pmnoteheader=\expandafter{\noteheaderconcat}%
\else%
\global\edef\noteheaderconcat{\thepmsentencenumber}%
\pmnoteheader=\expandafter{\noteheaderconcat}%
\fi%
}

\newcommand{\putpmsentencenumberfour}{%
\putpmmarginnumber{\rlap{\phantom{1,~2,~3},~\thepmsentencenumber}}%
{\marginsentencenumberformat}}

\newcounter{pmparagraph}
\setcounter{pmparagraph}{0}
\newif{\ifpmparas}\pmparasfalse
\newif{\ifpmparainmar}\pmparainmartrue
\newif{\ifpmpararunning}\pmpararunningfalse
\newif{\ifpmsentencebypara}% reset sentence counter every paragraph
\pmsentencebyparatrue
\newcommand{\pmparmarformat}[1]{\textbf{{\small #1}}}
\newcommand{\pmpararunningformat}[1]{\textbf{\small #1}}
\newcommand{\putpmmarparanumber}{%
\putpmmarginnumber{\llap{\thepmparagraph~~}}{\pmparmarformat}}
\newcommand{\pmpara}{\leavevmode%
\pmparastrue\addtocounter{pmparagraph}{1}%
\ifpmparainmar% put in marginal paragraph number
   \putpmmarparanumber
\fi
\ifpmpararunning% put in running number
  \pmpararunningformat{\thepmparagraph}%
\fi
\ifpmsentencebypara% reset sentence counter
   \setcounter{pmsentencenumber}{0}%
   \setcounter{pmindexcount}{0}%
\fi}
\makeatletter
\def\sentencelabel#1{\@bsphack%
\ifpmparas%
\protected@write\@auxout{}%
 {\string\newlabel{#1}{{\thepmparagraph :\thepmsentencenumber}{\thepage}}}%
\else%
\protected@write\@auxout{}%
 {\string\newlabel{#1}{{\thepmsentencenumber}{\thepage}}}%
\fi%
\@esphack%
}
\makeatother
\newtoks{\pmrangeend} % for notes that refer to ranges
\newcommand{\setpmlemmarange}[1]{%
\pmccheckifinteger{#1}%
\ifinteger%
\setcounter{lemmalines}{#1}%
\ifthenelse{\equal{\value{lemmalines}}{0}}{\rangelemmafalse}{\rangelemmatrue}%
\setcounter{lemmaend}{\thepmsentencenumber}%
\addtocounter{lemmaend}{\thelemmalines}%
\pmrangeend={\thelemmaend}%
\else%
\pmrangeend={\ref{#1}}\rangelemmatrue%
\fi%
}
\newcommand{\pmciterange}{%
\ifrangelemma{\the\pmnoteheader --\the\pmrangeend:}%
\else%
\the\pmnoteheader:%
\fi}
\newcommand{\pmchecknoteheaders}{\string\setcounter\string{notepageholdernote\string}%
\string{\thepage\string}\string\ifhmode\string\unskip\string\fi
\string\ifthenelse\string{\string\value\string{notepageholdernote\string}>
\string\value\string{notepageholdertitle\string}\string}%
\string{\string\mark\string{\string\thenotepageholdernote\string}\string}%
\string{\string\mark\string{\string\thenotepageholdertitle\string}\string}\string\unskip}
\newcommand{\pmresetlemmacounters}{\rangelemmafalse%
\setcounter{lemmalines}{0}%
\setcounter{lemmaend}{0}%
\pmrangeend={\relax}%
}
\newcommand{\pmtextnote}[2][0]{%
\iftextnoteson%
\setpmlemmarange{#1}%
\immediate\write\textnotes{\pmchecknoteheaders\string~}%
    \immediate\write\textnotes{\pmciterange}%
    \literaltextnote{#2}%
    \iftextnotessinglepar%
    \literaltextnote{\par}%
    \fi%
    \fi%
\pmresetlemmacounters%
\unskip}
\newcommand{\pmexplanatory}[2][0]{%
\ifexplanon%
\setpmlemmarange{#1}%
    \ifnoexplainyet % first explanation
    \firstexplanatory%
      \fi %noexplainyet
      \global\noexplainyetfalse%
\immediate\write\explanations{\pmchecknoteheaders\string~}%
\immediate\write\explanations{\pmciterange}%
    \literalexplain{#2}%
    \ifexplanationssinglepar%
    \literalexplain{\par}%
    \fi %ifexplanationssinglepar
    \fi % ifexplanon
\pmresetlemmacounters%
\unskip%
}
\newcommand{\pmemendation}[2][0]{%
\ifemendationson%
    \setpmlemmarange{#1}%
    \ifredundantemendations%
       \iftextnoteson%
 \ifrangelemma%
     \pmtextnote[#1]{#2}%
 \else%
     \pmtextnote{#2}%
 \fi % ifrangelemma}
       \fi %iftextnoteson
   \fi % ifredundantemendations
    \ifnoemendyet % firstemendation
     \firstemendation%
      \fi %noemendyet
      \global\noemendyetfalse%
\immediate\write\emendations{\pmchecknoteheaders\string~}%
\immediate\write\emendations{\pmciterange}%
    \literalemend{#2}%
\ifemendationssinglepar%
    \literalemend{\par}%
    \fi% ifemendationssinglepar
    \fi % ifemendationson
\pmresetlemmacounters%
}
\newcommand{\pmaccidental}[1]{%
\iftextnoteson%
 \ifincludeaccidentals%
    \immediate\write\textnotes{\string\nobreak}%
\pmtextnote{#1}%
\immediate\write\textnotes{\string\nobreak}%
    \iftextnotessinglepar%
    \literaltextnote{\par}%
    \fi%
\fi\fi%
}
\newcommand{\pmtsvariant}[2][0]{\iftextnoteson%
 \ifincludetypescripts%
   \immediate\write\textnotes{\string\nobreak}%
\pmtextnote[#1]{#2}%
\immediate\write\textnotes{\string\nobreak}%
    \iftextnotessinglepar%
    \literaltextnote{\par}%
    \fi%
\fi\fi%
}
\newcommand{\pmtsaccidental}[1]{\iftextnoteson\ifincludetypescripts\pmaccidental{#1}\fi\fi}
\newcommand{\textnotesatfoot}{% first redefine textnotes
\global\textnotesontrue%
\global\textnotesatendfalse%
\ifsourcesfootnotespara%
\DeclareNewFootnote[para]{A}%
\else%
\DeclareNewFootnote[plain]{A}%
\fi%
\iftextfootnotespara%
\DeclareNewFootnote[para]{B}%
\else%
\DeclareNewFootnote[plain]{B}%
\fi%
\renewcommand{\textnote}[2][0]{\setlemmarange{##1}%
\FootnotetextB{\relax}{\citerange:~##2}%
\resetlemmacounters}%
\renewcommand{\sources}[1]{\FootnotetextA{\relax}{##1}}%
\renewcommand{\prosetextnote}[3][0]{%
\unskip\proselinelabel{##2}%
\setproselemmarange{##2}{##1}%
\FootnotetextB{\relax}{\proseciterange:~##3}\resetlemmacounters}%
\renewcommand{\pmtextnote}[2][0]{\setpmlemmarange{##1}%
\FootnotetextB{\relax}{\pmciterange~##2}\pmresetlemmacounters}
}
\newcommand{\emendationsatfoot}{%
\global\emendationsontrue%
\global\emendationsatendfalse%
\ifemendationfootnotespara%
\DeclareNewFootnote[para]{C}%
\else%
\DeclareNewFootnote[plain]{C}%
\fi%
\renewcommand{\emendation}[2][0]{\setlemmarange{##1}%
\FootnotetextC{\relax}{\citerange:~##2}%
\resetlemmacounters}%
\renewcommand{\proseemendation}[3][0]{\unskip\proselinelabel{##2}%
\setproselemmarange{##2}{##1}%
\FootnotetextC{\relax}{\proseciterange:~##3}\resetlemmacounters}%
\renewcommand{\pmemendation}[2][0]{\setpmlemmarange{##1}%
\FootnotetextC{\relax}{\pmciterange~##2}\pmresetlemmacounters}
}
\newcommand{\explanationsatfoot}{%
\global\explanontrue%
\global\explanatendfalse%
\ifexplanfootnotespara%
\DeclareNewFootnote[para]{D}%
\else%
\DeclareNewFootnote[plain]{D}%
\fi%
\renewcommand{\explanatory}[2][0]{\setlemmarange{##1}%
\FootnotetextD{\relax}{\citerange:~##2}%
\resetlemmacounters}%
\renewcommand{\proseexplanatory}[3][0]{\unskip\proselinelabel{##2}%
\setproselemmarange{##2}{##1}%
\FootnotetextD{\relax}{\proseciterange:~##3}}
\renewcommand{\pmexplanatory}[2][0]{\setpmlemmarange{##1}%
\FootnotetextD{\relax}{\pmciterange~##2}\pmresetlemmacounters}%
}
\newcommand{\bibleverse}{\pmsentence}
\newcommand{\biblechapter}{\pmpara}
\newcommand{\quotedversecorrectiontextnote}[1][0pt]
{\iftextnoteson%
\immediate\write\textnotes{\string\noindent\string\kern-#1}%
\fi}
\newcommand{\quotedversecorrectionemendation}[1][0pt]
{\ifemendationson%
\immediate\write\emendations{\string\noindent\string\kern-#1}%
\fi}
\newcommand{\quotedversecorrectionexplanatory}[1][0pt]
{\ifexplanon%
\immediate\write\explanations{\string\noindent\string\kern-#1}%
\fi}
\newcommand{\stanzaatbottom}[1]{\global\edef\stanzaatbottomvalue{#1}}
\stanzaatbottom{*}
\newcommand{\nostanzaatbottom}[1]{\global\edef\nostanzaatbottomvalue{#1}}
\nostanzaatbottom{\relax}
\def\cleartorecto{\clearpage\if@twoside \ifodd\c@page\else
  \hbox{}\thispagestyle{empty}%
  \newpage\if@twocolumn\hbox{}\newpage\fi\fi\fi}
\def\cleartoverso{\clearpage\if@twoside
  \ifodd\c@page\hbox{}\thispagestyle{empty}%
  \newpage\if@twocolumn\hbox{}\newpage\fi\fi\fi}
\makeatletter
\def\ifenv#1{%
      \def\reserved@a{#1}%
      \ifx\reserved@a\@currenvir
        \expandafter\@firstoftwo
      \else
        \expandafter\@secondoftwo
      \fi
}
\makeatother
\newdimen\pmclsavsk
\newcount\pmclsavsf
\def\pmclbsphack{%
  \relax
  \ifhmode
    \pmclsavsk\lastskip
    \pmclsavsf\spacefactor
  \fi}
\def\pmclesphack{%
  \relax
  \ifhmode
    \spacefactor\pmclsavsf
    \ifdim\pmclsavsk>0pt
      \ignorespaces
    \fi
  \fi}
\newcommand{\pmclleftsidepar}[1]{%
\pmclbsphack\strut\vadjust{% changed
\rlap{\kern-\parindent%
\kern -\marginparsep \kern -\marginparwidth% at left
\setbox0=\vtop to 0pt{% added
\begin{minipage}[t]{\marginparwidth}% added
#1%
\end{minipage}%
\vss}% changed
\vtop to 0pt{\kern\pmclsideparvshift % default should be 0pt
\kern-\dp\strutbox \kern-\ht0 \box0 \vss}}}\pmclesphack}% changed

\newcommand{\pmclrightsidepar}[1]{%
\pmclbsphack\strut\vadjust{%
\rlap{\kern-\parindent%
\kern\textwidth\kern\marginparsep% at right
\setbox0=\vtop to 0pt{% added
\begin{minipage}[t]{\marginparwidth}% added
#1%
\end{minipage}%
\vss}% changed
\vtop to 0pt{\kern\pmclsideparvshift% default should be 0pt
\kern-\dp\strutbox \kern-\ht0 \box0 \vss}}}\pmclesphack}% changed


\newif\ifparalleltexts
\paralleltextsfalse
\newif\ifrecto
\rectofalse
\newif\ifverso
\versofalse
\newif\ifrectopoempending
\rectopoempendingfalse
\newif\ifversopoempending
\versopoempendingfalse
\newif\ifrectostanzapending
\rectostanzapendingfalse
\newif\ifversostanzapending
\versostanzapendingfalse
\newif\ifrectostanzastillopen
\rectostanzastillopenfalse
\newif\ifversostanzastillopen
\versostanzastillopenfalse
\newif\ifrectopoemstillopen
\rectopoemstillopenfalse
\newif\ifversopoemstillopen
\versopoemstillopenfalse
\newif\ifrectoprosesectionpending
\rectoprosesectionpendingfalse
\newif\ifversoprosesectionpending
\versoprosesectionpendingfalse
\newif\ifrectoprosesectionstillopen
\rectoprosesectionstillopenfalse
\newif\ifversoprosesectionstillopen
\versoprosesectionstillopenfalse
\newif\ifrectoquotedversepending
\rectoquotedversependingfalse
\newif\ifversoquotedversepending
\versoquotedversependingfalse
\newif\ifrectoquotedversestillopen
\rectoquotedversestillopenfalse
\newif\ifversoquotedversestillopen
\versoquotedversestillopenfalse
\newif\ifrectoemendationspending
\rectoemendationspendingfalse
\newif\ifversoemendationspending
\versoemendationspendingfalse
\newif\ifrectoexplanationspending
\rectoexplanationspendingfalse
\newif\ifversoexplanationspending
\versoexplanationspendingfalse
\newcounter{rectolinecounter}
\setcounter{rectolinecounter}{1}
\newcounter{rectoindexscratch}
\setcounter{rectoindexscratch}{1}
\newcounter{versolinecounter}
\setcounter{versolinecounter}{1}
\newcounter{versoindexscratch}
\setcounter{versoindexscratch}{1}
\newcommand{\startparalleltexts}{%
\leavevmode
\cleartoverso
\paralleltextstrue
\renewenvironment{poem}{\raggedright
     \language=255%no hyphenation in verse
     \noemendyettrue
     \noexplainyettrue
     \setcounter{verselinenumber}{0}\setcounter{printlineindex}{0}
     \nobreak\begin{pmclverse}
     \inpoemtrue\nobreak\mark{\relax}}
     % must end poem if parallel text. Don't worry,
     % begin recto page and begin verso page will
     % reopen the poem and reset the line counter to the right value
     % if it was finish recto page or finish verso page
     % that closed the poem rather than your own declaration.
{\ifversopoemstillopen
       \end{pmclverse}
\inpoemfalse\mark{\relax}
   \else
      \ifrectopoemstillopen
  \end{pmclverse}
  \inpoemfalse\mark{\relax}
      \else
\end{pmclverse}
     \inpoemfalse\mark{\relax}
     \goodbreak\afterpoemskip%\bigskip
\fi\fi     }
\renewenvironment{stanza}{\penalty-100\instanzatrue\mark{\nostanzaatbottomvalue\ }}
{\ifversostanzastillopen
       \relax
   \else
      \ifrectostanzastillopen
  \relax
      \else
 \nobreak\mark{\stanzaatbottomvalue\ }\nobreak
\ifspeciallinelock%
\relax\else%
\nolinebreak\incrementverselinenumber%
\fi%
\speciallinelockfalse%
 \nobreak
 \instanzafalse

 \stanzaskip
\fi\fi
}
\renewcommand{\putverselinenumber}{\nolinebreak\begin{marginenvironment}%
  \nolinebreak
  \pmclleftsidepar{\textrm{\scriptsize\theverselinenumber}}%
  \nolinebreak
  \end{marginenvironment}%
  \nolinebreak
}
}
\newenvironment{parallelverse}{\startparalleltexts}
{\finishparalleltexts}
\newtoks{\versotitleholder}
\newtoks{\rectotitleholder}
\newcommand{\makeversotitleholder}[1]{%
\versotitleholder={#1}%
}
\newcommand{\makerectotitleholder}[1]{%
\rectotitleholder={#1}%
}
\makeatletter
\newcommand{\versopoemtitle}[1]{%
\versoset@p@emtitle{#1}{\poemtitlepenalty}{\poemtitlefont}%
{\relax}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}{\z@}%
\c@ntentsinfo{#1}{\contentsindentone}{\contentspoemtitlefont}%
{\contentsindenttwoamount}%
}
\newcommand{\versoset@p@emtitle}[6]{\pmclversoresetsettitleinnotes%
\setlength{\titleentryoverrun}{#6}%
{#2}%
{#3 \begin{titleentryenvironment}%
{\ifcentertitleson\begin{center}#4 #1\end{center}\else #4 #1\fi}%
\end{titleentryenvironment}}%
{#5}%
\m@kep@emlabel
\versom@ken@teholder{#1}%
\setlength{\titleentryoverrun}{\z@}}
\newcommand{\versom@ken@teholder}[1]{%
\ifsinglelinetitle
\versotitleholder={#1}%
\global\edef\@compoundlabelscratch{poem\thepoemnumber}%
\else\iftitlefirstline
       \versotitleholder={#1}%
       \global\edef\@compoundlabelscratch{poem\thepoemnumber}%
     \else\iftitlemiddleline
     \titlesofar=\versotitleholder
     \titleincrement={~#1}%
     \global\edef\titleconcat{\the\titlesofar \the\titleincrement}%
     \versotitleholder=\expandafter{\titleconcat}%
     \global\edef\@compoundlabelscratch{poem\thepoemnumber}%
  \else
      \titlesofar=\versotitleholder
      \titleincrement={~#1}%
      \global\edef\titleconcat{\the\titlesofar \the\titleincrement}%
      \versotitleholder=\expandafter{\titleconcat}%
      \global\edef\@compoundlabelscratch{poem\thepoemnumber}%
   \fi
       \fi
  \fi
}
\newcommand{\versotitletoothernotes}{\string\par
\ifputpagenumberinnotes%
\string\argpageref\string{\@compoundlabelscratch\string}%
\string\setcounterfrompageref\string{notepageholdertitle\string}%
\string{\@compoundlabelscratch\string}%
\fi%
\string\textbf\string{\ \the\versotitleholder\string}
}%
\newcommand{\versopoemtitlenocontents}[1]{%
\versoset@p@emtitle{#1}{\poemtitlepenalty}{\poemtitlefont}%
{\relax}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}{\z@}%
}
\newcommand{\versotitleinnotescheck}{\ifparalleltexts\let\titletoothernotes=\versotitletoothernotes\fi}
\makeatother
\makeatletter
\newcommand{\rectopoemtitle}[1]{%
\rectoset@p@emtitle{#1}{\poemtitlepenalty}{\poemtitlefont}%
{\relax}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}{\z@}%
\c@ntentsinfo{#1}{\contentsindentone}{\contentspoemtitlefont}%
{\contentsindenttwoamount}%
}
\newcommand{\rectoset@p@emtitle}[6]{\pmclrectoresetsettitleinnotes
\setlength{\titleentryoverrun}{#6}%
{#2}%
{#3 \begin{titleentryenvironment}%
{\ifcentertitleson\begin{center}#4 #1\end{center}\else #4 #1\fi}%
\end{titleentryenvironment}}%
{#5}%
\m@kep@emlabel
\rectom@ken@teholder{#1}%
\setlength{\titleentryoverrun}{\z@}}
\newcommand{\rectom@ken@teholder}[1]{%
\ifsinglelinetitle
\rectotitleholder={#1}%
\global\edef\@compoundlabelscratch{poem\thepoemnumber}%
\else\iftitlefirstline
       \rectotitleholder={#1}%
       \global\edef\@compoundlabelscratch{poem\thepoemnumber}%
     \else\iftitlemiddleline
     \titlesofar=\rectotitleholder
     \titleincrement={~#1}%
     \global\edef\titleconcat{\the\titlesofar \the\titleincrement}%
     \rectotitleholder=\expandafter{\titleconcat}%
     \global\edef\@compoundlabelscratch{poem\thepoemnumber}%
  \else
      \titlesofar=\rectotitleholder
      \titleincrement={~#1}%
      \global\edef\titleconcat{\the\titlesofar \the\titleincrement}%
      \rectotitleholder=\expandafter{\titleconcat}%
      \global\edef\@compoundlabelscratch{poem\thepoemnumber}%
   \fi
       \fi
  \fi
}
\newcommand{\rectotitletoothernotes}{\string\par
\ifputpagenumberinnotes%
\string\argpageref\string{\@compoundlabelscratch\string}%
\string\setcounterfrompageref\string{notepageholdertitle\string}%
\string{\@compoundlabelscratch\string}%
\fi%
\string\textbf\string{\ \the\rectotitleholder\string}
}%
\newcommand{\rectopoemtitlenocontents}[1]{%
\rectoset@p@emtitle{#1}{\poemtitlepenalty}{\poemtitlefont}%
{\relax}{\nobreak\par\nobreak\afterpoemtitleskip\nobreak}{\z@}%
}
\newcommand{\rectotitleinnotescheck}{\ifparalleltexts\let\titletoothernotes=\rectotitletoothernotes\fi}
\makeatother
\newcommand{\saveversoline}{\setcounter{versolinecounter}%
 {\value{verselinenumber}}%
\setcounter{versoindexscratch}{\value{printlineindex}}}
\newcommand{\restoreversoline}{\setcounter{verselinenumber}%
  {\value{versolinecounter}}%
\setcounter{printlineindex}{\value{versoindexscratch}}}
\newcommand{\saverectoline}{\setcounter{rectolinecounter}%
 {\value{verselinenumber}}%
\setcounter{rectoindexscratch}{\value{printlineindex}}}
\newcommand{\restorerectoline}{\setcounter{verselinenumber}%
  {\value{rectolinecounter}}%
\setcounter{printlineindex}{\value{rectoindexscratch}}}
\newtoks{\synchroflag}
\newcommand{\setsynchroflag}[1]{\synchroflag={#1}}
\setsynchroflag{\relax}
\newcommand{\synchrolabel}[1]{\poemlinelabel{#1}}
\newcommand{\hfilll}{\hskip 0pt plus 1 filll}
\newcommand{\synchroref}[1]{%
\pmclrightsidepar{{\textrm{\scriptsize[\the\synchroflag\ref{#1}]}}}%
 }
\newcommand{\startversopage}{
\ifrectostanzastillopen
  \end{stanza}
  \rectostanzastillopenfalse
  \end{poem}
   \rectopoemstillopenfalse
\fi
\ifrectopoemstillopen % from previous page
  \end{poem}
  \rectopoemstillopenfalse
\fi
\ifversopoempending % from previous verso
   \begin{poem}
  \global\versopoempendingfalse
\fi
\ifversostanzapending % from previous verso
  \begin{stanza}
  \global\versostanzapendingfalse
\fi
\ifversoemendationspending
  \noemendyetfalse
  \global\versoemendationspendingfalse
\fi
\ifversoexplanationspending
  \noexplainyetfalse
  \global\versoexplanationspendingfalse
\fi
\rectofalse\versotrue\restoreversoline
\let\titletoothernotes=\versotitletoothernotes}
\newcommand{\finishversopage}{
\saveversoline\versofalse\
\ifinpoem
  \global\versopoempendingtrue
  \versopoemstillopentrue
\fi
\ifinstanza
   \global\versostanzapendingtrue
   \versostanzastillopentrue
   \global\versopoempendingtrue
     \versopoemstillopentrue
\fi
\ifnoemendyet
 \relax
 \else
   \global\versoemendationspendingtrue
    \noemendyetfalse
\fi
\ifnoexplainyet
   \relax
    \else
       \global\versoexplanationspendingtrue
       \noexplainyetfalse
\fi
}
\newcommand{\startrectopage}{
\ifversostanzastillopen
  \end{stanza}
  \versostanzastillopenfalse
  \end{poem}
  \versopoemstillopenfalse
\fi
\ifversopoemstillopen
  \end{poem}
  \versopoemstillopenfalse
\fi
\ifrectopoempending
  \begin{poem}
  \global\rectopoempendingfalse
\fi
\ifrectostanzapending
  \begin{stanza}
  \global\rectostanzapendingfalse
\fi
\ifrectoemendationspending
  \noemendyetfalse
  \global\rectoemendationspendingfalse
\fi
\ifrectoexplanationspending
  \noexplainyetfalse
  \global\rectoexplanationspendingfalse
\fi
\versofalse\rectotrue\restorerectoline
\let\titletoothernotes=\rectotitletoothernotes}
\newcommand{\finishrectopage}{\saverectoline\rectofalse
\ifinpoem
  \global\rectopoempendingtrue
  \rectopoemstillopentrue
\fi
\ifinstanza
   \global\rectostanzapendingtrue
   \rectostanzastillopentrue
   \global\rectopoempendingtrue
     \rectopoemstillopentrue
\fi
\ifnoemendyet
  \relax
  \else
    \global\rectoemendationspendingtrue
    \noemendyetfalse
\fi
\ifnoexplainyet
  \relax
  \else
    \global\versoexplanationspendingtrue
    \noexplainyetfalse
\fi
}
\newcommand{\finishparalleltexts}{
\ifinstanza
\end{stanza}
\fi
\ifinpoem
\end{poem}
\fi
\ifinprosesection
\end{prosesection}
\fi
\ifinquotedverse
\end{quotedverse}
\fi
\rectofalse\versofalse\paralleltextsfalse
\makeatletter\pmclresetsettitleinnotes\makeatother
}
\newtoks{\versotextnotesname}
\versotextnotesname={TEXTUAL NOTES}
\newcommand{\changeversotextnotesname}[1]{\versotextnotesname={#1}}
\newtoks{\versotextnotesheadername}
\versotextnotesheadername={Textual Notes to}
\newcommand{\changeversotextnotesheader}[1]{\versotextnotesheadername={#1}}
\newtoks{\versotextnotescontentsname}
\versotextnotescontentsname={Textual Notes}
\newcommand{\changeversotextnotescontentsname}[1]{%
\versotextnotescontentsname={#1}}
\newif\ifversotextnotestwocol
\versotextnotestwocolfalse
\newcommand{\makeversotextnotes}{\global\textnotesontrue
  \newwrite\versotextnotes
  \global\verselinenumberstrue
   \immediate\openout\versotextnotes=\jobname.vtn
   \literalversotextnote{\flushbottom{\par\clearpage
   {\pagestyle{volumetitlestyle}\cleardoublepage}
\thispagestyle{volumetitlestyle}}
\fancyhead{}
\fancyhead[RO,LE]{{\small\textrm{\thepage}}}
\fancyhead[CO]{{\small{\em \the\versotextnotesheadername~\mymarks}}}
\fancyhead[CE]{{\small{\em \the\versotextnotesheadername~\mymarks}}}
\fancyfoot{}
\mark{3}
\setendnotessectiontitle{\the\versotextnotesname}{versotextnotes}
\tolerance=500\language=0
\normalfont \backmattertextfont
\ifversotextnotestwocol
\begin{multicols}{2}
\fi
\setlength{\parindent}{-10pt}
}
}
\newif\ifversotextnotessinglepar
\newif\ifnoversotextnoteyet
\newcommand{\literalversotextnote}[1]{\begingroup
        \def\next{#1}%
        \newlinechar='40
        \immediate\write\versotextnotes{\expandafter\strip\meaning\next}%
     \endgroup
}
\newcommand{\firstversotextnote}{\immediate\write\versotextnotes{\versotitletoothernotes}
    \ifversotextnotessinglepar%
    \literalversotextnote{\par}%
    \fi% ifversotextnotessinglepa
 }
\newcommand{\versotextnote}[2][0]{\versotitleinnotescheck
    \setlemmarange{#1}%
    \ifnoversotextnoteyet % firstversotextnote
     \firstversotextnote
      \fi %noversotextnoteyet
      \global\noversotextnoteyetfalse
\immediate\write\versotextnotes{\checknoteheaders}%
    \literalversotextnote{#2}%
    \ifversotextnotessinglepar%
    \literalversotextnote{\par}%
    \fi% ifversotextnotessinglepar
\resetlemmacounters
}
\newtoks{\rectotextnotesname}
\rectotextnotesname={TEXTUAL NOTES}
\newcommand{\changerectotextnotesname}[1]{\rectotextnotesname={#1}}
\newtoks{\rectotextnotesheadername}
\rectotextnotesheadername={Textual Notes to}
\newcommand{\changerectotextnotesheader}[1]{\rectotextnotesheadername={#1}}
\newtoks{\rectotextnotescontentsname}
\rectotextnotescontentsname={Textual Notes}
\newcommand{\changerectotextnotescontentsname}[1]{%
\rectotextnotescontentsname={#1}}
\newif\ifrectotextnotestwocol
\rectotextnotestwocolfalse
\newcommand{\makerectotextnotes}{\global\textnotesontrue
  \newwrite\rectotextnotes
  \global\verselinenumberstrue
   \immediate\openout\rectotextnotes=\jobname.rtn
   \literalrectotextnote{\flushbottom{\par\clearpage
   {\pagestyle{volumetitlestyle}\cleardoublepage}
\thispagestyle{volumetitlestyle}}
\fancyhead{}
\fancyhead[RO,LE]{{\small\textrm{\thepage}}}
\fancyhead[CO]{{\small{\em \the\rectotextnotesheadername~\mymarks}}}
\fancyhead[CE]{{\small{\em \the\rectotextnotesheadername~\mymarks}}}
\fancyfoot{}
\mark{3}
\setendnotessectiontitle{\the\rectotextnotesname}{rectotextnotes}
\tolerance=500\language=0
\normalfont \backmattertextfont
\ifrectotextnotestwocol
\begin{multicols}{2}
\fi
\setlength{\parindent}{-10pt}
}
}
\newif\ifrectotextnotessinglepar
\newif\ifnorectotextnoteyet
\newcommand{\literalrectotextnote}[1]{\begingroup
        \def\next{#1}%
        \newlinechar='40
        \immediate\write\rectotextnotes{\expandafter\strip\meaning\next}%
     \endgroup
}
\newcommand{\firstrectotextnote}{\immediate\write\rectotextnotes{\rectotitletoothernotes}
    \ifrectotextnotessinglepar%
    \literalrectotextnote{\par}%
    \fi% ifrectotextnotessinglepar
}
\newcommand{\rectotextnote}[2][0]{\rectotitleinnotescheck
    \setlemmarange{#1}%
    \ifnorectotextnoteyet % firstrectotextnote
     \firstrectotextnote
      \fi %norectotextnoteyet
      \global\norectotextnoteyetfalse
\immediate\write\rectotextnotes{\checknoteheaders}%
    \literalrectotextnote{#2}%
    \ifrectotextnotessinglepar%
    \literalrectotextnote{\par}%
    \fi% ifrectotextnotessinglepar
\resetlemmacounters
}
\newtoks{\versoemendationsname}
\versoemendationsname={EMENDATIONS}
\newcommand{\changeversoemendationsname}[1]{\versoemendationsname={#1}}
\newtoks{\versoemendationsheadername}
\versoemendationsheadername={Emendations to}
\newcommand{\changeversoemendationsheader}[1]{\versoemendationsheadername={#1}}
\newtoks{\versoemendationscontentsname}
\versoemendationscontentsname={Emendations}
\newcommand{\changeversoemendationscontentsname}[1]{%
\versoemendationscontentsname={#1}}
\newif\ifversoemendationstwocol
\versoemendationstwocolfalse
\newcommand{\makeversoemendations}{\global\emendationsontrue
  \newwrite\versoemendations
  \global\verselinenumberstrue
   \immediate\openout\versoemendations=\jobname.vem
   \literalversoemendation{\flushbottom{\par\clearpage
   {\pagestyle{volumetitlestyle}\cleardoublepage}
\thispagestyle{volumetitlestyle}}
\fancyhead{}
\fancyhead[RO,LE]{{\small\textrm{\thepage}}}
\fancyhead[CO]{{\small{\em \the\versoemendationsheadername~\mymarks}}}
\fancyhead[CE]{{\small{\em \the\versoemendationsheadername~\mymarks}}}
\fancyfoot{}
\mark{3}
\setendnotessectiontitle{\the\versoemendationsname}{versoemendations}
\tolerance=500\language=0
\normalfont \backmattertextfont
\ifversoemendationstwocol
\begin{multicols}{2}
\fi
\setlength{\parindent}{-10pt}
}
}
\newif\ifversoemendationssinglepar
\newif\ifnoversoemendationyet
\newcommand{\literalversoemendation}[1]{\begingroup
        \def\next{#1}%
        \newlinechar='40
        \immediate\write\versoemendations{\expandafter\strip\meaning\next}%
     \endgroup
}
\newcommand{\firstversoemendation}{\immediate\write\versoemendations{\versotitletoothernotes}
    \ifversoemendationssinglepar%
    \literalversoemendation{\par}%
    \fi% ifversoemendationssinglepar
}
\newcommand{\versoemendation}[2][0]{\versotitleinnotescheck%
    \setlemmarange{#1}%
    \ifnoversoemendationyet % firstversoemendation
     \firstversoemendation
      \fi %noversoemendationyet
      \global\noversoemendationyetfalse
\immediate\write\versoemendations{\checknoteheaders}%
    \literalversoemendation{#2}%
    \ifversoemendationssinglepar%
    \literalversoemendation{\par}%
    \fi% ifversoemendationssinglepar
\resetlemmacounters
}
\newtoks{\rectoemendationsname}
\rectoemendationsname={EMENDATIONS}
\newcommand{\changerectoemendationsname}[1]{\rectoemendationsname={#1}}
\newtoks{\rectoemendationsheadername}
\rectoemendationsheadername={Emendations to}
\newcommand{\changerectoemendationsheader}[1]{\rectoemendationsheadername={#1}}
\newtoks{\rectoemendationscontentsname}
\rectoemendationscontentsname={Emendations}
\newcommand{\changerectoemendationscontentsname}[1]{%
\rectoemendationscontentsname={#1}}
\newif\ifrectoemendationstwocol
\rectoemendationstwocolfalse
\newcommand{\makerectoemendations}{\global\emendationsontrue
  \newwrite\rectoemendations
  \global\verselinenumberstrue
   \immediate\openout\rectoemendations=\jobname.rem
   \literalrectoemendation{\flushbottom{\par\clearpage
   {\pagestyle{volumetitlestyle}\cleardoublepage}
\thispagestyle{volumetitlestyle}}
\fancyhead{}
\fancyhead[RO,LE]{{\small\textrm{\thepage}}}
\fancyhead[CO]{{\small{\em \the\rectoemendationsheadername~\mymarks}}}
\fancyhead[CE]{{\small{\em \the\rectoemendationsheadername~\mymarks}}}
\fancyfoot{}
\mark{3}
\setendnotessectiontitle{\the\rectoemendationsname}{rectoemendations}
\tolerance=500\language=0
\normalfont \backmattertextfont
\ifrectoemendationstwocol
\begin{multicols}{2}
\fi
\setlength{\parindent}{-10pt}
}
}
\newif\ifrectoemendationssinglepar
\newif\ifnorectoemendationyet
\newcommand{\literalrectoemendation}[1]{\begingroup
        \def\next{#1}%
        \newlinechar='40
        \immediate\write\rectoemendations{\expandafter\strip\meaning\next}%
     \endgroup
}
\newcommand{\firstrectoemendation}{\immediate\write\rectoemendations{\rectotitletoothernotes}
    \ifrectoemendationssinglepar%
    \literalrectoemendation{\par}%
    \fi% ifrectoemendationssinglepar
}
\newcommand{\rectoemendation}[2][0]{\rectotitleinnotescheck
    \setlemmarange{#1}%
    \ifnorectoemendationyet % firstrectoemendation
     \firstrectoemendation
      \fi %norectoemendationyet
      \global\norectoemendationyetfalse
\immediate\write\rectoemendations{\checknoteheaders}%
    \literalrectoemendation{#2}%
    \ifrectoemendationssinglepar%
    \literalrectoemendation{\par}%
    \fi% ifrectoemendationssinglepar
\resetlemmacounters
}
\newtoks{\versoexplanationsname}
\versoexplanationsname={EXPLANATORY NOTES}
\newcommand{\changeversoexplanationsname}[1]{\versoexplanationsname={#1}}
\newtoks{\versoexplanationsheadername}
\versoexplanationsheadername={Explanatory Notes to}
\newcommand{\changeversoexplanationsheader}[1]{\versoexplanationsheadername={#1}}
\newtoks{\versoexplanationscontentsname}
\versoexplanationscontentsname={Explanatory Notes}
\newcommand{\changeversoexplanationscontentsname}[1]{%
\versoexplanationscontentsname={#1}}
\newif\ifversoexplanationstwocol
\versoexplanationstwocolfalse
\newcommand{\makeversoexplanatorynotes}{\global\explanontrue
     \global\verselinenumberstrue
     \newwrite\versoexplanations
     \immediate\openout\versoexplanations=\jobname.vex
     \literalversoexplain{\flushbottom{\par\clearpage
 {\pagestyle{volumetitlestyle}\cleardoublepage}
\thispagestyle{volumetitlestyle}}
\fancyhead[RO,LE]{{\small\textrm{\thepage}}}
\fancyhead[CO]{{\small{\em \the\versoexplanationsheadername~\mymarks}}}
\fancyhead[CE]{{\small{\em \the\versoexplanationsheadername~\mymarks}}}
\fancyfoot{}
\mark{3}
\setendnotessectiontitle{\the\versoexplanationsname}{versoexplanatorynotes}
\tolerance=500\language=0
\normalfont \backmattertextfont
\ifversoexplanationstwocol
\begin{multicols}{2}
\fi
\setlength{\parindent}{-10pt}
}
}
\newcommand{\literalversoexplain}[1]{
     \begingroup
        \def\next{#1}%
        \newlinechar='40
        \immediate\write\versoexplanations{\expandafter\strip\meaning\next}%
     \endgroup
}
\newif\ifversoexplanationssinglepar
\newcommand{\firstversoexplanatory}{\immediate\write\versoexplanations{\versotitletoothernotes}
    \ifversoexplanationssinglepar%
    \literalversoexplain{\par}%
\fi}
\newif\ifnoversoexplainyet
\newcommand{\versoexplanatory}[2][0]{\versotitleinnotescheck%
\ifexplanon
    \setlemmarange{#1}%
    \ifnoversoexplainyet % first versoexplanation
    \firstversoexplanatory
      \fi %noversoexplainyet
      \global\noversoexplainyetfalse
\immediate\write\versoexplanations{\checknoteheaders}%
    \literalversoexplain{#2}%
    \ifversoexplanationssinglepar%
    \literalversoexplain{\par}%
    \fi%
    \fi % ifexplanon
\resetlemmacounters
}
\newtoks{\rectoexplanationsname}
\rectoexplanationsname={EXPLANATORY NOTES}
\newcommand{\changerectoexplanationsname}[1]{\rectoexplanationsname={#1}}
\newtoks{\rectoexplanationsheadername}
\rectoexplanationsheadername={Explanatory Notes to}
\newcommand{\changerectoexplanationsheader}[1]{\rectoexplanationsheadername={#1}}
\newtoks{\rectoexplanationscontentsname}
\rectoexplanationscontentsname={Explanatory Notes}
\newcommand{\changerectoexplanationscontentsname}[1]{%
\rectoexplanationscontentsname={#1}}
\newif\ifrectoexplanationstwocol
\rectoexplanationstwocolfalse
\newcommand{\makerectoexplanatorynotes}{\global\explanontrue
     \global\verselinenumberstrue
     \newwrite\rectoexplanations
     \immediate\openout\rectoexplanations=\jobname.rex
     \literalrectoexplain{\flushbottom{\par\clearpage
 {\pagestyle{volumetitlestyle}\cleardoublepage}
\thispagestyle{volumetitlestyle}}
\fancyhead[RO,LE]{{\small\textrm{\thepage}}}
\fancyhead[CO]{{\small{\em \the\rectoexplanationsheadername~\mymarks}}}
\fancyhead[CE]{{\small{\em \the\rectoexplanationsheadername~\mymarks}}}
\fancyfoot{}
\mark{3}
\setendnotessectiontitle{\the\rectoexplanationsname}{rectoexplanatorynotes}
\tolerance=500\language=0
\normalfont \backmattertextfont
\ifrectoexplanationstwocol
\begin{multicols}{2}
\fi
\setlength{\parindent}{-10pt}
}
}
\newcommand{\literalrectoexplain}[1]{
     \begingroup
        \def\next{#1}%
        \newlinechar='40
        \immediate\write\rectoexplanations{\expandafter\strip\meaning\next}%
     \endgroup
}
\newif\ifrectoexplanationssinglepar
\newcommand{\firstrectoexplanatory}{\immediate\write\rectoexplanations{\rectotitletoothernotes}
    \ifrectoexplanationssinglepar%
    \literalrectoexplain{\par}%
    \fi%
}
\newif\ifnorectoexplainyet
\newcommand{\rectoexplanatory}[2][0]{\rectotitleinnotescheck%
\ifexplanon
    \setlemmarange{#1}%
    \ifnorectoexplainyet % first rectoexplanation
    \firstrectoexplanatory
      \fi %norectoexplainyet
      \global\norectoexplainyetfalse
\immediate\write\rectoexplanations{\checknoteheaders}%
    \literalrectoexplain{#2}%
    \ifrectoexplanationssinglepar%
    \literalrectoexplain{\par}%
    \fi%
    \fi % ifexplanon
\resetlemmacounters
}
\newcommand{\versoprosetextnote}[3][0]{%
\iftextnoteson%
\versotitleinnotescheck
\unskip\proselinelabel{#2}%
\setproselemmarange{#2}{#1}%
   \ifnoversotextnoteyet % firstversotextnote
     \firstversotextnote
      \fi %noversotextnoteyet
      \global\noversotextnoteyetfalse
\immediate\write\versotextnotes{\checkprosenoteheaders}%
\literalversotextnote{#3}%
\ifversotextnotessinglepar%
\literalversotextnote{\par}%
\fi%
\resetlemmacounters%
\fi\unskip%
}
\newcommand{\versoproseemendation}[3][0]{%
\ifemendationson%
\versotitleinnotescheck
\unskip\proselinelabel{#2}%
\setproselemmarange{#2}{#1}%
    \ifredundantemendations
       \iftextnoteson
 \ifrangelemma
     \versoprosetextnote[#1]{#2}{#3}%
 \else
     \versoprosetextnote{#2}{#3}%
 \fi % ifrangelemma}
       \fi %iftextnoteson
\ifversotextnotessinglepar%
\literalversotextnote{\par}%
\fi%  iftextnotessinglepar
   \fi % ifredundantemendations
    \ifnoversoemendationyet % firstemendation
     \firstversoemendation
      \fi%noemendyet
      \global\noversoemendationyetfalse
\immediate\write\versoemendations{\checkprosenoteheaders}%
    \literalversoemendation{#3}%
\ifversoemendationssinglepar%
\literalversoemendation{\par}%
\fi% ifemendationssinglep
    \resetlemmacounters%
\fi\unskip%
}
\newcommand{\versoproseexplanatory}[3][0]{%
\ifexplanon%
\versotitleinnotescheck
\unskip\proselinelabel{#2}%
\setproselemmarange{#2}{#1}%
    \ifnoversoexplainyet% firstexplanation
     \firstversoexplanatory%
      \fi%noexplainyet
      \global\noversoexplainyetfalse%
\immediate\write\versoexplanations{\checkprosenoteheaders}%
    \literalversoexplain{#3}%
\ifversoexplanationssinglepar%
    \literalversoexplain{\par}%
    \fi% ifexplanationssinglepar
    \resetlemmacounters%
\fi\unskip%
}
\newcommand{\rectoprosetextnote}[3][0]{%
\iftextnoteson%
\rectotitleinnotescheck
\unskip\proselinelabel{#2}%
\setproselemmarange{#2}{#1}%
  \ifnorectotextnoteyet % firstrectotextnote
     \firstrectotextnote
      \fi %norectotextnoteyet
      \global\norectotextnoteyetfalse
\immediate\write\rectotextnotes{\checkprosenoteheaders}%
\literalrectotextnote{#3}%
\ifrectotextnotessinglepar%
\literalrectotextnote{\par}%
\fi%
\resetlemmacounters%
\fi\unskip%
}
\newcommand{\rectoproseemendation}[3][0]{%
\ifemendationson%
\rectotitleinnotescheck
\unskip\proselinelabel{#2}%
\setproselemmarange{#2}{#1}%
    \ifredundantemendations
       \iftextnoteson
 \ifrangelemma
     \rectoprosetextnote[#1]{#2}{#3}%
 \else
     \rectoprosetextnote{#2}{#3}%
 \fi % ifrangelemma}
       \fi %iftextnoteson
\ifrectotextnotessinglepar%
\literalrectotextnote{\par}%
\fi%  iftextnotessinglepar
   \fi % ifredundantemendations
    \ifnorectoemendationyet % firstemendation
     \firstrectoemendation
      \fi%noemendyet
      \global\norectoemendationyetfalse
\immediate\write\rectoemendations{\checkprosenoteheaders}%
    \literalrectoemendation{#3}%
\ifrectoemendationssinglepar%
\literalrectoemendation{\par}%
\fi% ifemendationssinglep
    \resetlemmacounters%
\fi\unskip%
}
\newcommand{\rectoproseexplanatory}[3][0]{%
\ifexplanon%
\rectotitleinnotescheck
\unskip\proselinelabel{#2}%
\setproselemmarange{#2}{#1}%
    \ifnorectoexplainyet% firstexplanation
     \firstrectoexplanatory%
      \fi%noexplainyet
      \global\norectoexplainyetfalse%
\immediate\write\rectoexplanations{\checkprosenoteheaders}%
    \literalrectoexplain{#3}%
\ifrectoexplanationssinglepar%
    \literalrectoexplain{\par}%
    \fi% ifexplanationssinglepar
    \resetlemmacounters%
\fi\unskip%
}
\newcommand{\pmclresetsettitleinnotes}{%
\noversoemendationyettrue%
\noversoexplainyettrue%
\noversotextnoteyettrue%
\norectoemendationyettrue%
\norectoexplainyettrue%
\norectotextnoteyettrue%
}
\newcommand{\pmclversoresetsettitleinnotes}{%
\noversoemendationyettrue%
\noversoexplainyettrue%
\noversotextnoteyettrue%
}
\newcommand{\pmclrectoresetsettitleinnotes}{%
\norectoemendationyettrue%
\norectoexplainyettrue%
\norectotextnoteyettrue%
}
\let\literalexplanatory=\literalexplain
\let\literalversoexplanatory=\literalversoexplain
\let\literalrectoexplanatory=\literalrectoexplain
\newcommand{\putversotextnotes}{
\iftextnoteson
\ifversotextnotestwocol
\literalversotextnote{\end{multicols}}
\fi %\iftextnotetwocol
   \newpage
   \hyphenationforsmall
   \immediate\closeout\versotextnotes
   \input \jobname.vtn
\contentsendnotestitle{\the\versotextnotescontentsname}{versotextnotes}
\else
 \relax
\fi}
\newcommand{\putrectotextnotes}{
\iftextnoteson
\ifrectotextnotestwocol
\literalrectotextnote{\end{multicols}}
\fi %\iftextnotetwocol
   \newpage
   \hyphenationforsmall
   \immediate\closeout\rectotextnotes
   \input \jobname.rtn
\contentsendnotestitle{\the\rectotextnotescontentsname}{rectotextnotes}
\else
 \relax
\fi}
\newcommand{\putversoemendations}{
\ifemendationson
\ifversoemendationstwocol
\literalversoemendation{\end{multicols}}
\fi %\iftextnotetwocol
   \newpage
   \hyphenationforsmall
   \immediate\closeout\versoemendations
   \input \jobname.vem
\contentsendnotestitle{\the\versoemendationscontentsname}{versoemendations}
\else
 \relax
\fi}
\newcommand{\putrectoemendations}{
\ifemendationson
\ifrectoemendationstwocol
\literalrectoemendation{\end{multicols}}
\fi %\iftextnotetwocol
   \newpage
   \hyphenationforsmall
   \immediate\closeout\rectoemendations
   \input \jobname.rem
\contentsendnotestitle{\the\rectoemendationscontentsname}{rectoemendations}
\else
 \relax
\fi}
\newcommand{\putversoexplanatorynotes}{
\ifexplanon
\ifversoexplanationstwocol
\literalversoexplain{\end{multicols}}
\fi %\iftextnotetwocol
   \newpage
   \hyphenationforsmall
   \immediate\closeout\versoexplanations
   \input \jobname.vex
\ifpoemcontentson
 \ifexplanon
\contentsendnotestitle{\the\versoexplanationscontentsname}{versoexplanatorynotes}
  \fi
\fi
\else
 \relax
\fi}%    \end{macrocode}
\newcommand{\putrectoexplanatorynotes}{
\ifexplanon
\ifrectoexplanationstwocol
\literalrectoexplain{\end{multicols}}
\fi %\iftextnotetwocol
   \newpage
   \hyphenationforsmall
   \immediate\closeout\rectoexplanations
   \input \jobname.rex
\ifpoemcontentson
 \ifexplanon
\contentsendnotestitle{\the\rectoexplanationscontentsname}{rectoexplanatorynotes}
  \fi
\fi
\else
 \relax
\fi}
\newif\ifversopassagestillopen
\versopassagestillopenfalse
\newif\ifrectopassagestillopen
\rectopassagestillopenfalse
\newif\ifinpara
\inparafalse
\newif\ifrectoparapending
\rectoparapendingfalse
\newif\ifrectoparaopen
\rectoparaopenfalse
\newif\ifversoparapending
\versoparapendingfalse
\newif\ifversoparaopen
\versoparaopenfalse
\newcounter{prosepage}
\setcounter{prosepage}{1}
\newcommand{\makeprosepagelabel}{\proselinelabel{prosepageno\theprosepage}}
\newcounter{versoproselinecounter}
\newcommand{\saveversoproseline}{%
\refstepcounter{prosepage}%
\makeprosepagelabel
\setcounterfromref{versoproselinecounter}{prosepageno\theprosepage}
}
\newcommand{\restoreversoproseline}{\setcounter{linenumber}{\value{versoproselinecounter}}}%
\newcounter{rectoproselinecounter}
\newcommand{\saverectoproseline}{%
\refstepcounter{prosepage}%
\makeprosepagelabel
\setcounterfromref{rectoproselinecounter}{prosepageno\theprosepage}
}
\newcommand{\restorerectoproseline}{\setcounter{linenumber}%
 {\value{rectoproselinecounter}}}%
\newcommand{\parastart}{\inparatrue}
\newcommand{\paraend}{\inparafalse}
\newcommand{\startparalleltextsprose}{%
\leavevmode
\cleartoverso
\paralleltextstrue
\inparafalse
}
\newcommand{\finishparalleltextsprose}{%
\paralleltextsfalse}
\newenvironment{parallelprose}{\startparalleltextprose} {\finishparalleltextsprose}
\newcommand{\startversoprosepage}{%
\let\titletoothernotes=\versotitletoothernotes
\restoreversoproseline%
\ifversoparapending{\inparatrue}\else{\inparafalse}\fi%
\ifinpara{\noindent}\else{\relax}\fi%
}
\newcommand{\finishversoprosepage}{%
\ifinpara{\versoparapendingtrue}\else{\versoparapendingfalse}\fi%
\saveversoproseline%
}
\newcommand{\startrectoprosepage}{%
\let\titletoothernotes=\rectotitletoothernotes
\restorerectoproseline%
\ifrectoparapending{\inparatrue}\else{\inparafalse}\fi%
\ifinpara{\noindent}\else{\relax}\fi%
}
\newcommand{\finishrectoprosepage}{%
\ifinpara{\rectoparapendingtrue}\else{\rectoparapendingfalse}\fi%
\saverectoproseline
}

\newcommand{\finish}{
\small\bf \hyphenchar\font=45
\small\it \hyphenchar\font=45
\small\rm \hyphenchar\font=45

\ifemendationson
   \newpage
   \immediate\closeout\emendations
   \input \jobname.emd
\fi
\iftextnoteson
   \newpage
   \immediate\closeout\textnotes
   \input \jobname.ent
   \newpage
 \fi
 \ifexplanon
      \immediate\closeout\explanations
      \input \jobname.enx
      \newpage
 \fi
 \ifindexingon
 \printindex
 \fi
 \ifpoemcontentson
     \ifemendationson
      \immediate\write\poemcontents{\string\contentspoemtitlefont\
      \the\emendationscontentsname}
      \immediate\write
\poemcontents{\string~ /  \string~\ \string\pageref{emendationnotes} \string\par}
      \immediate\write\poemcontents{\string\par \string\smallskip}
     \fi
     \iftextnoteson
      \immediate\write\poemcontents{\string\contentspoemtitlefont\
      \the\textnotescontentsname}
      \immediate\write
\poemcontents{\string~ /  \string~\ \string\pageref{textualnotes} \string\par}
      \immediate\write\poemcontents{\string\par \string\smallskip}
     \fi
     \ifexplanon
       \immediate\write
\poemcontents{\string\contentspoemtitlefont\ \the\explanationscontentsname}
       \immediate\write
\poemcontents{\string~ /  \string~\ \string\pageref{explanatorynotes}}
     \fi
     \ifindexingon
        \immediate\write\poemcontents{\string\par \string\smallskip}
        \immediate\write
\poemcontents{\string\contentspoemtitlefont\ \the\poemindexcontentsname}
        \immediate\write
\poemcontents{\string~ /  \string~\ \string\pageref{indexpage}\string\par}
     \fi
    \immediate\closeout\poemcontents
    \input \jobname.ctn
 \fi
 \clearpage
\thispagestyle{volumetitlestyle}
\vspace{106pt}
\begin{center}
{\poemtitlefont Note}
\end{center}

\noindent The symbol \stanzaatbottomvalue\ is used to indicate
a space between sections of a poem
wherever such spaces are lost in pagination.
\cleardoublepage
}
\newcommand{\testforauxonfirstrun}{\IfFileExists{\jobname.aux}{\relax}
{\let\finish=\relax
\let\puttextnotes=\relax
\let\putexplanatory=\relax
\let\putemendations=\relax
\typeout{Run again to read in endnotes files}}}

\newcommand{\putpoemcontents}{
\IfFileExists{\jobname.ctn}{\input \jobname.ctn
\clearpage \resetpagestyle\normalsize}
{\typeout{Run again to input contents file here}}
}
\newcommand{\hyphenationforsmall}{\small\bf \hyphenchar\font=45
\small\it \hyphenchar\font=45
\small\rm \hyphenchar\font=45
}
\newcommand{\putemendations}{
\ifemendationson
\ifemendationstwocol
\literalemend{\end{multicols}}
\fi %\iftextnotetwocol
   \newpage
   \hyphenationforsmall
   \immediate\closeout\emendations
   \input \jobname.emd
\contentsendnotestitle{\the\emendationscontentsname}{emendationnotes}
\else
 \relax
\fi}
\newcommand{\putexplanatory}{
\ifexplanon
\ifexplanationstwocol
\literalexplain{\end{multicols}}
\fi %\iftextnotetwocol
   \newpage
   \hyphenationforsmall
   \immediate\closeout\explanations
   \input \jobname.enx
\ifpoemcontentson
 \ifexplanon
\contentsendnotestitle{\the\explanationscontentsname}{explanatorynotes}
  \fi
\fi
\else
 \relax
\fi}
\newcommand{\puttextnotes}{
\iftextnoteson
\iftextnotestwocol
\literaltextnote{\end{multicols}}
\fi %\iftextnotetwocol
   \newpage
   \hyphenationforsmall
   \immediate\closeout\textnotes
   \input \jobname.ent
\contentsendnotestitle{\the\textnotescontentsname}{textualnotes}
\else
 \relax
\fi}
\newtoks{\poemindexname}
\poemindexname={Index of Titles and First Lines}
\newcommand{\changepoemindexname}[1]{\poemindexname={#1}}
\newtoks{\poemindexheadername}
\poemindexheadername={Index of Titles and First Lines}
\newcommand{\changepoemindexheader}[1]{\poemindexheadername={#1}}
\newtoks{\poemindexcontentsname}
\poemindexcontentsname={Index of Titles and First Lines}
\newcommand{\changepoemindexcontentsname}[1]{\poemindexcontentsname={#1}}
\newcommand{\putpoemindex}{\ifindexingon
 \printindex
 \fi
 \ifpoemcontentson\ifindexingon
     \immediate\write\poemcontents{\string\par \string\smallskip}
     \immediate\write
\poemcontents{\string\contentspoemtitlefont\ \the\poemindexcontentsname}
     \immediate\write
\poemcontents{\string~\string\contentsleaders \string~\ \string\pageref{indexpage}\string\par}
  \fi\fi}
\newcommand{\putmultiplepoemindex}[4]{%
\ifindexingon
\poemindexname={#2}
\poemindexheadername={#3}
\poemindexcontentsname={#4}
\poemindexlabelname={#4}
\printindex[#1][#2]
\fi
\ifpoemcontentson\ifindexingon
     \immediate\write\poemcontents{\string\par \string\smallskip}
     \immediate\write
\poemcontents{\string\contentspoemtitlefont\ \the\poemindexcontentsname}
     \immediate\write
\poemcontents{\string~ \string\contentsleaders \string~\
\string\pageref{\the\poemindexlabelname}\string\par}
  \fi\fi
}
\newcommand{\noteaboutstanzamarkpage}{\begin{volumetitlepage}
\vspace{106pt}
\begin{center}
{\poemtitlefont Note}
\end{center}

\noindent The symbol \stanzaatbottomvalue\ is used to indicate
a space between sections of a poem
wherever such spaces are lost in pagination.
\end{volumetitlepage}}
\newcommand{\longpage}{\enlargethispage{\baselineskip}}
\newcommand{\shortpage}{\enlargethispage{-\baselineskip}}

\newenvironment{cjquotation}
                {\tolerance=2000%
                \vspace{-\bigskipamount}
               \restoreverselinenumber
               \language=255
               \noindent\relax
               \list{}{\listparindent 0em%
                        \itemindent 0em%
                        \rightmargin 2em%
                        \leftmargin 2em%
                        \topsep 0em%
                        \parskip 0em%
                        \itemindent    \listparindent
                        \rightmargin   \leftmargin
                        \parsep        \z@ \@plus\p@}%
                \item[]
                }
               {\endlist}
\newtoks{\poemindexlabelname}
\poemindexlabelname={indexpage}
\newcommand{\changepoemindexlabelname}[1]{\poemindexlabelname={#1}}
\renewenvironment{theindex}
     {{\par\clearpage{\pagestyle{volumetitlestyle}\cleardoublepage}
     \thispagestyle{volumetitlestyle}}
     \makeatletter
     \def\pmclidxitem{\par\hangindent 1em}
\fancyhead[RO,LE]{{\small\textrm{\thepage}}}
\fancyhead[CO]{{\small{\em \the\poemindexheadername}}}
\fancyhead[CE]{{\small{\em \the\poemindexheadername}}}
\fancyfoot{}
     \label{\the\poemindexlabelname}
     \lefthyphenmin=2\tolerance=500\language=0
     \normalfont \backmattertextfont
               \raggedright
                \begin{multicols}
{2}[\backmattersink\begin{center}{\normalfont
\backmatterheaderfont \the\poemindexname}\end{center}
\backmatterafterheadersink]%
                \let\item\pmclidxitem}
               {\end{multicols}\clearpage}
\makeatother
\newlength{\epigraphquoteleftmargin}
\newlength{\epigraphquoterightmargin}
\setlength{\epigraphquoteleftmargin}{1.5em}
\setlength{\epigraphquoterightmargin}{1.5em}
\newenvironment{epigraphquote}{\list{}{\rightmargin\epigraphquoterightmargin%
                                       \leftmargin\epigraphquoteleftmargin%
                                       \topsep 0pt%
                                       \partopsep 0pt%
                                       \listparindent 0pt%
                                       }%
                \item\relax}
               {\endlist}
\newenvironment{volumetitlepagequote}{\list{}{\rightmargin \voladditionalamount%
                                              \leftmargin \voladditionalamount%
                                       \topsep 0pt%
                                       \partopsep 0pt%
                                       \listparindent 0pt
                                       }%
                \item\relax}
               {\endlist}
\endinput
%%
%% End of file `poemscol.sty'.
