\documentclass{amsart}

\usepackage{texml}

\title{nested align}

\csname noTeXMLarticlehistory\endcsname

\begin{document}

\maketitle

hello, world

\bigskip

\tabskip=10pt

\halign{
    #\cr
    A\cr
    \vbox{B}\cr
    C\cr
}

\halign
    {%          %{entering align group (level 1) at line 33}
    #
    \cr         %{entering align group (level 2) at line 35}{leaving align group (level 2) entered at line 35}
    A
    \cr         %{entering align group (level 2) at line 37}
    (
    \ifTeXML\else\vbox\fi
    {%          %{entering vbox group (level 3) at line 40}
        [
            \halign
            {%          %{entering align group (level 4) at line 43}
                #
                \cr     %{entering align group (level 5) at line 45}{leaving align group (level 5) entered at line 45}
                N
                \cr     %{entering align group (level 5) at line 47}{leaving align group (level 5) entered at line 47}
            }%          %{leaving align group (level 4) entered at line 43}
        ]%
    }%                  %{leaving vbox group (level 3) entered at line 40}
    )                   %{leaving align group (level 2) entered at line 37}
    \cr                 %{entering align group (level 2) at line 52}{leaving align group (level 2) entered at line 52}
    C
    \cr                 %{entering align group (level 2) at line 54}{leaving align group (level 2) entered at line 54}
}                       %{leaving align group (level 1) entered at line 33}


\end{document}

\ifTeXML
%    \tracingmacros=\numexpr 16 + 32
\fi

\tracinggroups=2
\TeXMLdebugoutput=1

\halign
    {%          %{entering align group (level 1) at line 33}
    #
    \cr         %{entering align group (level 2) at line 35}{leaving align group (level 2) entered at line 35}
    A
    \cr         %{entering align group (level 2) at line 37}
    (
    \vbox
    {%          %{entering vbox group (level 3) at line 40}
        [
            \halign
            {%          %{entering align group (level 4) at line 43}
                #
                \cr     %{entering align group (level 5) at line 45}{leaving align group (level 5) entered at line 45}
                N
                \cr     %{entering align group (level 5) at line 47}{leaving align group (level 5) entered at line 47}
            }%          %{leaving align group (level 4) entered at line 43}
        ]%
    }%                  %{leaving vbox group (level 3) entered at line 40}
    )                   %{leaving align group (level 2) entered at line 37}
    \cr                 %{entering align group (level 2) at line 52}{leaving align group (level 2) entered at line 52}
    C
    \cr                 %{entering align group (level 2) at line 54}{leaving align group (level 2) entered at line 54}
}                       %{leaving align group (level 1) entered at line 33}

\TeXMLdebugoutput=0
\tracinggroups=0

\end{document}

{entering align group (level 1) at line 33}
{entering align group (level 2) at line 35}
{leaving align group (level 2) entered at line 35}
{entering align group (level 2) at line 37}
{entering vbox group (level 3) at line 40}
{entering align group (level 4) at line 43}
{entering align group (level 5) at line 45}
{leaving align group (level 5) entered at line 45}
{entering align group (level 5) at line 47}
{leaving align group (level 5) entered at line 47}
{leaving align group (level 4) entered at line 43}
{leaving vbox group (level 3) entered at line 40}

{leaving align group (level 2) entered at line 37}

{entering align group (level 2) at line 52}
{leaving align group (level 2) entered at line 52}
{entering align group (level 2) at line 54}
{leaving align group (level 2) entered at line 54}
{leaving align group (level 1) entered at line 33}
