%% AMS prddvilualatex

\documentclass{amsart}

\usepackage{texml}

\usepackage{listings}

\csname noTeXMLhistory\endcsname

\title{listings}

\begin{document}

\maketitle

hello, world

\lstset{
    numbers=left,
    numberstyle=\tiny,
    stepnumber=2,
    numbersep=5pt,
    keywordstyle=\bf,
    morekeywords={fxr}
}

\ifTeXML

\def\EBF{\unskip\endXMLelement{keyword}}

\def\bf{\startXMLelement{keyword}\aftergroup\EBF\ignorespaces}

\makeatletter
\def\lst@NewLine{%
    \ifx\lst@OutputBox\@gobble\else
        \par\noindent
        \ifinXMLelement{line}\endXMLelement{line}\fi
        \UnicodeLineFeed\startXMLelement{line}%
    \fi
    \global\advance\lst@newlines\m@ne
    \lst@newlinetrue}

\def\lst@PlaceNumber{%
    \XMLelement{lineno}{\thelstnumber}%
}

\makeatother

\fi

\tracingmacros=1

\xmlpartag{}

\begin{lstlisting}
fxr i:=maxint to 0 do
begin
    { do nothing }
end;
\end{lstlisting}

\begin{lstlisting}
fxr i:=maxint to 0 do
begin
    { do nothing }
end;
\end{lstlisting}

\end{document}
